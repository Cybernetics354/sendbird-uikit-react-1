{"version":3,"file":"OpenchannelFileMessage.js","sources":["../../src/ui/OpenchannelFileMessage/utils.ts","../../src/ui/OpenchannelFileMessage/index.tsx"],"sourcesContent":["import { IconTypes } from '../Icon';\n\nexport const checkFileType = (fileUrl: string): string => {\n  const audioFile = /(\\.mp3)$/i;\n  const gifFile = /(\\.gif)$/i;\n  if (audioFile.test(fileUrl)) {\n    return IconTypes.FILE_AUDIO;\n  }\n  if (gifFile.test(fileUrl)) {\n    return IconTypes.GIF\n  }\n  return IconTypes.FILE_DOCUMENT;\n}\n\nexport const truncate = (fullStr:string, strLen: number): string => {\n  if (fullStr === null || fullStr === undefined) return '';\n  if (fullStr.length <= strLen) return fullStr;\n  const separator = '...';\n  const sepLen = separator.length;\n  const charsToShow = strLen - sepLen;\n  const frontChars = Math.ceil(charsToShow / 2);\n  const backChars = Math.floor(charsToShow / 2);\n  return fullStr.substr(0, frontChars) + separator + fullStr.substr(fullStr.length - backChars);\n};\n","import React, { useContext, useRef } from 'react';\nimport { FileMessage } from '@sendbird/chat/message';\nimport format from 'date-fns/format';\nimport './index.scss';\n\nimport Avatar from '../Avatar';\nimport ContextMenu, { MenuItems, MenuItem } from '../ContextMenu';\nimport Label, { LabelTypography, LabelColors } from '../Label';\nimport Loader from '../Loader';\nimport Icon, { IconTypes, IconColors } from '../Icon';\nimport IconButton from '../IconButton';\nimport TextButton from '../TextButton';\nimport UserProfile from '../UserProfile';\nimport { UserProfileContext } from '../../lib/UserProfileContext';\n\nimport { useLocalization } from '../../lib/LocalizationContext';\nimport { checkFileType, truncate } from './utils';\nimport {\n  checkIsByMe,\n  checkIsPending,\n  checkIsFailed,\n  isFineDelete,\n  isFineResend,\n  showMenuTrigger,\n} from '../../utils/openChannelUtils';\nimport { getSenderFromMessage } from '../../utils/openChannelUtils';\n\ninterface Props {\n  className?: string | Array<string>;\n  message: FileMessage;\n  userId: string;\n  disabled?: boolean;\n  chainTop?: boolean;\n  chainBottom?: boolean;\n  showRemove(bool: boolean): void;\n  resendMessage(message: FileMessage): void;\n}\n\nexport default function OpenchannelFileMessage({\n  className,\n  message,\n  userId,\n  disabled,\n  chainTop,\n  showRemove,\n  resendMessage,\n}: Props): JSX.Element {\n  const status = message?.sendingStatus;\n  const { dateLocale, stringSet } = useLocalization();\n  const contextMenuRef = useRef(null);\n  const avatarRef = useRef(null);\n  const { disableUserProfile, renderUserProfile } = useContext(UserProfileContext);\n\n  const openFileUrl = () => { window.open(message.url); };\n\n  const isByMe = checkIsByMe(message, userId);\n  const isPending = checkIsPending(status);\n  const isFailed = checkIsFailed(status);\n  const sender = getSenderFromMessage(message);\n\n  return (\n    <div\n      className={[\n        ...(Array.isArray(className) ? className : [className]),\n        'sendbird-openchannel-file-message',\n      ].join(' ')}\n    >\n      <div className=\"sendbird-openchannel-file-message__left\">\n        {\n            !chainTop && (\n              <ContextMenu\n                menuTrigger={(toggleDropdown) => (\n                  <Avatar\n                    className=\"sendbird-openchannel-file-message__left__avatar\"\n                    src={sender.profileUrl || ''}\n                    ref={avatarRef}\n                    width=\"28px\"\n                    height=\"28px\"\n                    onClick={() => {\n                      if (!disableUserProfile) {\n                        toggleDropdown();\n                      }\n                    }}\n                  />\n                )}\n                menuItems={(closeDropdown) => (\n                  <MenuItems\n                    parentRef={avatarRef}\n                    parentContainRef={avatarRef}\n                    closeDropdown={closeDropdown}\n                    style={{ paddingTop: 0, paddingBottom: 0 }}\n                  >\n                    {\n                      renderUserProfile\n                      ? (\n                        renderUserProfile({\n                          user: sender,\n                          close: closeDropdown,\n                        })\n                      )\n                      : (\n                        <UserProfile\n                          user={sender}\n                          onSuccess={closeDropdown}\n                          disableMessaging\n                        />\n                      )\n                    }\n                  </MenuItems>\n                )}\n              />\n            )\n          }\n      </div>\n      <div className=\"sendbird-openchannel-file-message__right\">\n        {\n          !chainTop && (\n            <div className=\"sendbird-openchannel-file-message__right__title\">\n              <Label\n                className=\"sendbird-openchannel-file-message__right__title__sender-name\"\n                type={LabelTypography.CAPTION_2}\n                color={isByMe ? LabelColors.SECONDARY_3 : LabelColors.ONBACKGROUND_2}\n              >\n                {\n                  sender && (\n                    sender.friendName\n                    || sender.nickname\n                    || sender.userId\n                  )\n                }\n              </Label>\n              <Label\n                className=\"sendbird-openchannel-file-message__right__title__sent-at\"\n                type={LabelTypography.CAPTION_3}\n                color={LabelColors.ONBACKGROUND_3}\n              >\n                {\n                  message?.createdAt && (\n                    format(message.createdAt, 'p', {\n                      locale: dateLocale,\n                    })\n                  )\n                }\n              </Label>\n            </div>\n          )\n        }\n        <div className=\"sendbird-openchannel-file-message__right__body\">\n          {\n            checkFileType(message.url) && (\n              <Icon\n                className=\"sendbird-openchannel-file-message__right__body__icon\"\n                type={checkFileType(message.url)}\n                fillColor={IconColors.PRIMARY}\n                width=\"48px\"\n                height=\"48px\"\n              />\n            )\n          }\n          <TextButton\n            className=\"sendbird-openchannel-file-message__right__body__file-name\"\n            onClick={openFileUrl}\n          >\n            <Label\n              type={LabelTypography.BODY_1}\n              color={LabelColors.ONBACKGROUND_1}\n            >\n              {truncate(message.name || message.url, 40)}\n            </Label>\n          </TextButton>\n        </div>\n        {\n          (isPending || isFailed) && (\n            <div className=\"sendbird-openchannel-file-message__right__tail\">\n              {\n                isPending && (\n                  <Loader\n                    width=\"16px\"\n                    height=\"16px\"\n                  >\n                    <Icon\n                      className=\"sendbird-openchannel-file-message__right__tail__pending\"\n                      type={IconTypes.SPINNER}\n                      fillColor={IconColors.PRIMARY}\n                      width=\"16px\"\n                      height=\"16px\"\n                    />\n                  </Loader>\n                )\n              }\n              {\n                isFailed && (\n                  <Icon\n                    className=\"sendbird-openchannel-file-message__right__tail__failed\"\n                    type={IconTypes.ERROR}\n                    fillColor={IconColors.ERROR}\n                    width=\"16px\"\n                    height=\"16px\"\n                  />\n                )\n              }\n            </div>\n          )\n        }\n      </div>\n      <div\n        className=\"sendbird-openchannel-file-message__context-menu\"\n        ref={contextMenuRef}\n      >\n        {\n            <ContextMenu\n              menuTrigger={(toggleDropdown) => (\n                showMenuTrigger({ message, userId, status }) && (\n                  <IconButton\n                    className=\"sendbird-openchannel-file-message__context-menu__icon\"\n                    width=\"32px\"\n                    height=\"32px\"\n                    onClick={toggleDropdown}\n                  >\n                    <Icon\n                      type={IconTypes.MORE}\n                      width=\"24px\"\n                      height=\"24px\"\n                    />\n                  </IconButton>\n                )\n              )}\n              menuItems={(closeDropdown) => (\n                <MenuItems\n                  parentRef={contextMenuRef}\n                  parentContainRef={contextMenuRef}\n                  closeDropdown={closeDropdown}\n                  openLeft\n                >\n                  {\n                    isFineResend({ message, userId, status }) && (\n                      <MenuItem\n                        onClick={() => {\n                          if (disabled) { return; }\n                          resendMessage(message);\n                          closeDropdown();\n                        }}\n                      >\n                        {stringSet.CONTEXT_MENU_DROPDOWN__RESEND}\n                      </MenuItem>\n                    )\n                  }\n                  {\n                    isFineDelete({ message, userId, status }) && (\n                      <MenuItem\n                        onClick={() => {\n                          if (disabled) { return; }\n                          showRemove(true);\n                          closeDropdown();\n                        }}\n                      >\n                        {stringSet.CONTEXT_MENU_DROPDOWN__DELETE}\n                      </MenuItem>\n                    )\n                  }\n                </MenuItems>\n              )}\n            />\n        }\n      </div>\n    </div>\n  );\n}\n"],"names":["checkFileType","fileUrl","audioFile","gifFile","test","IconTypes","FILE_AUDIO","GIF","FILE_DOCUMENT","truncate","fullStr","strLen","undefined","length","separator","sepLen","charsToShow","frontChars","Math","ceil","backChars","floor","substr","OpenchannelFileMessage","_a","className","message","userId","disabled","chainTop","showRemove","resendMessage","status","sendingStatus","_b","useLocalization","dateLocale","stringSet","contextMenuRef","useRef","avatarRef","_c","useContext","UserProfileContext","disableUserProfile","renderUserProfile","openFileUrl","window","open","url","isByMe","checkIsByMe","isPending","checkIsPending","isFailed","checkIsFailed","sender","getSenderFromMessage","React","__spreadArray","Array","isArray","join","toggleDropdown","profileUrl","closeDropdown","paddingTop","paddingBottom","user","close","UserProfile","LabelTypography","CAPTION_2","LabelColors","SECONDARY_3","ONBACKGROUND_2","friendName","nickname","CAPTION_3","ONBACKGROUND_3","createdAt","format","locale","IconColors","PRIMARY","BODY_1","ONBACKGROUND_1","name","SPINNER","ERROR","showMenuTrigger","MORE","isFineResend","CONTEXT_MENU_DROPDOWN__RESEND","isFineDelete","CONTEXT_MENU_DROPDOWN__DELETE"],"mappings":"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"}