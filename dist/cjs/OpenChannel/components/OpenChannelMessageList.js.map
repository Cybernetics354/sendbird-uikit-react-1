{"version":3,"file":"OpenChannelMessageList.js","sources":["../../../../src/smart-components/OpenChannel/components/OpenChannelMessageList/index.tsx"],"sourcesContent":["import './openchannel-message-list.scss';\n\nimport React, { ReactElement, useRef, useState, useMemo } from 'react';\nimport isSameDay from 'date-fns/isSameDay';\n\nimport Icon, { IconTypes, IconColors } from '../../../../ui/Icon';\n\nimport PlaceHolder, { PlaceHolderTypes } from '../../../../ui/PlaceHolder';\nimport { compareMessagesForGrouping } from '../../context/utils';\nimport { useOpenChannelContext } from '../../context/OpenChannelProvider';\nimport OpenChannelMessage from '../OpenChannelMessage';\nimport { RenderMessageProps } from '../../../../types';\nimport { FileMessage, UserMessage } from '@sendbird/chat/message';\n\nexport type OpenchannelMessageListProps = {\n  renderMessage?: (props: RenderMessageProps) => React.ElementType<RenderMessageProps>;\n  renderPlaceHolderEmptyList?: () => React.ReactElement;\n}\n\nfunction OpenchannelMessageList(\n  props: OpenchannelMessageListProps,\n  ref: React.RefObject<HTMLDivElement>,\n): ReactElement {\n  const {\n    isMessageGroupingEnabled = true,\n    allMessages,\n    hasMore,\n    onScroll,\n  } = useOpenChannelContext();\n  const scrollRef = ref || useRef(null);\n  const [showScrollDownButton, setShowScrollDownButton] = useState(false);\n\n  const handleOnScroll = (e) => {\n    const element = e.target;\n    const {\n      scrollTop,\n      scrollHeight,\n      clientHeight,\n    } = element;\n    if (scrollHeight > scrollTop + clientHeight + 1) {\n      setShowScrollDownButton(true);\n    } else {\n      setShowScrollDownButton(false);\n    }\n\n    if (!hasMore) {\n      return;\n    }\n    if (scrollTop === 0) {\n      const nodes = scrollRef.current.querySelectorAll('.sendbird-msg--scroll-ref');\n      const first = nodes && nodes[0];\n      onScroll(() => {\n        try {\n          first.scrollIntoView();\n        } catch (error) { }\n      });\n    }\n  };\n\n  const scrollToBottom = () => {\n    if (scrollRef && scrollRef.current) {\n      scrollRef.current.scrollTo(0, scrollRef.current.scrollHeight);\n      setShowScrollDownButton(false);\n    }\n  };\n\n  const hasMessage = useMemo(() => {\n    return allMessages.length > 0;\n  }, [allMessages.length]);\n\n  return (\n    <div className=\"sendbird-openchannel-conversation-scroll\">\n      <div className=\"sendbird-openchannel-conversation-scroll__container\">\n        <div className=\"sendbird-openchannel-conversation-scroll__container__padding\" />\n        <div\n          className={[\n            'sendbird-openchannel-conversation-scroll__container__item-container',\n            hasMessage ? '' : 'no-messages',\n          ].join(' ')}\n          onScroll={handleOnScroll}\n          ref={scrollRef}\n        >\n          {\n            hasMessage\n              ? (\n                allMessages.map((message, index) => {\n                  const previousMessage = allMessages[index - 1];\n                  const nextMessage = allMessages[index - 1];\n\n                  const previousMessageCreatedAt = previousMessage && previousMessage.createdAt;\n                  const currentCreatedAt = message.createdAt;\n                  // https://stackoverflow.com/a/41855608\n                  const hasSeparator = !(previousMessageCreatedAt && (\n                    isSameDay(currentCreatedAt, previousMessageCreatedAt)\n                  ));\n\n                  const [chainTop, chainBottom] = isMessageGroupingEnabled\n                    ? compareMessagesForGrouping(previousMessage, message, nextMessage)\n                    : [false, false];\n                  return (\n                    <OpenChannelMessage\n                      key={message?.messageId || (message as UserMessage | FileMessage)?.reqId}\n                      message={message}\n                      chainTop={chainTop}\n                      chainBottom={chainBottom}\n                      hasSeparator={hasSeparator}\n                      renderMessage={props?.renderMessage}\n                    />\n                  )\n                })\n              )\n              : props?.renderPlaceHolderEmptyList?.() || (\n                <PlaceHolder\n                  className=\"sendbird-openchannel-conversation-scroll__container__place-holder\"\n                  type={PlaceHolderTypes.NO_MESSAGES}\n                />\n              )\n          }\n        </div>\n      </div>\n      {\n        showScrollDownButton && (\n          <div\n            className=\"sendbird-openchannel-conversation-scroll__container__scroll-bottom-button\"\n            onClick={scrollToBottom}\n            onKeyDown={scrollToBottom}\n            tabIndex={0}\n            role=\"button\"\n          >\n            <Icon\n              width=\"24px\"\n              height=\"24px\"\n              type={IconTypes.CHEVRON_DOWN}\n              fillColor={IconColors.CONTENT}\n            />\n          </div>\n        )\n      }\n    </div>\n  );\n}\n\nexport default React.forwardRef(OpenchannelMessageList);\n"],"names":["OpenchannelMessageList","props","ref","_b","useOpenChannelContext","_c","isMessageGroupingEnabled","allMessages","hasMore","onScroll","scrollRef","useRef","_d","useState","showScrollDownButton","setShowScrollDownButton","handleOnScroll","e","element","target","scrollTop","scrollHeight","clientHeight","nodes","current","querySelectorAll","first_1","scrollIntoView","error","scrollToBottom","scrollTo","hasMessage","useMemo","length","React","join","map","message","index","previousMessage","nextMessage","previousMessageCreatedAt","createdAt","currentCreatedAt","hasSeparator","isSameDay","_a","compareMessagesForGrouping","chainTop","chainBottom","OpenChannelMessage","messageId","reqId","renderMessage","renderPlaceHolderEmptyList","PlaceHolder","PlaceHolderTypes","NO_MESSAGES","Icon","IconTypes","CHEVRON_DOWN","IconColors","CONTENT","forwardRef"],"mappings":"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"}