{"version":3,"file":"Message.js","sources":["../../../../src/smart-components/Channel/components/Message/index.tsx"],"sourcesContent":["import React, {\n  useRef,\n  useMemo,\n  useState,\n  useEffect,\n  useLayoutEffect,\n} from 'react';\nimport type { FileMessage } from '@sendbird/chat/message';\nimport format from 'date-fns/format';\n\nimport SuggestedMentionList from '../SuggestedMentionList';\nimport useSendbirdStateContext from '../../../../hooks/useSendbirdStateContext';\nimport { useChannelContext } from '../../context/ChannelProvider';\nimport { getClassName } from '../../../../utils';\nimport { isDisabledBecauseFrozen, isDisabledBecauseMuted } from '../../context/utils';\nimport { MAX_USER_MENTION_COUNT, MAX_USER_SUGGESTION_COUNT } from '../../context/const';\n\nimport DateSeparator from '../../../../ui/DateSeparator';\nimport Label, { LabelTypography, LabelColors } from '../../../../ui/Label';\nimport MessageInput from '../../../../ui/MessageInput';\nimport MessageContent from '../../../../ui/MessageContent';\nimport FileViewer from '../FileViewer';\nimport RemoveMessageModal from '../RemoveMessageModal';\nimport { MessageInputKeys } from '../../../../ui/MessageInput/const';\nimport { EveryMessage, RenderMessageProps } from '../../../../types';\nimport { useLocalization } from '../../../../lib/LocalizationContext';\n\ntype MessageUIProps = {\n  message: EveryMessage;\n  hasSeparator?: boolean;\n  chainTop?: boolean;\n  chainBottom?: boolean;\n  handleScroll: () => void;\n  // for extending\n  renderMessage?: (props: RenderMessageProps) => React.ReactElement;\n  renderCustomSeparator?: () => React.ReactElement;\n  renderEditInput?: () => React.ReactElement;\n  renderMessageContent?: () => React.ReactElement;\n};\n\nconst Message = (props: MessageUIProps): React.FC<MessageUIProps> | React.ReactElement => {\n  const {\n    message,\n    hasSeparator,\n    chainTop,\n    chainBottom,\n    handleScroll,\n    renderCustomSeparator,\n    renderEditInput,\n    renderMessage,\n    renderMessageContent,\n  } = props;\n\n  const { dateLocale } = useLocalization();\n  const globalStore = useSendbirdStateContext();\n  const {\n    userId,\n    isOnline,\n    isMentionEnabled,\n    userMention,\n  } = globalStore?.config;\n  const maxUserMentionCount = userMention?.maxMentionCount || MAX_USER_MENTION_COUNT;\n  const maxUserSuggestionCount = userMention?.maxSuggestionCount || MAX_USER_SUGGESTION_COUNT;\n\n  const {\n    initialized,\n    currentGroupChannel,\n    highLightedMessageId,\n    setHighLightedMessageId,\n    animatedMessageId,\n    setAnimatedMessageId,\n    updateMessage,\n    scrollToMessage,\n    replyType,\n    isReactionEnabled,\n    toggleReaction,\n    emojiContainer,\n    nicknamesMap,\n    setQuoteMessage,\n    resendMessage,\n    renderUserMentionItem,\n  } = useChannelContext();\n\n  const [showEdit, setShowEdit] = useState(false);\n  const [showRemove, setShowRemove] = useState(false);\n  const [showFileViewer, setShowFileViewer] = useState(false);\n  const [isAnimated, setIsAnimated] = useState(false);\n  const [isHighlighted, setIsHighlighted] = useState(false);\n  const [mentionNickname, setMentionNickname] = useState('');\n  const [mentionedUsers, setMentionedUsers] = useState([]);\n  const [mentionedUserIds, setMentionedUserIds] = useState([]);\n  const [messageInputEvent, setMessageInputEvent] = useState(null);\n  const [selectedUser, setSelectedUser] = useState(null);\n  const [mentionSuggestedUsers, setMentionSuggestedUsers] = useState([]);\n  const [ableMention, setAbleMention] = useState(true);\n  const editMessageInputRef = useRef(null);\n  const useMessageScrollRef = useRef(null);\n  const displaySuggestedMentionList = isOnline\n    && isMentionEnabled\n    && mentionNickname.length > 0\n    && !isDisabledBecauseFrozen(currentGroupChannel)\n    && !isDisabledBecauseMuted(currentGroupChannel);\n  const disabled = !initialized\n    || isDisabledBecauseFrozen(currentGroupChannel)\n    || isDisabledBecauseMuted(currentGroupChannel)\n    || !isOnline;\n\n  useEffect(() => {\n    if (mentionedUsers?.length >= maxUserMentionCount) {\n      setAbleMention(false);\n    } else {\n      setAbleMention(true);\n    }\n  }, [mentionedUsers]);\n\n  useEffect(() => {\n    setMentionedUsers(mentionedUsers.filter(({ userId }) => {\n      const i = mentionedUserIds.indexOf(userId);\n      if (i < 0) {\n        return false;\n      } else {\n        mentionedUserIds.splice(i, 1);\n        return true;\n      }\n    }));\n  }, [mentionedUserIds]);\n\n  useLayoutEffect(() => {\n    handleScroll?.();\n  }, [showEdit, message?.reactions?.length]);\n\n  useLayoutEffect(() => {\n    if (highLightedMessageId === message.messageId) {\n      if (useMessageScrollRef && useMessageScrollRef.current) {\n        useMessageScrollRef.current.scrollIntoView({ block: 'center', inline: 'center' });\n        setIsAnimated(false);\n        setTimeout(() => {\n          setIsHighlighted(true);\n        }, 500);\n        setTimeout(() => {\n          setHighLightedMessageId(0);\n        }, 1600);\n      }\n    } else {\n      setIsHighlighted(false);\n    }\n  }, [highLightedMessageId, useMessageScrollRef.current, message.messageId]);\n\n  useLayoutEffect(() => {\n    if (animatedMessageId === message.messageId) {\n      if (useMessageScrollRef && useMessageScrollRef.current) {\n        useMessageScrollRef.current.scrollIntoView({ block: 'center', inline: 'center' });\n        setIsHighlighted(false);\n        setTimeout(() => {\n          setIsAnimated(true);\n        }, 500);\n        setTimeout(() => {\n          setAnimatedMessageId(0);\n        }, 1600);\n      }\n    } else {\n      setIsAnimated(false);\n    }\n  }, [animatedMessageId, useMessageScrollRef.current, message.messageId]);\n  const renderedMessage = useMemo(() => {\n    return renderMessage?.({\n      message,\n      chainTop,\n      chainBottom,\n    });\n  }, [message, renderMessage]);\n  const renderedCustomSeparator = useMemo(() => {\n    if (renderCustomSeparator) {\n      return renderCustomSeparator?.();\n    }\n    return null;\n  }, [message, renderCustomSeparator]);\n\n  if (renderedMessage) {\n    return (\n      <div\n        ref={useMessageScrollRef}\n        className={getClassName([\n          'sendbird-msg-hoc sendbird-msg--scroll-ref',\n          isAnimated ? 'sendbird-msg-hoc__animated' : '',\n          isHighlighted ? 'sendbird-msg-hoc__highlighted' : '',\n        ])}\n      >\n        {/* date-separator */}\n        {\n          // TODO: Add message instance as a function parameter\n          hasSeparator && (renderedCustomSeparator || (\n            <DateSeparator>\n              <Label type={LabelTypography.CAPTION_2} color={LabelColors.ONBACKGROUND_2}>\n                {format(message.createdAt, 'MMMM dd, yyyy', {\n                  locale: dateLocale,\n                })}\n              </Label>\n            </DateSeparator>\n          ))\n        }\n        {renderedMessage}\n      </div>\n    );\n  }\n\n  if (showEdit && message.isUserMessage()) {\n    return renderEditInput?.() || (\n      <>\n        {\n          displaySuggestedMentionList && (\n            <SuggestedMentionList\n              targetNickname={mentionNickname}\n              inputEvent={messageInputEvent}\n              renderUserMentionItem={renderUserMentionItem}\n              onUserItemClick={(user) => {\n                if (user) {\n                  setMentionedUsers([...mentionedUsers, user]);\n                }\n                setMentionNickname('');\n                setSelectedUser(user);\n                setMessageInputEvent(null);\n              }}\n              onFocusItemChange={() => {\n                setMessageInputEvent(null);\n              }}\n              onFetchUsers={(users) => {\n                setMentionSuggestedUsers(users);\n              }}\n              ableAddMention={ableMention}\n              maxMentionCount={maxUserMentionCount}\n              maxSuggestionCount={maxUserSuggestionCount}\n            />\n          )\n        }\n        <MessageInput\n          isEdit\n          disabled={disabled}\n          ref={editMessageInputRef}\n          mentionSelectedUser={selectedUser}\n          isMentionEnabled={isMentionEnabled}\n          message={message}\n          onUpdateMessage={({ messageId, message, mentionTemplate }) => {\n            updateMessage({\n              messageId,\n              message,\n              mentionedUsers,\n              mentionTemplate,\n            });\n            setShowEdit(false);\n          }}\n          onCancelEdit={() => {\n            setMentionNickname('');\n            setMentionedUsers([]);\n            setMentionedUserIds([]);\n            setMentionSuggestedUsers([])\n            setShowEdit(false);\n          }}\n          onUserMentioned={(user) => {\n            if (selectedUser?.userId === user?.userId) {\n              setSelectedUser(null);\n              setMentionNickname('');\n            }\n          }}\n          onMentionStringChange={(mentionText) => {\n            setMentionNickname(mentionText);\n          }}\n          onMentionedUserIdsUpdated={(userIds) => {\n            setMentionedUserIds(userIds);\n          }}\n          onKeyDown={(e) => {\n            if (displaySuggestedMentionList && mentionSuggestedUsers?.length > 0\n              && ((e.key === MessageInputKeys.Enter && ableMention) || e.key === MessageInputKeys.ArrowUp || e.key === MessageInputKeys.ArrowDown)\n            ) {\n              setMessageInputEvent(e);\n              return true;\n            }\n            return false;\n          }}\n        />\n      </>\n    );\n  }\n\n  return (\n    <div\n      className={getClassName([\n        'sendbird-msg-hoc sendbird-msg--scroll-ref',\n        isAnimated ? 'sendbird-msg-hoc__animated' : '',\n        isHighlighted ? 'sendbird-msg-hoc__highlighted' : '',\n      ])}\n      style={{ marginBottom: '2px' }}\n      ref={useMessageScrollRef}\n    >\n      {/* date-separator */}\n      {\n        hasSeparator && (renderedCustomSeparator || (\n          <DateSeparator>\n            <Label type={LabelTypography.CAPTION_2} color={LabelColors.ONBACKGROUND_2}>\n              {format(message.createdAt, 'MMMM dd, yyyy', {\n                locale: dateLocale,\n              })}\n            </Label>\n          </DateSeparator>\n        ))\n      }\n      {/* Message */}\n      {\n        renderMessageContent?.() || (\n          <MessageContent\n            className=\"sendbird-message-hoc__message-content\"\n            userId={userId}\n            scrollToMessage={scrollToMessage}\n            channel={currentGroupChannel}\n            message={message}\n            disabled={!isOnline}\n            chainTop={chainTop}\n            chainBottom={chainBottom}\n            isReactionEnabled={isReactionEnabled}\n            replyType={replyType}\n            nicknamesMap={nicknamesMap}\n            emojiContainer={emojiContainer}\n            showEdit={setShowEdit}\n            showRemove={setShowRemove}\n            showFileViewer={setShowFileViewer}\n            resendMessage={resendMessage}\n            toggleReaction={toggleReaction}\n            setQuoteMessage={setQuoteMessage}\n          />\n        )\n      }\n      {/* Modal */}\n      {\n        showRemove && (\n          <RemoveMessageModal\n            message={message}\n            onCancel={() => setShowRemove(false)}\n          />\n        )\n      }\n      {\n        showFileViewer && (\n          <FileViewer\n            message={message as FileMessage}\n            onCancel={() => setShowFileViewer(false)}\n          />\n        )\n      }\n    </div>\n  );\n};\n\nexport default Message;\n"],"names":["Message","props","message","hasSeparator","chainTop","chainBottom","handleScroll","renderCustomSeparator","renderEditInput","renderMessage","renderMessageContent","dateLocale","useLocalization","globalStore","useSendbirdStateContext","_b","config","userId","isOnline","isMentionEnabled","userMention","maxUserMentionCount","maxMentionCount","MAX_USER_MENTION_COUNT","maxUserSuggestionCount","maxSuggestionCount","MAX_USER_SUGGESTION_COUNT","_c","useChannelContext","initialized","currentGroupChannel","highLightedMessageId","setHighLightedMessageId","animatedMessageId","setAnimatedMessageId","updateMessage","scrollToMessage","replyType","isReactionEnabled","toggleReaction","emojiContainer","nicknamesMap","setQuoteMessage","resendMessage","renderUserMentionItem","_d","useState","showEdit","setShowEdit","_e","showRemove","setShowRemove","_f","showFileViewer","setShowFileViewer","_g","isAnimated","setIsAnimated","_h","isHighlighted","setIsHighlighted","_j","mentionNickname","setMentionNickname","_k","mentionedUsers","setMentionedUsers","_l","mentionedUserIds","setMentionedUserIds","_m","messageInputEvent","setMessageInputEvent","_o","selectedUser","setSelectedUser","_p","mentionSuggestedUsers","setMentionSuggestedUsers","_q","ableMention","setAbleMention","editMessageInputRef","useRef","useMessageScrollRef","displaySuggestedMentionList","length","isDisabledBecauseFrozen","isDisabledBecauseMuted","disabled","useEffect","filter","_a","i","indexOf","splice","useLayoutEffect","reactions","messageId","current","scrollIntoView","block","inline","setTimeout","renderedMessage","useMemo","renderedCustomSeparator","React","getClassName","DateSeparator","Label","LabelTypography","CAPTION_2","LabelColors","ONBACKGROUND_2","format","createdAt","locale","isUserMessage","SuggestedMentionList","user","__spreadArray","users","MessageInput","mentionTemplate","mentionText","userIds","e","key","MessageInputKeys","Enter","ArrowUp","ArrowDown","marginBottom","MessageContent","RemoveMessageModal","FileViewer"],"mappings":"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"}