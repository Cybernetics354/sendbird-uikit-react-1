{"version":3,"file":"MessageSearchUI.js","sources":["../../../../src/smart-components/MessageSearch/components/MessageSearchUI/index.tsx"],"sourcesContent":["import React, { useContext } from 'react';\nimport type { FileMessage, UserMessage } from '@sendbird/chat/message';\nimport './index.scss';\n\nimport { LocalizationContext } from '../../../../lib/LocalizationContext';\nimport { useMessageSearchContext } from '../../context/MessageSearchProvider';\n\nimport MessageSearchItem from '../../../../ui/MessageSearchItem';\nimport PlaceHolder, { PlaceHolderTypes } from '../../../../ui/PlaceHolder';\nimport MessageSearchFileItem from '../../../../ui/MessageSearchFileItem';\nimport { ClientSentMessages } from '../../../../types';\n\n\nconst COMPONENT_CLASS_NAME = 'sendbird-message-search';\n\nexport interface MessageSearchUIProps {\n  renderPlaceHolderError?: (props: void) => React.ReactNode;\n  renderPlaceHolderLoading?: (props: void) => React.ReactNode;\n  renderPlaceHolderNoString?: (props: void) => React.ReactNode;\n  renderPlaceHolderEmptyList?: (props: void) => React.ReactNode;\n  renderSearchItem?(\n    {\n      message,\n      onResultClick,\n    }: {\n      message: ClientSentMessages,\n      onResultClick?: (message: ClientSentMessages) => void,\n    }\n  ): JSX.Element;\n}\n\nexport const MessageSearchUI: React.FC<MessageSearchUIProps> = ({\n  renderPlaceHolderError,\n  renderPlaceHolderLoading,\n  renderPlaceHolderNoString,\n  renderPlaceHolderEmptyList,\n  renderSearchItem,\n}: MessageSearchUIProps) => {\n  const {\n    isInvalid,\n    searchString,\n    requestString,\n    currentChannel,\n    retryCount,\n    setRetryCount,\n    loading,\n    scrollRef,\n    hasMoreResult,\n    onScroll,\n    allMessages,\n    onResultClick,\n    selectedMessageId,\n    setSelectedMessageId,\n  } = useMessageSearchContext();\n\n  const { stringSet } = useContext(LocalizationContext);\n\n  const handleRetryToConnect = () => {\n    setRetryCount(retryCount + 1);\n  };\n\n  const handleOnScroll = (e) => {\n    const scrollElement = e.target;\n    const {\n      scrollTop,\n      scrollHeight,\n      clientHeight,\n    } = scrollElement;\n\n    if (!hasMoreResult) {\n      return;\n    }\n    if (scrollTop + clientHeight >= scrollHeight - 1) {\n      onScroll(() => {\n        // after load more searched messages\n      });\n    }\n  };\n\n  const getChannelName = () => {\n    if (currentChannel && currentChannel?.name && currentChannel?.name !== 'Group Channel') {\n      return currentChannel?.name;\n    }\n    if (currentChannel && (currentChannel?.name === 'Group Channel' || !currentChannel?.name)) {\n      return currentChannel.members.map((member) => member.nickname || stringSet.NO_NAME).join(', ');\n    }\n    return stringSet.NO_TITLE;\n  };\n\n  if (isInvalid && searchString && requestString) {\n    return renderPlaceHolderError?.() || (\n      <div className={COMPONENT_CLASS_NAME}>\n        <PlaceHolder\n          type={PlaceHolderTypes.WRONG}\n          retryToConnect={handleRetryToConnect}\n        />\n      </div>\n    );\n  }\n\n  if (loading && searchString && requestString) {\n    return renderPlaceHolderLoading?.() || (\n      <div className={COMPONENT_CLASS_NAME}>\n        <PlaceHolder type={PlaceHolderTypes.SEARCHING} />\n      </div>\n    );\n  }\n\n  if (!searchString) {\n    return renderPlaceHolderNoString?.() || (\n      <div className={COMPONENT_CLASS_NAME}>\n        <PlaceHolder\n          type={PlaceHolderTypes.SEARCH_IN}\n          searchInString={getChannelName()}\n        />\n      </div>\n    );\n  }\n\n  return (\n    <div\n      className={COMPONENT_CLASS_NAME}\n      onScroll={handleOnScroll}\n      ref={scrollRef}\n    >\n      {\n        (allMessages.length > 0)\n          ? (\n            allMessages.map((message) => {\n              if (renderSearchItem) {\n                return renderSearchItem({ message, onResultClick });\n              }\n              if (message.messageType === 'file') {\n                return (\n                  <MessageSearchFileItem\n                    className={`${COMPONENT_CLASS_NAME}__message-search-item`}\n                    message={message as FileMessage}\n                    key={message.messageId}\n                    selected={(selectedMessageId === message.messageId)}\n                    onClick={() => {\n                      onResultClick(message);\n                      setSelectedMessageId(message.messageId);\n                    }}\n                  />\n                );\n              }\n              return (\n                <MessageSearchItem\n                  className={`${COMPONENT_CLASS_NAME}__message-search-item`}\n                  message={message as UserMessage}\n                  key={message.messageId}\n                  selected={(selectedMessageId === message.messageId)}\n                  onClick={() => {\n                    onResultClick(message);\n                    setSelectedMessageId(message.messageId);\n                  }}\n                />\n              );\n            })\n          )\n          : renderPlaceHolderEmptyList?.() || (\n            <PlaceHolder type={PlaceHolderTypes.NO_RESULTS} />\n          )\n      }\n    </div>\n  );\n};\n\nexport default MessageSearchUI;\n"],"names":["COMPONENT_CLASS_NAME","MessageSearchUI","_a","renderPlaceHolderError","renderPlaceHolderLoading","renderPlaceHolderNoString","renderPlaceHolderEmptyList","renderSearchItem","_b","useMessageSearchContext","isInvalid","searchString","requestString","currentChannel","retryCount","setRetryCount","loading","scrollRef","hasMoreResult","onScroll","allMessages","onResultClick","selectedMessageId","setSelectedMessageId","stringSet","useContext","LocalizationContext","handleRetryToConnect","handleOnScroll","e","scrollElement","target","scrollTop","scrollHeight","clientHeight","getChannelName","name","members","map","member","nickname","NO_NAME","join","NO_TITLE","React","PlaceHolder","PlaceHolderTypes","WRONG","SEARCHING","SEARCH_IN","length","message","messageType","MessageSearchFileItem","messageId","MessageSearchItem","NO_RESULTS"],"mappings":"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"}