{"version":3,"file":"InviteUsers.js","sources":["../../../../src/smart-components/CreateChannel/components/InviteUsers/utils.ts","../../../../src/smart-components/CreateChannel/components/InviteUsers/index.tsx"],"sourcesContent":["import type { ApplicationUserListQuery } from \"@sendbird/chat\";\nimport type { GroupChannelCreateParams, SendbirdGroupChat } from \"@sendbird/chat/groupChannel\";\nimport { CHANNEL_TYPE } from \"../../types\";\n\nexport const filterUser = (idsToFilter: string[]) => (currentId: string): boolean => idsToFilter?.includes(currentId);\n\nexport const setChannelType = (\n  params: GroupChannelCreateParams,\n  type: CHANNEL_TYPE,\n): GroupChannelCreateParams => {\n  if (type === 'broadcast') {\n    // eslint-disable-next-line no-param-reassign\n    params.isBroadcast = true;\n  }\n  if (type === 'supergroup') {\n    // eslint-disable-next-line no-param-reassign\n    params.isSuper = true;\n  }\n  return params;\n};\n\ntype CreateDefaultUserListQueryType = {\n  sdk: SendbirdGroupChat;\n  userFilledApplicationUserListQuery?: ApplicationUserListQuery;\n}\n\nexport const createDefaultUserListQuery = (\n  { sdk, userFilledApplicationUserListQuery }: CreateDefaultUserListQueryType\n): ApplicationUserListQuery => {\n  const params = sdk.createApplicationUserListQuery();\n  if (userFilledApplicationUserListQuery) {\n    Object.keys(userFilledApplicationUserListQuery).forEach((key) => {\n      params[key] = userFilledApplicationUserListQuery[key];\n    });\n  }\n  return params;\n};\n","import React, { useState, useEffect, useContext } from 'react';\nimport type { ApplicationUserListQuery } from '@sendbird/chat';\n\nimport './invite-users.scss';\nimport { LocalizationContext } from '../../../../lib/LocalizationContext';\nimport { useCreateChannelContext } from '../../context/CreateChannelProvider';\nimport useSendbirdStateContext from '../../../../hooks/useSendbirdStateContext';\nimport type { GroupChannelCreateParams, SendbirdGroupChat } from '@sendbird/chat/groupChannel';\n\nimport Modal from '../../../../ui/Modal';\nimport Label, {\n  LabelColors,\n  LabelTypography,\n} from '../../../../ui/Label';\nimport { ButtonTypes } from '../../../../ui/Button';\nimport UserListItem from '../../../../ui/UserListItem';\n\nimport {\n  filterUser,\n  setChannelType,\n  createDefaultUserListQuery,\n} from './utils';\n\nexport interface InviteUsersProps {\n  onCancel?: () => void;\n}\n\nconst InviteUsers: React.FC<InviteUsersProps> = ({ onCancel }: InviteUsersProps) => {\n  const {\n    onBeforeCreateChannel,\n    onCreateChannel,\n    createChannel,\n    type,\n  } = useCreateChannelContext();\n\n  const globalStore = useSendbirdStateContext();\n  const userId = globalStore?.config?.userId;\n  const sdk = globalStore?.stores?.sdkStore?.sdk as SendbirdGroupChat;\n  const idsToFilter = [userId];\n  const [users, setUsers] = useState([]);\n  const [selectedUsers, setSelectedUsers] = useState({});\n  const { stringSet } = useContext(LocalizationContext);\n  const [usersDataSource, setUsersDataSource] = useState<ApplicationUserListQuery>(null);\n  const selectedCount = Object.keys(selectedUsers).length;\n  const titleText = stringSet.MODAL__CREATE_CHANNEL__TITLE;\n  const submitText = stringSet.BUTTON__CREATE;\n\n  const userQueryCreator = createDefaultUserListQuery({ sdk });\n\n  useEffect(() => {\n    const applicationUserListQuery = userQueryCreator;\n    setUsersDataSource(applicationUserListQuery);\n    applicationUserListQuery.next().then((users_) => {\n      setUsers(users_);\n    });\n  }, []);\n\n  return (\n    <Modal\n      titleText={titleText}\n      submitText={submitText}\n      type={ButtonTypes.PRIMARY}\n      onCancel={onCancel}\n      onSubmit={() => {\n        const selectedUserList = Object.keys(selectedUsers);\n        if (selectedUserList.length > 0) {\n          if (onBeforeCreateChannel) {\n            const params = onBeforeCreateChannel(selectedUserList);\n            setChannelType(params, type);\n            createChannel(params).then((channel) => {\n              onCreateChannel(channel);\n            });\n          } else {\n            const params: GroupChannelCreateParams = {};\n            params.invitedUserIds = selectedUserList;\n            params.isDistinct = false;\n            if (userId) {\n              params.operatorUserIds = [userId];\n            }\n            setChannelType(params, type);\n            // do not have custom params\n            createChannel(params).then((channel) => {\n              onCreateChannel(channel);\n            });\n          }\n          onCancel();\n        }\n      }}\n    >\n      <div>\n        <Label\n          color={(selectedCount > 0) ? LabelColors.PRIMARY : LabelColors.ONBACKGROUND_3}\n          type={LabelTypography.CAPTION_1}\n        >\n          {`${selectedCount} ${stringSet.MODAL__INVITE_MEMBER__SELECTEC}`}\n        </Label>\n        <div\n          className=\"sendbird-create-channel--scroll\"\n          onScroll={(e) => {\n            const eventTarget = e.target as HTMLDivElement;\n            const { hasNext } = usersDataSource;\n            const fetchMore = (\n              eventTarget.clientHeight + eventTarget.scrollTop === eventTarget.scrollHeight\n            );\n\n            if (hasNext && fetchMore) {\n              usersDataSource.next().then((usersBatch) => {\n                setUsers([\n                  ...users,\n                  ...usersBatch,\n                ]);\n              });\n            }\n          }}\n        >\n          {\n            users.map((user) => (!filterUser(idsToFilter)(user.userId)) && (\n              <UserListItem\n                key={user.userId}\n                user={user}\n                checkBox\n                checked={selectedUsers[user.userId]}\n                onChange={\n                  (event) => {\n                    const modifiedSelectedUsers = {\n                      ...selectedUsers,\n                      [event.target.id]: event.target.checked,\n                    };\n                    if (!event.target.checked) {\n                      delete modifiedSelectedUsers[event.target.id];\n                    }\n                    setSelectedUsers(modifiedSelectedUsers);\n                  }\n                }\n              />\n            ))\n          }\n        </div>\n      </div>\n    </Modal>\n  );\n};\n\nexport default InviteUsers;\n"],"names":["filterUser","idsToFilter","currentId","includes","setChannelType","params","type","isBroadcast","isSuper","createDefaultUserListQuery","_a","sdk","userFilledApplicationUserListQuery","createApplicationUserListQuery","Object","keys","forEach","key","InviteUsers","onCancel","_e","useCreateChannelContext","onBeforeCreateChannel","onCreateChannel","createChannel","globalStore","useSendbirdStateContext","userId","_b","config","_d","_c","stores","sdkStore","_f","useState","users","setUsers","_g","selectedUsers","setSelectedUsers","stringSet","useContext","LocalizationContext","_h","usersDataSource","setUsersDataSource","selectedCount","length","titleText","MODAL__CREATE_CHANNEL__TITLE","submitText","BUTTON__CREATE","userQueryCreator","useEffect","applicationUserListQuery","next","then","users_","React","Modal","ButtonTypes","PRIMARY","selectedUserList","channel","invitedUserIds","isDistinct","operatorUserIds","Label","LabelColors","ONBACKGROUND_3","LabelTypography","CAPTION_1","concat","MODAL__INVITE_MEMBER__SELECTEC","e","eventTarget","target","hasNext","fetchMore","clientHeight","scrollTop","scrollHeight","usersBatch","__spreadArray","map","user","UserListItem","event","modifiedSelectedUsers","__assign","id","checked"],"mappings":"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"}