import { t, r, E, y, b as bn$1, s, a as n, o, c as b, R, S as St$1, d as a, D as Dn$1, e as c, M as Me$1, j, p, f as at$1, C as Cn$2, g as ot$1, h as ct$1, Y, L as Le$1, i as M, k as i, l as d, U as Ue$1, m as U, q, F, z, v as ze$1, K as Ke$1, w as pe, B, x as be, A as te, G as me, I as Ie, $, H as lt$1, J as dt$1, N as A, O as N, P as ve, W, V, Q as $$1, T as K, X as J, Z as X, _ as se, a0 as Z, a1 as ce, a2 as oe, a3 as he, a4 as ue, a5 as S, a6 as B$1, a7 as m, a8 as Ee, a9 as _e, aa as ye, ab as H, ac as Ae$1, ad as q$1, ae as On$1, af as kt$1, ag as st$1, ah as Tt$1, ai as Ge$1, aj as xe, ak as H$1, n as ne, al as U$1, am as de, an as J$1, ao as h, ap as tt$1, aq as je$1, ar as pt$1, as as _, at as ct$2, au as dt$2, av as at$2, aw as ot$2, ax as d$1, ay as C, az as h$1, aA as T, aB as H$2, aC as Mt$1, aD as Tt$2, aE as It$1, aF as c$1, aG as gt$1, aH as Jt$1, aI as A$1, aJ as En$2 } from './__bundle-ba710a09-d0f8c8de.js';

var Re={profileImage:null,profileUrl:null,nickname:null},Le=function(){this.onSessionExpired=Y,this.onSessionTokenRequired=function(e){return e(null)},this.onSessionError=Y,this.onSessionRefreshed=Y,this.onSessionClosed=Y;},Pe=function(){this.onConnected=Y,this.onReconnectStarted=Y,this.onReconnectSucceeded=Y,this.onReconnectFailed=Y,this.onDisconnected=Y;},Ae=function(){this.onFriendsDiscovered=Y,this.onTotalUnreadMessageCountUpdated=Y;};!function(e){function t$1(){return null!==e&&e.apply(this,arguments)||this}t(t$1,e);}(Le$1);var De=function(e){function t$1(){var t=e.call(this)||this;return t._pauseDelayTimer=null,t._currentState="visible",t._toggleState=t._toggleState.bind(t),t}return t(t$1,e),Object.defineProperty(t$1.prototype,"isAvailable",{get:function(){return "undefined"!=typeof window&&!!window.addEventListener&&!!window.removeEventListener},enumerable:!1,configurable:!0}),t$1.prototype._toggleState=function(){var e=this;"hidden"!==document.visibilityState?"hidden"===this._currentState&&(this._pauseDelayTimer&&(clearTimeout(this._pauseDelayTimer),this._pauseDelayTimer=null),this.dispatch("resume")):"hidden"!==this._currentState&&(this._pauseDelayTimer=setTimeout((function(){e._pauseDelayTimer=null,e.dispatch("pause");}),3e4)),this._currentState=document.visibilityState;},t$1.prototype.start=function(){this.isAvailable&&window.addEventListener("visibilitychange",this._toggleState,{capture:!0});},t$1.prototype.stop=function(){this.isAvailable&&window.removeEventListener("visibilitychange",this._toggleState,{capture:!0});},t$1}(M),Me=function(){function e(e){var t=e.logger,n=e.connectionDelegate,r=void 0===n?null:n;this.logger=t,r&&(this.connectionDelegate=r),this._onlineWorker=this._onlineWorker.bind(this),this._offlineWorker=this._offlineWorker.bind(this);}return Object.defineProperty(e.prototype,"isAvailable",{get:function(){return "undefined"!=typeof window&&window.addEventListener&&"ononline"in window&&"onoffline"in window&&"undefined"!=typeof navigator&&void 0!==navigator.onLine},enumerable:!1,configurable:!0}),e.prototype._onlineWorker=function(){this.connectionDelegate.reconnect();},e.prototype._offlineWorker=function(){this.connectionDelegate.disconnect();},e.prototype.start=function(){this.isAvailable&&(window.addEventListener("online",this._onlineWorker),window.addEventListener("offline",this._offlineWorker));},e.prototype.stop=function(){this.isAvailable&&(window.removeEventListener("online",this._onlineWorker,!1),window.removeEventListener("offline",this._offlineWorker,!1));},e.prototype.isOnline=function(){return r(this,void 0,void 0,(function(){return i(this,(function(e){return this.isAvailable?[2,navigator.onLine]:[2,new Promise((function(e,t){fetch("https://www.google.com",{method:d.GET}).then((function(){return e(!0)})).catch((function(){return e(!1)}));}))]}))}))},e}(),Ue=function(e){function t$1(t){var n=t.userId,r=t.nickname,i=void 0===r?null:r,s=t.profileUrl,o=void 0===s?null:s,a=t.profileImage,u=void 0===a?null:a,c=t.preferredLanguages,l=void 0===c?null:c,h=e.call(this)||this;return h.method=d.PUT,h.path="".concat(Ue$1,"/").concat(encodeURIComponent(n)),h.params=U({nickname:i,profile_url:o,profile_file:u,preferred_languages:l}),h}return t(t$1,e),t$1}(q),qe=function(e){function t$1(t,n$1){var r=e.call(this,t,n$1)||this;return r.user=null,r.user=new ct$1(t,n({},n$1)),r}return t(t$1,e),t$1}(F),Be=function(e){function t$1(t){var n=t.userId,r=t.token,i=e.call(this)||this;return i.method=d.POST,i.path="".concat(Ue$1,"/").concat(encodeURIComponent(n),"/push/apns"),i.params={apns_device_token:r,always_push:!0},i}return t(t$1,e),t$1}(q);!function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.token=n.token,r.type=n.type?z[n.type.toLowerCase()]:z.UNKNOWN,r.user=new ct$1(t,n.user),r}t(t$1,e);}(F);var Fe=function(e){function t$1(t){var n=t.userId,r=t.token,i=e.call(this)||this;return i.method=d.POST,i.path="".concat(Ue$1,"/").concat(encodeURIComponent(n),"/push/gcm"),i.params={gcm_reg_token:r,always_push:!0},i}return t(t$1,e),t$1}(q);!function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.token=n.token,r.type=n.type?z[n.type.toLowerCase()]:z.UNKNOWN,r.user=new ct$1(t,n.user),r}t(t$1,e);}(F);var Ke=function(e){function t$1(t){var n=t.userId,r=t.token,i=e.call(this)||this;return i.method=d.DELETE,i.path="".concat(Ue$1,"/").concat(encodeURIComponent(n),"/push/apns/").concat(encodeURIComponent(r)),i}return t(t$1,e),t$1}(q);!function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.token=n.token,r.user=new ct$1(t,n.user),r}t(t$1,e);}(F);var je=function(e){function t$1(t){var n=t.userId,r=t.token,i=e.call(this)||this;return i.method=d.DELETE,i.path="".concat(Ue$1,"/").concat(encodeURIComponent(n),"/push/gcm/").concat(encodeURIComponent(r)),i}return t(t$1,e),t$1}(q);!function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.token=n.token,r.user=new ct$1(t,n.user),r}t(t$1,e);}(F);var He=function(e){function t$1(t){var n=t.userId,r=e.call(this)||this;return r.method=d.DELETE,r.path="".concat(Ue$1,"/").concat(encodeURIComponent(n),"/push/apns"),r}return t(t$1,e),t$1}(q);!function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.type=n.type?z[n.type.toLowerCase()]:z.UNKNOWN,r.user=new ct$1(t,n.user),r}t(t$1,e);}(F);var Ve=function(e){function t$1(t){var n=t.userId,r=e.call(this)||this;return r.method=d.DELETE,r.path="".concat(Ue$1,"/").concat(encodeURIComponent(n),"/push/gcm"),r}return t(t$1,e),t$1}(q);!function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.type=n.type?z[n.type.toLowerCase()]:z.UNKNOWN,r.user=new ct$1(t,n.user),r}t(t$1,e);}(F);var We=function(e){function t$1(t){var n=t.userId,r=t.type,i=t.token,s=t.ts,o=e.call(this)||this;return o.method=d.GET,o.path="".concat(Ue$1,"/").concat(encodeURIComponent(n),"/push/").concat(encodeURIComponent(r),"/device_tokens"),o.params={created_ts:s,token:i},o}return t(t$1,e),t$1}(q),ze=function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.pushTokens={type:n.type?z[n.type.toLowerCase()]:z.UNKNOWN,deviceTokens:n.device_tokens,hasMore:n.has_more,token:n.token},r}return t(t$1,e),t$1}(F),Qe=function(e){function t$1(t){var n=t.userId,r=e.call(this)||this;return r.method=d.GET,r.path="".concat(Ue$1,"/").concat(encodeURIComponent(n),"/channel_invitation_preference"),r}return t(t$1,e),t$1}(q),Ge=function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.autoAccept=n.auto_accept,r}return t(t$1,e),t$1}(F),Ye=function(e){function t$1(t){var n=t.userId,r=t.willAutoAccept,i=e.call(this)||this;return i.method=d.PUT,i.path="".concat(Ue$1,"/").concat(encodeURIComponent(n),"/channel_invitation_preference"),i.params={auto_accept:r},i}return t(t$1,e),t$1}(q),Je=function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.autoAccept=n.auto_accept,r}return t(t$1,e),t$1}(F),Xe=function(e){function t$1(t){var n=t.userId,r=e.call(this)||this;return r.method=d.GET,r.path="".concat(Ue$1,"/").concat(encodeURIComponent(n),"/push_preference"),r}return t(t$1,e),t$1}(q),Ze=function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.preference={doNotDisturbOn:n.do_not_disturb,startHour:n.start_hour,startMin:n.start_min,endHour:n.end_hour,endMin:n.end_min,timezone:n.timezone},r}return t(t$1,e),t$1}(F),$e=function(e){function t$1(t){var n=t.userId,r=t.doNotDisturbOn,i=t.startHour,s=t.startMin,o=t.endHour,a=t.endMin,u=t.timezone,c=e.call(this)||this;return c.method=d.PUT,c.path="".concat(Ue$1,"/").concat(encodeURIComponent(n),"/push_preference"),c.params={do_not_disturb:r,start_hour:i,start_min:s,end_hour:o,end_min:a,timezone:u},c}return t(t$1,e),t$1}(q),et=function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.preference={doNotDisturbOn:n.do_not_disturb,startHour:n.start_hour,startMin:n.start_min,endHour:n.end_hour,endMin:n.end_min,timezone:n.timezone},r}return t(t$1,e),t$1}(F),tt=function(e){function t$1(t){var n=t.userId,r=e.call(this)||this;return r.method=d.GET,r.path="".concat(Ue$1,"/").concat(encodeURIComponent(n),"/push_preference"),r}return t(t$1,e),t$1}(q),nt=function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.snoozePeriod={isSnoozeOn:n.snooze_enabled},"number"==typeof n.snooze_start_ts&&(r.snoozePeriod.startTs=n.snooze_start_ts),"number"==typeof n.snooze_end_ts&&(r.snoozePeriod.endTs=n.snooze_end_ts),r}return t(t$1,e),t$1}(F),rt=function(e){function t$1(t){var n=t.userId,r=t.snoozeOn,i=t.startTs,s=t.endTs,o=e.call(this)||this;return o.method=d.PUT,o.path="".concat(Ue$1,"/").concat(encodeURIComponent(n),"/push_preference"),o.params={snooze_enabled:r,snooze_start_ts:i,snooze_end_ts:s},o}return t(t$1,e),t$1}(q),it=function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.snoozePeriod={isSnoozeOn:n.snooze_enabled},"number"==typeof n.snooze_start_ts&&(r.snoozePeriod.startTs=n.snooze_start_ts),"number"==typeof n.snooze_end_ts&&(r.snoozePeriod.endTs=n.snooze_end_ts),r}return t(t$1,e),t$1}(F),st=function(e){function t$1(t){var n=t.userId,r=t.blockedUserId,i=e.call(this)||this;return i.method=d.POST,i.path="".concat(Ue$1,"/").concat(encodeURIComponent(n),"/block"),i.params={target_id:r},i}return t(t$1,e),t$1}(q);!function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.user=new ct$1(t,n),r}t(t$1,e);}(F);var ot=function(e){function t$1(t){var n=t.userId,r=t.unblockedUserId,i=e.call(this)||this;return i.method=d.DELETE,i.path="".concat(Ue$1,"/").concat(encodeURIComponent(n),"/block/").concat(encodeURIComponent(r)),i}return t(t$1,e),t$1}(q);!function(e){function t$1(){return null!==e&&e.apply(this,arguments)||this}t(t$1,e);}(F);var at=function(e){function t$1(t){var n=t.userId,r=e.call(this)||this;return r.method=d.GET,r.path="".concat(Ue$1,"/").concat(encodeURIComponent(n),"/push/template"),r}return t(t$1,e),t$1}(q),ut=function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.name=n.name,r}return t(t$1,e),t$1}(F),ct=function(e){function t$1(t){var n=t.userId,r=t.templateName,i=e.call(this)||this;return i.method=d.PUT,i.path="".concat(Ue$1,"/").concat(encodeURIComponent(n),"/push/template"),i.params={name:r},i}return t(t$1,e),t$1}(q),lt=function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.name=n.name,r}return t(t$1,e),t$1}(F),ht=function(e){function t$1(t){var n=t.userId,r=t.token,i=e.call(this)||this;return i.method=d.GET,i.path="".concat(Ue$1,"/").concat(encodeURIComponent(n),"/friends/changelogs"),i.params={token:r},i}return t(t$1,e),t$1}(q),dt=function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.changelogs={addedUsers:n.added.map((function(e){return new ct$1(t,e)})),updatedUsers:n.updated.map((function(e){return new ct$1(t,e)})),deletedUserIds:n.deleted,hasMore:n.has_more,token:n.next},r}return t(t$1,e),t$1}(F),ft=function(e){function t$1(t){var n=t.userId,r=t.discoveries,i=e.call(this)||this;return i.method=d.PUT,i.path="".concat(Ue$1,"/").concat(encodeURIComponent(n),"/friend_discoveries"),i.params={friend_discoveries:r.map((function(e){return {friend_discovery_key:e.friendDiscoveryKey,friend_name:e.friendName}}))},i}return t(t$1,e),t$1}(q),pt=function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.friendDiscoveryRequestId=n.friend_discovery_request_id,r}return t(t$1,e),t$1}(F),vt=function(e){function t$1(t){var n=t.userId,r=t.discoveryKeys,i=e.call(this)||this;return i.method=d.DELETE,i.path="".concat(Ue$1,"/").concat(encodeURIComponent(n),"/friend_discoveries"),i.params={friend_discovery_keys:r},i}return t(t$1,e),t$1}(q);!function(e){function t$1(){return null!==e&&e.apply(this,arguments)||this}t(t$1,e);}(F);var _t=function(e){function t$1(t){var n=t.userId,r=t.userIds,i=e.call(this)||this;return i.method=d.POST,i.path="".concat(Ue$1,"/").concat(encodeURIComponent(n),"/friends"),i.params={user_ids:r},i}return t(t$1,e),t$1}(q),mt=function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.users=n.users.map((function(e){return new ct$1(t,e)})),r}return t(t$1,e),t$1}(F),yt=function(e){function t$1(t){var n=t.userId,r=t.userIds,i=e.call(this)||this;return i.method=d.DELETE,i.path="".concat(Ue$1,"/").concat(encodeURIComponent(n),"/friends"),i.params={user_ids:r},i}return t(t$1,e),t$1}(q);!function(e){function t$1(){return null!==e&&e.apply(this,arguments)||this}t(t$1,e);}(F);var bt=function(e){function t$1(t){var n=t.userId,r=e.call(this)||this;return r.method=d.GET,r.path="".concat(Ue$1,"/").concat(n,"/allow_friend_discovery"),r.params={},r}return t(t$1,e),t$1}(q),gt=function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.allowFriendDiscovery=n.allow_friend_discovery,r}return t(t$1,e),t$1}(F),It=function(e){function t$1(t){var n=t.userId,r=t.allowFriendDiscovery,i=e.call(this)||this;return i.method=d.PUT,i.path="".concat(Ue$1,"/").concat(n,"/allow_friend_discovery"),i.params={allow_friend_discovery:r},i}return t(t$1,e),t$1}(q);!function(e){function t$1(){return null!==e&&e.apply(this,arguments)||this}t(t$1,e);}(F);var wt,Et=function(e){this.key=null,this.url=null,this.key=e.key,this.url=e.url;},kt=function(e){var t,n,r;this.id=0,this.name=null,this.url=null,this.emojis=[],this.id=null!==(t=e.id)&&void 0!==t?t:0,this.name=null!==(n=e.name)&&void 0!==n?n:"",this.url=null!==(r=e.url)&&void 0!==r?r:"",this.emojis=e.emojis?e.emojis.map((function(e){return new Et(e)})):[];},Nt=function(e){this.emojiHash=null,this.emojiCategories=[],this.emojiHash=e.emoji_hash||"",this.emojiCategories=e.emoji_categories?e.emoji_categories.map((function(e){return new kt(e)})):[];},Ot=function(e){function t$1(){var t=e.call(this)||this;return t.method=d.GET,t.path=ze$1,t}return t(t$1,e),t$1}(q),St=function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.emojiContainer=new Nt(n),r}return t(t$1,e),t$1}(F),Tt=function(e){function t$1(t){var n=t.categoryId,r=e.call(this)||this;return r.method=d.GET,r.path="".concat(ze$1,"/").concat(n),r}return t(t$1,e),t$1}(q),xt=function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.emojiCategory=new kt(n),r}return t(t$1,e),t$1}(F),Ct=function(e){function t$1(t){var n=t.key,r=e.call(this)||this;return r.method=d.GET,r.path="".concat(Ke$1,"/").concat(n),r}return t(t$1,e),t$1}(q),Rt=function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.emoji=new Et(n),r}return t(t$1,e),t$1}(F),Lt=function(e){function t$1(t){var n=t.limit,r=t.token,i=t.userIdsFilter,s=t.metaDataKeyFilter,o=t.metaDataValuesFilter,a=t.nicknameStartsWithFilter,u=e.call(this)||this;return u.method=d.GET,u.path=Ue$1,u.params=U({limit:n,token:r,user_ids:i,metadatakey:s,metadatavalues_in:o,nickname_startswith:a}),u}return t(t$1,e),t$1}(q),Pt=function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.users=n.users.map((function(e){return new ct$1(t,e)})),r.next=n.next,r}return t(t$1,e),t$1}(F),At=function(e){function n$1(t,n){var r,i,s,o=this;return (o=e.call(this,t,n)||this).userIdsFilter=null,o.metaDataKeyFilter=null,o.metaDataValuesFilter=null,o.nicknameStartsWithFilter=null,o.userIdsFilter=null!==(r=n.userIdsFilter)&&void 0!==r?r:null,o.metaDataKeyFilter=null!==(i=n.metaDataKeyFilter)&&void 0!==i?i:null,o.metaDataValuesFilter=null!==(s=n.metaDataValuesFilter)&&void 0!==s?s:null,o.nicknameStartsWithFilter=n.nicknameStartsWithFilter||null,o}return t(n$1,e),n$1.prototype._validate=function(){return e.prototype._validate.call(this)&&E("string",this.userIdsFilter,!0)&&y("string",this.metaDataKeyFilter,!0)&&E("string",this.metaDataValuesFilter,!0)&&y("string",this.metaDataKeyFilter,!0)},n$1.prototype.next=function(){return r(this,void 0,void 0,(function(){var e,t,n$1,r,i$1,s;return i(this,(function(o){switch(o.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=St$1.of(this._iid).requestQueue,t=new Lt(n(n({},this),{token:this._token})),[4,e.send(t)]):[3,2]:[3,5];case 1:return n$1=o.sent(),r=n$1.as(Pt),i$1=r.users,s=r.next,this._token=s,this._hasNext=!!s,this._isLoading=!1,[2,i$1];case 2:return [2,[]];case 3:throw p.queryInProgress;case 4:return [3,6];case 5:throw p.invalidParameters;case 6:return [2]}}))}))},n$1}(bn$1),Dt=function(e){function t$1(t){var n=t.userId,r=t.limit,i=t.token,s=t.userIdsFilter,o=e.call(this)||this;return o.method=d.GET,o.path="".concat(Ue$1,"/").concat(n,"/block"),o.params=U({limit:r,token:i,user_ids:s}),o}return t(t$1,e),t$1}(q),Mt=function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.users=n.users.map((function(e){return new ct$1(t,e)})),r.next=n.next,r}return t(t$1,e),t$1}(F),Ut=function(e){function t$1(t,n){var r,i=this;return (i=e.call(this,t,n)||this).userIdsFilter=null,i.userIdsFilter=null!==(r=n.userIdsFilter)&&void 0!==r?r:null,i}return t(t$1,e),t$1.prototype._validate=function(){return e.prototype._validate.call(this)&&E("string",this.userIdsFilter,!0)},t$1.prototype.next=function(){return r(this,void 0,void 0,(function(){var e,t,n$1,r,i$1,s,o,a;return i(this,(function(u){switch(u.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=St$1.of(this._iid),t=e.sdkState,n$1=e.requestQueue,r=new Dt(n(n({},this),{userId:t.userId,token:this._token})),[4,n$1.send(r)]):[3,2]:[3,5];case 1:return i$1=u.sent(),s=i$1.as(Mt),o=s.users,a=s.next,this._token=a,this._hasNext=!!a,this._isLoading=!1,[2,o];case 2:return [2,[]];case 3:throw p.queryInProgress;case 4:return [3,6];case 5:throw p.invalidParameters;case 6:return [2]}}))}))},t$1}(bn$1),qt=function(e){function t$1(t){var n=t.userId,r=t.limit,i=t.token,s=e.call(this)||this;return s.method=d.GET,s.path="".concat(Ue$1,"/").concat(encodeURIComponent(n),"/friends"),s.params={limit:r,token:i},s}return t(t$1,e),t$1}(q),Bt=function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.hasMore=n.has_more,r.users=n.users.map((function(e){return new ct$1(t,e)})),r.next=n.next,r}return t(t$1,e),t$1}(F),Ft=function(e){function t$1(){return null!==e&&e.apply(this,arguments)||this}return t(t$1,e),t$1.prototype._validate=function(){return e.prototype._validate.call(this)},t$1.prototype.next=function(){return r(this,void 0,void 0,(function(){var e,t,n$1,r,i$1,s,o,a,u;return i(this,(function(c){switch(c.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=St$1.of(this._iid),t=e.sdkState,n$1=e.requestQueue,r=new qt(n(n({},this),{userId:t.userId,token:this._token})),[4,n$1.send(r)]):[3,2]:[3,5];case 1:return i$1=c.sent(),s=i$1.as(Bt),o=s.users,a=s.hasMore,u=s.next,this._token=u,this._hasNext=a,this._isLoading=!1,[2,o];case 2:return [2,[]];case 3:throw p.queryInProgress;case 4:return [3,6];case 5:throw p.invalidParameters;case 6:return [2]}}))}))},t$1}(bn$1),Kt={},jt=function(){function e(e){var t=e.dbname,n=e.itemSizeLimit,r=void 0===n?1048576:n,i=e.cacheLimit,s=void 0===i?256:i,o=e.blockHashBase,a=void 0===o?2:o,u=e.blockHashMultiplier,c=void 0===u?10:u,l=e.blockHashConstant,h=void 0===l?11:l,d=e.transactionApplyDelay,f=void 0===d?200:d,p=e.disableLogger,v=void 0!==p&&p;return Kt[t]||(this.itemSizeLimit=r,this.cacheLimit=s,this.blockHashBase=a,this.blockHashMultiplier=c,this.blockHashConstant=h,this.transactionApplyDelay=f,this.disableLogger=v,Kt[t]=this),Kt[t]}return e.get=function(e){return Kt[e]},e}();!function(e){e[e.UNKNOWN_ERROR=6e7]="UNKNOWN_ERROR",e[e.STORE_NOT_DEFINED=61001e3]="STORE_NOT_DEFINED",e[e.STORE_NOT_AVAILABLE=61001001]="STORE_NOT_AVAILABLE",e[e.STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING=61001002]="STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING",e[e.STORE_IS_FULL=61001003]="STORE_IS_FULL",e[e.STORE_INVALID_KEY_TYPE=61002e3]="STORE_INVALID_KEY_TYPE",e[e.STORE_BROKEN_INTEGRITY=61002001]="STORE_BROKEN_INTEGRITY",e[e.STORE_BROKEN_BLOB=61002002]="STORE_BROKEN_BLOB",e[e.STORE_ENCRYPTION_INVALID=61002003]="STORE_ENCRYPTION_INVALID",e[e.STORE_ITEM_SIZE_LIMIT_EXCEEDED=61017e3]="STORE_ITEM_SIZE_LIMIT_EXCEEDED",e[e.STORE_READ_FAILED=61017001]="STORE_READ_FAILED",e[e.STORE_WRITE_FAILED=61017002]="STORE_WRITE_FAILED",e[e.DATABASE_SCHEMA_NOT_ON_UPGRADE=62002e3]="DATABASE_SCHEMA_NOT_ON_UPGRADE",e[e.COLLECTION_NOT_READY=63001e3]="COLLECTION_NOT_READY",e[e.COLLECTION_KEY_NOT_MATCH=63002e3]="COLLECTION_KEY_NOT_MATCH",e[e.COLLECTION_QUERY_NOT_VALID=63002001]="COLLECTION_QUERY_NOT_VALID",e[e.COLLECTION_KEY_NOT_FOUND=63004e3]="COLLECTION_KEY_NOT_FOUND",e[e.COLLECTION_KEY_NOT_GIVEN=63004001]="COLLECTION_KEY_NOT_GIVEN",e[e.COLLECTION_INSERT_DUPLICATE=63009e3]="COLLECTION_INSERT_DUPLICATE",e[e.COLLECTION_WRITE_FAILED=63017e3]="COLLECTION_WRITE_FAILED",e[e.COLLECTION_ITEM_SIZE_LIMIT_EXCEEDED=63017001]="COLLECTION_ITEM_SIZE_LIMIT_EXCEEDED",e[e.INDEX_TABLE_IS_REQUIRED=65001e3]="INDEX_TABLE_IS_REQUIRED",e[e.INDEX_TYPE_NOT_MATCH=65002e3]="INDEX_TYPE_NOT_MATCH",e[e.COMPARE_TYPE_NOT_MATCH=69002001]="COMPARE_TYPE_NOT_MATCH",e[e.CIRCULAR_REFERENCE_FOUND=69002002]="CIRCULAR_REFERENCE_FOUND";}(wt||(wt={}));var Ht,Vt=function(e){function t$1(n){var r=n.code,i=void 0===r?wt.UNKNOWN_ERROR:r,s=n.message,o=void 0===s?"Unknown error occurred.":s,a=e.call(this,o)||this;return a.code=i,Object.setPrototypeOf(a,t$1.prototype),a}return t(t$1,e),Object.defineProperty(t$1,"storeNotDefined",{get:function(){return new t$1({code:wt.STORE_NOT_DEFINED,message:"Store is not defined. Specify the store on NestDB()"})},enumerable:!1,configurable:!0}),Object.defineProperty(t$1,"storeNotAvailable",{get:function(){return new t$1({code:wt.STORE_NOT_AVAILABLE,message:"Store is not available. Check your environment settings."})},enumerable:!1,configurable:!0}),Object.defineProperty(t$1,"storeNotAvailableInPrivateBrowsing",{get:function(){return new t$1({code:wt.STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING,message:"Store is not available because it is in private browsing."})},enumerable:!1,configurable:!0}),Object.defineProperty(t$1,"storeIsFull",{get:function(){return new t$1({code:wt.STORE_IS_FULL,message:"Store is full."})},enumerable:!1,configurable:!0}),Object.defineProperty(t$1,"storeKeyTypeIsInvalid",{get:function(){return new t$1({code:wt.STORE_INVALID_KEY_TYPE,message:"Store key should be string type."})},enumerable:!1,configurable:!0}),Object.defineProperty(t$1,"storeBrokenIntegrity",{get:function(){return new t$1({code:wt.STORE_BROKEN_INTEGRITY,message:"Data should be in a store but it does not. Integrity is broken."})},enumerable:!1,configurable:!0}),Object.defineProperty(t$1,"storeBrokenBlob",{get:function(){return new t$1({code:wt.STORE_BROKEN_BLOB,message:"Data should be in a store but it does not. Blob data is broken."})},enumerable:!1,configurable:!0}),Object.defineProperty(t$1,"storeEncryptionInvalid",{get:function(){return new t$1({code:wt.STORE_ENCRYPTION_INVALID,message:"Encryption algorithm has changed. All the store should reset."})},enumerable:!1,configurable:!0}),Object.defineProperty(t$1,"storeItemSizeExceeded",{get:function(){return new t$1({code:wt.STORE_ITEM_SIZE_LIMIT_EXCEEDED,message:"The size of the item exceeds the limit that the store allows."})},enumerable:!1,configurable:!0}),Object.defineProperty(t$1,"storeReadFailed",{get:function(){return new t$1({code:wt.STORE_READ_FAILED,message:"Failed to read from store."})},enumerable:!1,configurable:!0}),Object.defineProperty(t$1,"storeWriteFailed",{get:function(){return new t$1({code:wt.STORE_WRITE_FAILED,message:"Failed to write to store."})},enumerable:!1,configurable:!0}),Object.defineProperty(t$1,"databaseSchemaNotOnUpgrade",{get:function(){return new t$1({code:wt.DATABASE_SCHEMA_NOT_ON_UPGRADE,message:"Committing schema is not allowed when upgrade is not running."})},enumerable:!1,configurable:!0}),Object.defineProperty(t$1,"collectionNotReady",{get:function(){return new t$1({code:wt.COLLECTION_NOT_READY,message:"Collection is not ready due to an error during initialization."})},enumerable:!1,configurable:!0}),Object.defineProperty(t$1,"collectionKeyNotMatch",{get:function(){return new t$1({code:wt.COLLECTION_KEY_NOT_MATCH,message:"keyName of collection could not change."})},enumerable:!1,configurable:!0}),Object.defineProperty(t$1,"collectionQueryNotValid",{get:function(){return new t$1({code:wt.COLLECTION_QUERY_NOT_VALID,message:"Query parameter is not a valid format."})},enumerable:!1,configurable:!0}),Object.defineProperty(t$1,"collectionInsertDuplicate",{get:function(){return new t$1({code:wt.COLLECTION_INSERT_DUPLICATE,message:"The key already exists."})},enumerable:!1,configurable:!0}),Object.defineProperty(t$1,"collectionKeyNotFound",{get:function(){return new t$1({code:wt.COLLECTION_KEY_NOT_FOUND,message:"The key is not found."})},enumerable:!1,configurable:!0}),Object.defineProperty(t$1,"collectionKeyNotGiven",{get:function(){return new t$1({code:wt.COLLECTION_KEY_NOT_GIVEN,message:"The item should contain [keyName] property."})},enumerable:!1,configurable:!0}),Object.defineProperty(t$1,"collectionWriteFailed",{get:function(){return new t$1({code:wt.COLLECTION_WRITE_FAILED,message:"Failed to write an item."})},enumerable:!1,configurable:!0}),Object.defineProperty(t$1,"collectionItemSizeExceeded",{get:function(){return new t$1({code:wt.COLLECTION_ITEM_SIZE_LIMIT_EXCEEDED,message:"The size of the item exceeds the limit that a collection allows."})},enumerable:!1,configurable:!0}),Object.defineProperty(t$1,"indexTableIsRequired",{get:function(){return new t$1({code:wt.INDEX_TABLE_IS_REQUIRED,message:"Index table is required."})},enumerable:!1,configurable:!0}),Object.defineProperty(t$1,"indexTypesNotMatch",{get:function(){return new t$1({code:wt.INDEX_TYPE_NOT_MATCH,message:"Indexed column should have primitive type."})},enumerable:!1,configurable:!0}),Object.defineProperty(t$1,"compareTypesNotMatch",{get:function(){return new t$1({code:wt.COMPARE_TYPE_NOT_MATCH,message:"Values to compare have different types."})},enumerable:!1,configurable:!0}),Object.defineProperty(t$1,"circularReferenceFound",{get:function(){return new t$1({code:wt.CIRCULAR_REFERENCE_FOUND,message:"Cannot handle circular referenced object."})},enumerable:!1,configurable:!0}),t$1}(Error);!function(e){e.INIT="init",e.READY="ready",e.CLOSED="closed";}(Ht||(Ht={}));var Wt,zt=function(e,t){if(void 0===t&&(t=new WeakMap),"object"==typeof e&&null!==e){if(t.has(e))throw Vt.circularReferenceFound;t.set(e,!0);var n=null;if(Array.isArray(e))n=e.map((function(e){return zt(e,t)}));else if(e instanceof RegExp)n=e;else if(e instanceof Date)n=e;else for(var r in n={},e)n[r]=zt(e[r],t);return t.delete(e),n}return e},Qt=function(e,t){if(null==t)return 1;if(null==e)return -1;if(typeof e!=typeof t)throw Vt.compareTypesNotMatch;var n=0;switch(typeof e){case"boolean":case"number":n=e-t;break;case"string":n=e.localeCompare(t);}return n},Gt=function(e,t){for(var n=0,r=0;r<e.length;r++)n=e.charCodeAt(r)+(n<<6)+(n<<16)-n;return (n>>>0)%t},Yt=function(e){return new Promise((function(t){setTimeout((function(){return t()}),e);}))},Jt=function(e,t){if(!t)return !1;if("function"!=typeof e){for(var n in e){if(["/and","&&"].includes(n)){if(e[n].some((function(e){return !Jt(e,t)})))return !1}else if(["/or","||"].includes(n)){if(e[n].every((function(e){return !Jt(e,t)})))return !1}else if("/where"===n){if(!(0, e[n])(t))return !1}else {var r=n;if("object"==typeof e[r]){var i=e[r];for(var s in i)switch(s){case"/eq":case"=":if((o=t[r])!==(a=i[s]))return !1;break;case"/neq":case"!=":if((o=t[r])===(a=i[s]))return !1;break;case"/gt":case">":var o=t[r],a=i[s];if(!(Qt(o,a)>0))return !1;break;case"/gte":case">=":o=t[r],a=i[s];if(!(Qt(o,a)>=0))return !1;break;case"/lt":case"<":o=t[r],a=i[s];if(!(Qt(o,a)<0))return !1;break;case"/lte":case"<=":o=t[r],a=i[s];if(!(Qt(o,a)<=0))return !1;break;case"/in":o=t[r];if(!(a=i[s]).includes(o))return !1;break;case"/nin":o=t[r];if((a=i[s]).includes(o))return !1;break;case"/contain":o=t[r],a=i[s];if(!o.includes(a))return !1;break;case"/regex":o=t[r];if(!(a=i[s]).test(o))return !1;break;case"/where":o=t[r];if(!(0, i[s])(o))return !1}}else if("function"==typeof e[r]){if(!e[r](t[r]))return !1}else if(e[r]!==t[r])return !1}}return !0}return e(t)},Xt=function(){},Zt=function(){return Promise.resolve()},$t=function(e){return e},en$1=function(e,t){t(null);};!function(e){e[e.FORWARD=0]="FORWARD",e[e.BACKWARD=1]="BACKWARD";}(Wt||(Wt={}));var tn$1,nn,rn$1,sn$1=function(){function e(e){var t=e.initialPrevValue,n=void 0===t?null:t,r=e.initialNextValue,i=void 0===r?null:r,s=e.iterator,o=e.map,a=void 0===o?$t:o,u=e.backward,c=void 0===u?Zt:u,l=e.forward,h=void 0===l?Zt:l,d=e.complete,f=void 0===d?Xt:d;this._prevValue=n,this._nextValue=i,this._error=null,this._map=a,this._backward=c,this._forward=h,this._iterator=s,this._complete=f;}return Object.defineProperty(e.prototype,"prevValue",{get:function(){return this._map(this._prevValue)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nextValue",{get:function(){return this._map(this._nextValue)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"error",{get:function(){return this._error},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasPrevious",{get:function(){return !!this._prevValue},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasNext",{get:function(){return !!this._nextValue},enumerable:!1,configurable:!0}),e.prototype.prev=function(){return r(this,void 0,void 0,(function(){var e,t,n;return i(this,(function(r){switch(r.label){case 0:if(!this.hasPrevious)return [3,6];r.label=1;case 1:return r.trys.push([1,3,,4]),e=this._prevValue,t=this,[4,this._backward()];case 2:return t._prevValue=r.sent()||null,this._nextValue=e,[3,4];case 3:return n=r.sent(),this._error=n,[3,4];case 4:return [4,this._iterator(this)];case 5:return [2,r.sent()];case 6:this._complete(),r.label=7;case 7:return [2]}}))}))},e.prototype.next=function(){return r(this,void 0,void 0,(function(){var e,t,n;return i(this,(function(r){switch(r.label){case 0:if(!this.hasNext)return [3,6];r.label=1;case 1:return r.trys.push([1,3,,4]),e=this._nextValue,t=this,[4,this._forward()];case 2:return t._nextValue=r.sent()||null,this._prevValue=e,[3,4];case 3:return n=r.sent(),this._error=n,[3,4];case 4:return [4,this._iterator(this)];case 5:return [2,r.sent()];case 6:this._complete(),r.label=7;case 7:return [2]}}))}))},e.prototype.stop=function(){this._prevValue=null,this._nextValue=null,this._complete();},e}(),on$1=function(){function e(e){var t=e.condition,n=void 0===t?{}:t,r=e.backward,i=void 0!==r&&r,s=e.blockManager,o=e.indexer;this.condition=n,this.backward=i,this._blockManager=s,this._indexer=o;}return e.prototype.findOptimizedStartPosition=function(){var e=this,t=["=","/eq",">",">=","/gt","/gte"],n=["=","/eq","<","<=","/lt","/lte"];if(this.backward){var r=this._indexer.origin.length-1;if("function"!=typeof this.condition)for(var i in this._indexer.fields){var s=this._indexer.fields[i],o=1;if("-"===s[0]&&(s=s.slice(1),o=-1),this.condition[s])if("object"==typeof this.condition[s]){var a=o>0?n:t;for(var u in this.condition[s])if(a.includes(u))for(var c=r;c>=0;c--)if(o*Qt(this._indexer.origin[c].columnValues[i],this.condition[s][u])<=0){r=c;break}}else for(c=r;c>=0;c--)if(o*Qt(this._indexer.origin[c].columnValues[i],this.condition[s])<=0){r=c;break}}return Math.min(r+1,this._indexer.origin.length-1)}var l=0;if("function"!=typeof this.condition)for(var h=function(r){var i=d._indexer.fields[r],s=1;if("-"===i[0]&&(i=i.slice(1),s=-1),d.condition[i])if("object"==typeof d.condition[i])Object.keys(d.condition[i]).forEach((function(o){if((s>0?t:n).includes(o))for(var a=l;a<e._indexer.origin.length;a++)if(s*Qt(e._indexer.origin[a].columnValues[r],e.condition[i][o])>=0){l=a;break}}));else for(var o=l;o<d._indexer.origin.length;o++)if(s*Qt(d._indexer.origin[o].columnValues[r],d.condition[i])>=0){l=o;break}},d=this,i=0;i<this._indexer.fields.length;i++)h(i);return Math.max(l-1,0)},e.prototype.each=function(e){return r(this,void 0,void 0,(function(){var t,n,r$1,i$1,s,o,a,c=this;return i(this,(function(l){switch(l.label){case 0:if(t=this.findOptimizedStartPosition(),n=0,this.backward&&this._indexer.origin[t]&&(n=this._indexer.origin[t].keys.length-1),r$1=function(){if(c._indexer.origin[t]){if(!c._indexer.origin[t].keys[++n]){if(!c._indexer.origin[++t])return !1;n=0;}return !0}return !1},i$1=function(){if(c._indexer.origin[t]){if(!c._indexer.origin[t].keys[--n]){if(!c._indexer.origin[--t])return !1;n=c._indexer.origin[t].keys.length-1;}return !0}return !1},s=null,!this._indexer.origin[t])return [3,4];o=this.backward?i$1:r$1,l.label=1;case 1:return [4,this._blockManager.getFromBlock(this._indexer.origin[t].keys[n])];case 2:if(a=l.sent(),Jt(this.condition,a))return s=a,[3,4];l.label=3;case 3:if(o())return [3,1];l.label=4;case 4:return [4,new Promise((function(o){var a=new sn$1({initialNextValue:zt(s),iterator:e,forward:function(){return r(c,void 0,void 0,(function(){var e,s;return i(this,(function(o){switch(o.label){case 0:e=this.backward?i$1:r$1,o.label=1;case 1:return e()?[4,this._blockManager.getFromBlock(this._indexer.origin[t].keys[n])]:[3,3];case 2:return s=o.sent(),Jt(this.condition,s)?[2,zt(s)]:[3,1];case 3:return [2,null]}}))}))},backward:function(){return r(c,void 0,void 0,(function(){var e,s;return i(this,(function(o){switch(o.label){case 0:e=this.backward?r$1:i$1,o.label=1;case 1:return e()?[4,this._blockManager.getFromBlock(this._indexer.origin[t].keys[n])]:[3,3];case 2:return s=o.sent(),Jt(this.condition,s)?[2,zt(s)]:[3,1];case 3:return [2,null]}}))}))},complete:o});e(a);}))];case 5:return [2,l.sent()]}}))}))},e}(),an$1=function(){function e(e){var t=e.condition,n=void 0===t?{}:t,r=e.backward,i=void 0!==r&&r,s=e.mutex,o=e.blockManager,a=e.indexer;this._mutex=s,this._iterator=new on$1({condition:n,backward:i,blockManager:o,indexer:a});}return e.prototype.fetch=function(e){return void 0===e&&(e={}),r(this,void 0,void 0,(function(){var t,n,r$1,i$1,s=this;return i(this,(function(o){switch(o.label){case 0:if(t=Math.max(e.offset||0,0),0===(n="number"==typeof e.limit?e.limit:Number.MAX_SAFE_INTEGER))return [2,[]];if(n<0)throw Vt.collectionQueryNotValid;o.label=1;case 1:return o.trys.push([1,4,,5]),r$1=[],[4,this._mutex.lock()];case 2:return o.sent(),[4,this._iterator.each((function(e){return r(s,void 0,void 0,(function(){return i(this,(function(i){return e.error?e.stop():e.hasNext?0===t?(r$1.push(e.nextValue),0<n&&n<=r$1.length?e.stop():e.next()):(t--,e.next()):e.stop(),[2]}))}))}))];case 3:return o.sent(),this._mutex.unlock(),[2,r$1];case 4:throw i$1=o.sent(),this._mutex.unlock(),i$1;case 5:return [2]}}))}))},e.prototype.count=function(){return r(this,void 0,void 0,(function(){var e,t,n=this;return i(this,(function(r$1){switch(r$1.label){case 0:return r$1.trys.push([0,3,,4]),e=0,[4,this._mutex.lock()];case 1:return r$1.sent(),[4,this._iterator.each((function(t){return r(n,void 0,void 0,(function(){return i(this,(function(n){return t.error?t.stop():t.hasNext?(e++,t.next()):t.stop(),[2]}))}))}))];case 2:return r$1.sent(),this._mutex.unlock(),[2,e];case 3:throw t=r$1.sent(),this._mutex.unlock(),t;case 4:return [2]}}))}))},e}(),un$1=function(e){return "".concat("nest","@").concat(e)},cn$1=function(e,t){return "".concat(un$1(e),"/").concat(t)},ln$1=function(e,t){return "".concat(cn$1(e,t),".metadata")},hn$1=function(e,t){return "".concat(cn$1(e,t),"/block.")},dn$1=function(e,t){return "".concat(cn$1(e,t),"/blob.")},fn$1=function(e,t,n,r){return void 0===r&&(r=0),"".concat(dn$1(e,t)).concat(n,".").concat(r)},pn$1=function(){function e(e){var t=e.dbname,n=e.collectionName,r=e.store;this.dbname=t,this.collectionName=n,this._store=r;}return e.prototype._makeShards=function(e,t){var n=Math.max(this._store.itemSizeLimit-1024,0);if(n>0){for(var r=Math.ceil(e.data.length/n),i="".concat(r,".").concat(e.type,".").concat(t),s=[],o=0;o<e.data.length;o+=n){var a=e.data.slice(o,o+n);s.push(a);}return {blobId:i,shards:s}}return {blobId:null,shards:null}},e.prototype._encode=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return [4,new Promise((function(t){var n=new FileReader;n.onload=function(){t({data:n.result,type:e.type});},n.readAsDataURL(e);}))];case 1:return [2,t.sent()]}}))}))},e.prototype._decode=function(e){return r(this,void 0,void 0,(function(){var t,n,r,i$1,s,o;return i(this,(function(a){switch(a.label){case 0:return "undefined"==typeof fetch?[3,3]:[4,fetch(e.data)];case 1:return [4,a.sent().blob()];case 2:return [2,a.sent()];case 3:for(t=[],n=atob(e.data.split(",")[1]),r=0;r<n.length;r+=512){for(i$1=n.slice(r,r+512),s=new Array(i$1.length),o=0;o<i$1.length;o++)s[o]=i$1.charCodeAt(o);t.push(new Uint8Array(s));}return [2,new Blob(t,{type:e.type})]}}))}))},e.prototype.get=function(e){return r(this,void 0,void 0,(function(){var t,n,r,i$1,s,o$1,a,u;return i(this,(function(c){switch(c.label){case 0:if(t=[],n=o(e.split("."),2),r=n[0],i$1=n[1],!((s=parseInt(r))>0))return [3,6];o$1=0,c.label=1;case 1:return o$1<s?(a=fn$1(this.dbname,this.collectionName,e,o$1),[4,this._store.get(a)]):[3,4];case 2:if(!(u=c.sent())||!u.d)throw Vt.storeBrokenBlob;t.push(u.d),c.label=3;case 3:return o$1++,[3,1];case 4:return [4,this._decode({data:t.join(""),type:i$1})];case 5:return [2,c.sent()];case 6:return [2,null]}}))}))},e.prototype.save=function(e,t){return void 0===t&&(t="".concat(Date.now())),r(this,void 0,void 0,(function(){var n,r,i$1,s,o,a,u;return i(this,(function(c){switch(c.label){case 0:return n=[],[4,this._encode(e)];case 1:if(r=c.sent(),i$1=this._makeShards(r,t),s=i$1.blobId,o=i$1.shards,!s)return [3,3];for(a=0;a<o.length;a++)u=fn$1(this.dbname,this.collectionName,s,a),n.push({key:u,value:{d:o[a]},generation:1});return [4,this._store.setMany(n)];case 2:if(c.sent().some((function(e){return e instanceof Error})))throw Vt.storeWriteFailed;return [2,s];case 3:return [2,null]}}))}))},e.prototype.remove=function(e){return r(this,void 0,void 0,(function(){var t,n,r,i$1,s;return i(this,(function(o$1){switch(o$1.label){case 0:if(t=[],n=o(e.split("."),1),r=n[0],!((i$1=parseInt(r))>0))return [3,2];for(s=0;s<i$1;s++)t.push(fn$1(this.dbname,this.collectionName,e,s));return [4,this._store.removeMany(t)];case 1:o$1.sent(),o$1.label=2;case 2:return [2]}}))}))},e.prototype.clear=function(){return r(this,void 0,void 0,(function(){var e,t,n,r,i$1,s$1,o,a;return i(this,(function(u){switch(u.label){case 0:return e=dn$1(this.dbname,this.collectionName),t=[],[4,this._store.getAllKeys()];case 1:n=u.sent();try{for(r=s(n),i$1=r.next();!i$1.done;i$1=r.next())(s$1=i$1.value).startsWith(e)&&t.push(s$1);}catch(e){o={error:e};}finally{try{i$1&&!i$1.done&&(a=r.return)&&a.call(r);}finally{if(o)throw o.error}}return [4,this._store.removeMany(n)];case 2:return u.sent(),[2]}}))}))},e}();!function(e){e[e.COMMIT=0]="COMMIT",e[e.WRITE=1]="WRITE",e[e.ERROR=2]="ERROR";}(tn$1||(tn$1={})),function(e){e.PENDING="pending",e.PERSISTENT="persistent",e.VOLATILE="volatile";}(nn||(nn={})),function(e){e[e.NO_CACHE=0]="NO_CACHE",e[e.DEFAULT=1]="DEFAULT",e[e.PERSISTENT=2]="PERSISTENT";}(rn$1||(rn$1={}));var vn$1=[nn.PENDING,nn.VOLATILE],_n$1={},mn$1=function(){function e(e){var t=e.dbname,n=e.limit,r=void 0===n?256:n;return _n$1[t]||(this.dbname=t,this._items=[],this._limit=r,_n$1[t]=this),_n$1[t]}return e.get=function(e){return _n$1[e]},Object.defineProperty(e.prototype,"items",{get:function(){return this._items},enumerable:!1,configurable:!0}),e.prototype.find=function(e,t,n){return void 0===n&&(n=rn$1.DEFAULT),r(this,void 0,void 0,(function(){var r,i$1;return i(this,(function(s){switch(s.label){case 0:return (r=this.get(t))?[3,2]:[4,e.get(t)];case 1:return (i$1=s.sent())&&(r={key:t,value:i$1,generation:1,state:n===rn$1.PERSISTENT?nn.PERSISTENT:nn.VOLATILE},this.put(r)),[3,3];case 2:n===rn$1.PERSISTENT&&(r.state=nn.PERSISTENT),s.label=3;case 3:return [2,r]}}))}))},e.prototype.get=function(e,t){void 0===t&&(t=rn$1.DEFAULT);var n=this._items.map((function(e){return e.key})).indexOf(e);if(n>-1){var r=this._items[n];return t===rn$1.PERSISTENT&&(r.state=nn.PERSISTENT),t!==rn$1.NO_CACHE&&this.put(r),r}return null},e.prototype.put=function(e){var t,n;if(this._limit>0){var r=this._items.map((function(e){return e.key})).indexOf(e.key);if(r>-1)vn$1.includes(this._items[r].state)&&vn$1.includes(e.state)?(this._items.splice(r,1),this._items.push(e)):(this._items[r].state=e.state,this._items[r].generation=e.generation,this._items[r].value=e.value);else {this._items.push(e);var i=this._items.filter((function(e){return e.state===nn.VOLATILE})),s$1=i.length-this._limit;if(s$1>0){var o=[];try{for(var a=s(this._items),u=a.next();!u.done;u=a.next()){var c=u.value;c.state===nn.VOLATILE&&s$1>0?s$1--:o.push(c);}}catch(e){t={error:e};}finally{try{u&&!u.done&&(n=a.return)&&n.call(a);}finally{if(t)throw t.error}}this._items=o;}}}},e.prototype.remove=function(e){var t=this._items.map((function(e){return e.key})).indexOf(e);t>-1&&this._items.splice(t,1);},e.prototype.clearByCondition=function(e){this._items=this._items.filter((function(t){return !e(t)}));},e.prototype.clear=function(e){void 0===e&&(e=!1),this._items=e?[]:this._items.filter((function(e){return e.state!==nn.VOLATILE}));},e}(),yn$1=function(){function e(e){var t=e.dbname,n=e.collectionName,r=e.store;this._metadata=null,this._requests=[],this._onCommit=new Map,this._onWrite=new Map,this._onError=new Map,this.dbname=t,this.collectionName=n,this.metadataKey=function(e,t){return "".concat(cn$1(e,t),"/trans.metadata")}(t,n),this.recordsetKey=function(e,t){return "".concat(cn$1(e,t),"/trans.recordset")}(t,n),this._store=r;}return Object.defineProperty(e.prototype,"generation",{get:function(){return this._metadata?this._metadata.generation:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"requestCount",{get:function(){return this._requests.length},enumerable:!1,configurable:!0}),e.prototype._getReducedRecordset=function(e){return void 0===e&&(e=[]),r(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return [4,this._store.get(this.recordsetKey)];case 1:return (t=n.sent()||[]).push.apply(t,a([],o(e),!1)),[2,this._reduceRecordSet(t)]}}))}))},e.prototype._reduceRecordSet=function(e){for(var t=[],n={},r=e.length-1;r>=0;r--){for(var i=e[r],s=[],o=i.requests.length-1;o>=0;o--){var a=i.requests[o],u=a.data;n[u.key]||(s.unshift(a),n[u.key]=!0);}s.length>0&&(i.requests=s,t.unshift(i));}return t},e.prototype._applyRecord=function(e,t){return r(this,void 0,void 0,(function(){var n$1,r,i$1,s,o,a,u,c,l;return i(this,(function(h){switch(h.label){case 0:n$1=mn$1.get(this.dbname),r=t.generation,i$1=t.requests,s=null,h.label=1;case 1:return h.trys.push([1,3,,4]),[4,this._store.setMany(i$1.map((function(e){return n(n({},e.data),{generation:r})})))];case 2:for(o=h.sent(),a=0;a<i$1.length;a++)o[a]instanceof Error&&(s||(s=o[a]),u=i$1[a].data,n$1.put(n(n({},u),{generation:r,state:nn.PERSISTENT})));return [3,4];case 3:return c=h.sent(),s=c,[3,4];case 4:return s?[3,6]:(l=e.filter((function(e){return e.generation!==r})),[4,this._store.set({key:this.recordsetKey,value:l,generation:r})]);case 5:return h.sent(),this._onWrite.forEach((function(e){e(i$1.map((function(e){return e.data})));})),[3,7];case 6:this._onError.forEach((function(e){return e(s)})),h.label=7;case 7:return [2]}}))}))},e.prototype.init=function(){return r(this,void 0,void 0,(function(){var e,t,n,r,i$1,s$1,o,a;return i(this,(function(u){switch(u.label){case 0:return e=this,[4,this._store.get(this.metadataKey)];case 1:return e._metadata=u.sent()||{generation:1},[4,this._getReducedRecordset()];case 2:t=u.sent(),u.label=3;case 3:u.trys.push([3,8,9,10]),n=s(t),r=n.next(),u.label=4;case 4:return r.done?[3,7]:(i$1=r.value,[4,this._applyRecord(t,i$1)]);case 5:u.sent(),u.label=6;case 6:return r=n.next(),[3,4];case 7:return [3,10];case 8:return s$1=u.sent(),o={error:s$1},[3,10];case 9:try{r&&!r.done&&(a=n.return)&&a.call(n);}finally{if(o)throw o.error}return [7];case 10:return [2]}}))}))},e.prototype.on=function(e,t,n){switch(e){case tn$1.COMMIT:this._onCommit.set(t,n);break;case tn$1.WRITE:this._onWrite.set(t,n);break;case tn$1.ERROR:this._onError.set(t,n);}},e.prototype.requestWrite=function(e,t){void 0===t&&(t=null),this._requests.push({data:e,options:t}),mn$1.get(this.dbname).put(n({state:nn.PENDING,generation:this.generation},e));},e.prototype.requestMultipleWrite=function(e,t){var n$1,r;void 0===t&&(t=null);var i=mn$1.get(this.dbname);try{for(var s$1=s(e),o=s$1.next();!o.done;o=s$1.next()){var a=o.value;this._requests.push({data:a,options:t}),i.put(n({state:nn.PENDING,generation:this.generation},a));}}catch(e){n$1={error:e};}finally{try{o&&!o.done&&(r=s$1.return)&&r.call(s$1);}finally{if(n$1)throw n$1.error}}},e.prototype.clear=function(){return r(this,void 0,void 0,(function(){return i(this,(function(e){return mn$1.get(this.dbname).clearByCondition((function(e){return e.state===nn.PENDING})),this._requests=[],[2]}))}))},e.prototype.commit=function(){return r(this,void 0,void 0,(function(){var e,t,n$1,r,i$1,s,o,a,u,c,l,d,f=this;return i(this,(function(h){switch(h.label){case 0:if(!((e=this._requests).length>0))return [3,4];for(t=[],n$1={},a=e.length-1;a>=0;a--)r=e[a],c=r.data,n$1[c.key]||(n$1[c.key]=!0,t.unshift(r));return i$1={generation:this.generation,requests:t},[4,this._getReducedRecordset([i$1])];case 1:return s=h.sent(),[4,this._store.set({key:this.recordsetKey,value:s,generation:this.generation})];case 2:return h.sent(),this._metadata.generation++,[4,this._store.set({key:this.metadataKey,value:this._metadata,generation:1})];case 3:for(h.sent(),o=mn$1.get(this.dbname),a=0;a<t.length;a++)u=t[a],c=u.data,l=u.options,o.put(n(n({},c),{generation:i$1.generation,state:l&&l.persistent?nn.PERSISTENT:nn.VOLATILE}));this._requests=[],this._onCommit.forEach((function(t){t(e.map((function(e){return e.data})));})),d=jt.get(this.dbname),setTimeout((function(){try{f._applyRecord(s,i$1);}catch(e){f._onError.forEach((function(t){return t(e)}));}}),d.transactionApplyDelay),h.label=4;case 4:return [2]}}))}))},e}(),bn=function(){function e(e){var t=e.blockId,n=e.keyName,r=e.items,i=void 0===r?[]:r,s=e.limit;this.blockId=t,this.keyName=n,this.limit=s,this._items=a([],o(i),!1);}return e.createFromCacheItem=function(t){return t?new e(t.value):null},Object.defineProperty(e.prototype,"isEmpty",{get:function(){return 0===this._items.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"items",{get:function(){return this._items},enumerable:!1,configurable:!0}),e.prototype.serialize=function(){return {blockId:this.blockId,keyName:this.keyName,limit:this.limit,items:this._items}},e.prototype.getItemByKey=function(e){var t=this;return this._items.find((function(n){var r=n[t.keyName];return e===r}))},e.prototype.has=function(e){var t=this;return this._items.map((function(e){return e[t.keyName]})).includes(e)},e.prototype.add=function(e){var t=this,n=this._items.map((function(e){return e[t.keyName]})).indexOf(e[this.keyName]);return n<0?this._items.length<this.limit&&(this._items.push(e),!0):(this._items[n]=e,!0)},e.prototype.remove=function(e){for(var t in this._items)if(this._items[t][this.keyName]===e)return this._items.splice(parseInt(t),1),!0;return !1},e.prototype.clear=function(){this._items=[];},e}(),gn$1=function(){function e(e){var t=e.dbname,n=e.collectionName,r=e.metadata,i=e.hashFunction,s=void 0===i?Gt:i,o=e.transaction,a=e.store;this.dbname=t,this.collectionName=n,this.hashFunction=s,this.metadata=r,this._transaction=o,this._store=a;}return Object.defineProperty(e.prototype,"keyName",{get:function(){return this.metadata.keyName},enumerable:!1,configurable:!0}),e.prototype.createBlockId=function(e,t){return void 0===t&&(t=this.metadata.blockLevel),n=this.dbname,r=this.collectionName,i=t,s="".concat(function(e,t,n){var r=n.base*Math.pow(n.multiplier,t)+n.constant;return (n.hashFunction||Gt)(e,r)}(e,t,{hashFunction:this.hashFunction,base:this.metadata.blockHashBase,multiplier:this.metadata.blockHashMultiplier,constant:this.metadata.blockHashConstant})),"".concat(hn$1(n,r)).concat(i,".").concat(s);var n,r,i,s;},e.prototype._findBlock=function(e){return r(this,void 0,void 0,(function(){var t,n,r,i$1,s;return i(this,(function(o){switch(o.label){case 0:t=mn$1.get(this.dbname),n=this.metadata.blockLevel,o.label=1;case 1:return n>0?(r=this.createBlockId(e,n),[4,t.find(this._store,r)]):[3,4];case 2:if((i$1=o.sent())&&(s=bn.createFromCacheItem(i$1),s.getItemByKey(e)))return [2,s];o.label=3;case 3:return n--,[3,1];case 4:return [2,null]}}))}))},e.prototype.getFromBlock=function(e){return r(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return [4,this._findBlock(e)];case 1:return [2,(t=n.sent())?t.getItemByKey(e):null]}}))}))},e.prototype.putToBlock=function(e,t){return r(this,void 0,void 0,(function(){var n,r,i$1,s,o;return i(this,(function(a){switch(a.label){case 0:return n=jt.get(this.dbname),r=this.createBlockId(e),i$1=Math.floor(this._store.itemSizeLimit/n.itemSizeLimit),[4,mn$1.get(this.dbname).find(this._store,r)];case 1:return s=a.sent(),(o=s?bn.createFromCacheItem(s):new bn({blockId:r,keyName:this.keyName,items:[],limit:i$1})).add(t)?(this._transaction.requestWrite({key:o.blockId,value:o.serialize()}),[2,!0]):[2,!1]}}))}))},e.prototype.removeFromBlock=function(e){return r(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return [4,this._findBlock(e)];case 1:return (t=n.sent())&&t.remove(e)?(this._transaction.requestWrite({key:t.blockId,value:t.serialize()}),[2,!0]):[2,!1]}}))}))},e.prototype.clearAllBlocks=function(){return r(this,void 0,void 0,(function(){var e,t,n,r,i$1,s$1,o,a,u;return i(this,(function(c){switch(c.label){case 0:return e=hn$1(this.dbname,this.collectionName),[4,this._store.getAllKeys()];case 1:return t=c.sent(),n=t.filter((function(t){return t.startsWith(e)})),[4,this._store.removeMany(n)];case 2:c.sent(),r=mn$1.get(this.dbname);try{for(i$1=s(n),s$1=i$1.next();!s$1.done;s$1=i$1.next())o=s$1.value,r.remove(o);}catch(e){a={error:e};}finally{try{s$1&&!s$1.done&&(u=i$1.return)&&u.call(i$1);}finally{if(a)throw a.error}}return [2]}}))}))},e}(),In=function(){function e(e){var t=e.dbname,n=e.collectionName,r=e.keyName,i=e.fields,s=e.transaction,o=e.store,a=this;this._origin=[],this._table=[],this.dbname=t,this.collectionName=n,this.keyName=r,this.fields=i,this.indexerKey=function(e,t,n){return "".concat(cn$1(e,t),"/index.").concat(n)}(this.dbname,this.collectionName,this.fields.join(">")),this._transaction=s,this._store=o,this._transaction.on(tn$1.COMMIT,this.indexerKey,(function(){return a.commit()})),this._transaction.on(tn$1.ERROR,this.indexerKey,(function(){return a.abort()}));}return e.createKey=function(e){return e.join(">")},e.parseKey=function(e){return e.split(">")},e.prototype._addItem=function(e){var t=e[this.keyName],n=this.getColumnValues(e),r=o(this.indexOf(n),2),i=r[0];return r[1]?!this._table[i].keys.includes(t)&&(this._table[i].keys.push(t),!0):(this._table.splice(i,0,{columnValues:n,keys:[t]}),!0)},e.prototype._removeItem=function(e){var t=e[this.keyName],n=this.getColumnValues(e),r=o(this.indexOf(n),2),i=r[0];if(r[1]){var s=this._table[i].keys.indexOf(t);if(s>-1)return this._table[i].keys.splice(s,1),0===this._table[i].keys.length&&this._table.splice(i,1),!0}return !1},Object.defineProperty(e.prototype,"origin",{get:function(){return this._origin},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"table",{get:function(){return this._table},enumerable:!1,configurable:!0}),e.prototype.getColumnValues=function(e){var t,n,r,i,s$1=[];try{for(var o=s(this.fields),a=o.next();!a.done;a=o.next()){var u=a.value;if("-"===u[0]&&(u=u.slice(1)),r=e[u],i=void 0,i=typeof r,null!==r&&"undefined"!==i&&"boolean"!==i&&"number"!==i&&"string"!==i)throw Vt.indexTypesNotMatch;s$1.push(e[u]);}}catch(e){t={error:e};}finally{try{a&&!a.done&&(n=o.return)&&n.call(o);}finally{if(t)throw t.error}}return s$1},e.prototype.diff=function(e,t){for(var n in this.fields){var r="-"===this.fields[n][0]?-1:1,i=Qt(e[n],t[n]);if(0!==i)return r*i}return 0},e.prototype.indexOf=function(e){if(this._table.length>0){for(var t=0,n=this._table.length-1;t<=n;){var r=Math.floor((t+n)/2),i=this.diff(e,this._table[r].columnValues);if(i>0)t=r+1;else {if(!(i<0))return [r,!0];n=r-1;}}return [t,!1]}return [0,!1]},e.prototype.ensure=function(){return r(this,void 0,void 0,(function(){var e,t,n,r,i$1,s$1,o,a,u,c,l,d,f,p,v,_,m;return i(this,(function(h){switch(h.label){case 0:return [4,(e=mn$1.get(this.dbname)).find(this._store,this.indexerKey,rn$1.PERSISTENT)];case 1:return (t=h.sent())?[3,11]:(n=hn$1(this.dbname,this.collectionName),[4,this._store.getAllKeys()]);case 2:r=h.sent(),h.label=3;case 3:h.trys.push([3,8,9,10]),i$1=s(r),s$1=i$1.next(),h.label=4;case 4:return s$1.done?[3,7]:(o=s$1.value).startsWith(n)?[4,e.find(this._store,o,rn$1.NO_CACHE)]:[3,6];case 5:a=h.sent(),u=bn.createFromCacheItem(a);try{for(_=void 0,c=s(u.items),l=c.next();!l.done;l=c.next())d=l.value,this._addItem(d);}catch(e){_={error:e};}finally{try{l&&!l.done&&(m=c.return)&&m.call(c);}finally{if(_)throw _.error}}h.label=6;case 6:return s$1=i$1.next(),[3,4];case 7:return [3,10];case 8:return f=h.sent(),p={error:f},[3,10];case 9:try{s$1&&!s$1.done&&(v=i$1.return)&&v.call(i$1);}finally{if(p)throw p.error}return [7];case 10:return this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0}),[3,12];case 11:this._origin=t.value,this._table=zt(this._origin),h.label=12;case 12:return [2]}}))}))},e.prototype.drop=function(){return r(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return mn$1.get(this.dbname).remove(this.indexerKey),[4,this._store.remove(this.indexerKey)];case 1:return e.sent(),[2]}}))}))},e.prototype.addItem=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){return this._addItem(e)&&this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0}),[2]}))}))},e.prototype.removeItem=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){return this._removeItem(e)&&this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0}),[2]}))}))},e.prototype.clear=function(){return r(this,void 0,void 0,(function(){return i(this,(function(e){return this._table=[],this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0}),[2]}))}))},e.prototype.commit=function(){this._origin=this._table,this._table=zt(this._origin);},e.prototype.abort=function(){this._table=zt(this._origin);},e}(),wn$1="undefined"!=typeof document&&"undefined"!=typeof navigator;wn$1&&navigator.userAgent&&navigator.userAgent.includes("Chrome/")&&navigator.userAgent.includes("Chromium/");var En$1=wn$1&&navigator.userAgent&&navigator.userAgent.includes("Firefox/")&&!navigator.userAgent.includes("Seamonkey/");wn$1&&navigator.userAgent&&navigator.userAgent.includes("Safari/")&&!navigator.userAgent.includes("Chrome/")&&navigator.userAgent.includes("Chromium/"),wn$1&&navigator.userAgent&&(navigator.userAgent.includes("OPR/")||navigator.userAgent.includes("Opera/")),wn$1&&navigator.userAgent&&navigator.userAgent.includes("Trident/7.0");var kn,Nn$1,On=wn$1&&navigator.userAgent&&navigator.userAgent.includes("Edge/"),Sn=function(){var e=(new Date).getTime();return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:3&n|8).toString(16)}))};!function(e){e[e.PROCESSING=0]="PROCESSING",e[e.DONE=1]="DONE";}(kn||(kn={})),function(e){e.NEWNODE="newnode",e.REMOVENODE="removenode",e.CLAIM_HOST="claimhost",e.SYNC_HOST="synchost",e.REQUEST_LOCK="requestlock",e.ACQUIRE_LOCK="acquirelock",e.RELEASE_LOCK="releaselock";}(Nn$1||(Nn$1={}));var Tn$1,xn={},Cn$1=function(){function e(e,t){void 0===t&&(t={});var n=this;return this._state=kn.PROCESSING,this._hostId=null,this._queue=[],this._currentItem=null,this._activationTimeout=null,this._activationQueue=[],xn[e]&&!t.forceCreate||(this.nodeId=Sn(),this.key=e,wn$1&&(t.startAsInvisible?this.registerNode():"visible"===document.visibilityState?this.claimHost():this.registerNode(),document.addEventListener("visibilitychange",(function(){"visible"===document.visibilityState&&n.claimHost();})),window.addEventListener("message",(function(e){var t,r,i=e.data,s$1=i.nodeId,o=i.requestId,a=i.key,u=i.op,c=i.data;if(s$1!==n.nodeId&&a===n.key)switch(u){case Nn$1.NEWNODE:n._sendSync();break;case Nn$1.CLAIM_HOST:n._sendSync(),n._hostId=s$1;break;case Nn$1.SYNC_HOST:if(!n.isInSync){n._activationTimeout&&clearTimeout(n._activationTimeout);var l=c,h=l.currentItemRequestId,d=l.queue,f=function(e){var t=n._queue.findIndex((function(t){return t.requestId===e.requestId}));t<0&&n._requestLock({nodeId:e.nodeId,requestId:e.requestId,key:n.key,op:Nn$1.REQUEST_LOCK,ts:e.ts});};try{for(var p=s(d),v=p.next();!v.done;v=p.next()){f(v.value);}}catch(e){t={error:e};}finally{try{v&&!v.done&&(r=p.return)&&r.call(p);}finally{if(t)throw t.error}}n._currentItem=n._queue.find((function(e){return e.requestId===h})),n._completeSync();}break;case Nn$1.REMOVENODE:n._queue=n._queue.filter((function(e){return e.nodeId!==i.nodeId})),n._currentItem&&n._currentItem.nodeId===i.nodeId&&(n._currentItem=null,n._acquire(n._queue[0]));break;case Nn$1.REQUEST_LOCK:n._requestLock(i);break;case Nn$1.ACQUIRE_LOCK:var _=n._queue.find((function(e){return e.requestId===o}));n._acquire(_);break;case Nn$1.RELEASE_LOCK:n._release(o);}})),window.addEventListener("beforeunload",(function(){n._send(Nn$1.REMOVENODE);}))),xn[e]=this),xn[e]}return Object.defineProperty(e.prototype,"locked",{get:function(){return !!this._currentItem},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isHost",{get:function(){return this._hostId===this.nodeId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isInSync",{get:function(){return this._state==kn.DONE},enumerable:!1,configurable:!0}),e.prototype._send=function(e,t){var n,r;void 0===t&&(t={});var i={nodeId:this.nodeId,requestId:null!==(n=null==t?void 0:t.requestId)&&void 0!==n?n:Sn(),key:this.key,op:e,data:null!==(r=t.data)&&void 0!==r?r:null,ts:Date.now()};return wn$1&&window.postMessage(i,"*"),i},e.prototype._acquire=function(e){void 0===e&&(e=null),e?(this._currentItem=e,this._currentItem.onAcquired(e.requestId)):this._currentItem=null;},e.prototype._release=function(e){if(this._currentItem&&this._currentItem.requestId===e){var t=this._currentItem;this._currentItem=null,t.nodeId===this.nodeId&&this._send(Nn$1.RELEASE_LOCK,{requestId:t.requestId});var n=this._queue.findIndex((function(t){return t.requestId===e}));n>-1&&this._queue.splice(n,1),t.onReleased(e);}},e.prototype._requestLock=function(e){var t=this;return new Promise((function(n){var r={nodeId:e.nodeId,requestId:e.requestId,ts:e.ts,onAcquired:function(e){t.isHost&&t._send(Nn$1.ACQUIRE_LOCK,{requestId:e}),n();},onReleased:function(){t._acquire(t._queue[0]);}},i=!1;for(var s in t._queue)if(t._queue[s].ts>r.ts){t._queue.splice(parseInt(s),0,r),i=!0;break}i||t._queue.push(r),t._currentItem||t._acquire(t._queue[0]);}))},e.prototype._sendSync=function(){var e;this.isHost&&this._send(Nn$1.SYNC_HOST,{data:{currentItemRequestId:null===(e=this._currentItem)||void 0===e?void 0:e.requestId,queue:this._queue.map((function(e){return {nodeId:e.nodeId,requestId:e.requestId,ts:e.ts}}))}});},e.prototype._waitUntilSyncCompleted=function(){return r(this,void 0,void 0,(function(){var e=this;return i(this,(function(t){return this.isHost&&!this.isInSync?[2,new Promise((function(t){e._activationQueue.push(t);}))]:[2]}))}))},e.prototype._waitSync=function(){var e=this;this.isInSync||(this._activationTimeout=setTimeout((function(){e._completeSync();}),8));},e.prototype._completeSync=function(){this.isInSync||(this._state=kn.DONE,this._activationQueue.forEach((function(e){return e()})),this._activationQueue=[]);},e.prototype.registerNode=function(){this._send(Nn$1.NEWNODE),this._waitSync();},e.prototype.claimHost=function(){this._hostId=this.nodeId,this._send(Nn$1.CLAIM_HOST),this._waitSync();},e.prototype.lock=function(){return r(this,void 0,void 0,(function(){var e;return i(this,(function(t){switch(t.label){case 0:return [4,this._waitUntilSyncCompleted()];case 1:return t.sent(),e=this._send(Nn$1.REQUEST_LOCK),[4,this._requestLock(e)];case 2:return t.sent(),[2]}}))}))},e.prototype.unlock=function(){var e;this._release(null===(e=this._currentItem)||void 0===e?void 0:e.requestId);},e}(),Rn=function(){function e(e){var t=e.dbname,n=e.collectionName,r=e.keyName,i=e.keyHash,s=e.indexes,o$1=e.store,a$1=this;this._state=Ht.INIT,this._metadata=null,this._indexers=[],this.dbname=t,this.name=n,this.keyName=r,this.indexes=a([[r]],o(s.filter((function(e){return In.createKey(e)!==a$1.keyName}))),!1),this._keyHash=i,this._store=o$1,this._mutex=new Cn$1(function(e,t){return "".concat(cn$1(e,t),".lock")}(t,n)),this._blobContainer=new pn$1({dbname:t,collectionName:n,store:o$1}),this._transaction=new yn$1({dbname:t,collectionName:n,store:o$1});}return e.metadataOf=function(e,t,n){return r(this,void 0,void 0,(function(){var r;return i(this,(function(i){switch(i.label){case 0:return r=ln$1(e,t),[4,n.get(r)];case 1:return [2,i.sent()]}}))}))},Object.defineProperty(e.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isReady",{get:function(){return this._state===Ht.READY},enumerable:!1,configurable:!0}),e.prototype.init=function(){return r(this,void 0,void 0,(function(){var t,n,r,i$1,s$1,o$1,a$1,u,c,l,d,f,p,v,_=this;return i(this,(function(h){switch(h.label){case 0:return [4,this._mutex.lock()];case 1:h.sent(),h.label=2;case 2:return h.trys.push([2,9,,10]),t=jt.get(this.dbname),[4,e.metadataOf(this.dbname,this.name,this._store)];case 3:return n=h.sent(),this._metadata=n||{keyName:this.keyName,blockLevel:1,blockHashBase:t.blockHashBase,blockHashMultiplier:t.blockHashMultiplier,blockHashConstant:t.blockHashConstant,indexes:this.indexes},[4,this._transaction.init()];case 4:h.sent(),this._blockManager=new gn$1({dbname:this.dbname,collectionName:this.name,hashFunction:this._keyHash,metadata:this._metadata,transaction:this._transaction,store:this._store}),r=a([],o(this.indexes),!1),i$1=[],s$1=r.map((function(e){return In.createKey(e)})),o$1=n?n.indexes.map((function(e){return In.createKey(e)})):[];try{for(a$1=s(o$1),u=a$1.next();!u.done;u=a$1.next())c=u.value,s$1.includes(c)||i$1.push(In.parseKey(c));}catch(e){p={error:e};}finally{try{u&&!u.done&&(v=a$1.return)&&v.call(a$1);}finally{if(p)throw p.error}}return (l=[]).push.apply(l,a([],o(r.map((function(e){var t=new In({dbname:_.dbname,collectionName:_.name,keyName:_.keyName,fields:e,transaction:_._transaction,store:_._store});return _._indexers.push(t),t.ensure()}))),!1)),l.push.apply(l,a([],o(i$1.map((function(e){return new In({dbname:_.dbname,collectionName:_.name,keyName:_.keyName,fields:e,transaction:_._transaction,store:_._store}).drop()}))),!1)),[4,Promise.all(l)];case 5:return h.sent(),[4,this._transaction.commit()];case 6:return h.sent(),s$1.sort().join(",")===o$1.sort().join(",")?[3,8]:(d=ln$1(this.dbname,this.name),this._metadata.indexes=r,[4,this._store.set({key:d,value:this._metadata,generation:1})]);case 7:h.sent(),h.label=8;case 8:return this._state=Ht.READY,this._mutex.unlock(),[3,10];case 9:throw f=h.sent(),this._mutex.unlock(),f;case 10:return [2]}}))}))},e.prototype.close=function(){this._state=Ht.CLOSED;},e.prototype._hasPropertyOfKeyName=function(e){var t=e[this.keyName];return "string"==typeof t&&!!t},e.prototype._getIndexerBy=function(e){var t,n;void 0===e&&(e=null),e||(e=[this.keyName]);var r=In.createKey(e);try{for(var i=s(this._indexers),s$1=i.next();!s$1.done;s$1=i.next()){var o=s$1.value;if(r===In.createKey(o.fields))return o}}catch(e){t={error:e};}finally{try{s$1&&!s$1.done&&(n=i.return)&&n.call(i);}finally{if(t)throw t.error}}return null},e.prototype._upgradeBlockLevel=function(){return r(this,void 0,void 0,(function(){var e;return i(this,(function(t){switch(t.label){case 0:return e=ln$1(this.dbname,this.name),this._metadata.blockLevel++,[4,this._store.set({key:e,value:this._metadata,generation:1})];case 1:return t.sent(),[2]}}))}))},e.prototype._requestInsert=function(e){return r(this,void 0,void 0,(function(){var t,n,r,i$1,s$1,o;return i(this,(function(a){switch(a.label){case 0:return t=e[this.keyName],[4,this._blockManager.getFromBlock(t)];case 1:return a.sent()?[3,13]:[4,this._blockManager.putToBlock(t,e)];case 2:return a.sent()?[3,5]:[4,this._upgradeBlockLevel()];case 3:return a.sent(),[4,this._blockManager.putToBlock(t,e)];case 4:a.sent(),a.label=5;case 5:a.trys.push([5,10,11,12]),n=s(this._indexers),r=n.next(),a.label=6;case 6:return r.done?[3,9]:[4,r.value.addItem(e)];case 7:a.sent(),a.label=8;case 8:return r=n.next(),[3,6];case 9:return [3,12];case 10:return i$1=a.sent(),s$1={error:i$1},[3,12];case 11:try{r&&!r.done&&(o=n.return)&&o.call(n);}finally{if(s$1)throw s$1.error}return [7];case 12:return [3,14];case 13:throw Vt.collectionInsertDuplicate;case 14:return [2]}}))}))},e.prototype._requestUpsert=function(e){return r(this,void 0,void 0,(function(){var t,n,r,i$1,s$1,o,a,u,c,l,d,f,p;return i(this,(function(h){switch(h.label){case 0:return t=e[this.keyName],[4,this._blockManager.getFromBlock(t)];case 1:return (n=h.sent())?[3,13]:[4,this._blockManager.putToBlock(t,e)];case 2:return h.sent()?[3,5]:[4,this._upgradeBlockLevel()];case 3:return h.sent(),[4,this._blockManager.putToBlock(t,e)];case 4:h.sent(),h.label=5;case 5:h.trys.push([5,10,11,12]),r=s(this._indexers),i$1=r.next(),h.label=6;case 6:return i$1.done?[3,9]:[4,(u=i$1.value).addItem(e)];case 7:h.sent(),h.label=8;case 8:return i$1=r.next(),[3,6];case 9:return [3,12];case 10:return s$1=h.sent(),l={error:s$1},[3,12];case 11:try{i$1&&!i$1.done&&(d=r.return)&&d.call(r);}finally{if(l)throw l.error}return [7];case 12:return [3,23];case 13:return [4,this._blockManager.putToBlock(t,e)];case 14:h.sent(),h.label=15;case 15:h.trys.push([15,21,22,23]),o=s(this._indexers),a=o.next(),h.label=16;case 16:return a.done?[3,20]:0===(u=a.value).diff(u.getColumnValues(n),u.getColumnValues(e))?[3,19]:[4,u.removeItem(n)];case 17:return h.sent(),[4,u.addItem(e)];case 18:h.sent(),h.label=19;case 19:return a=o.next(),[3,16];case 20:return [3,23];case 21:return c=h.sent(),f={error:c},[3,23];case 22:try{a&&!a.done&&(p=o.return)&&p.call(o);}finally{if(f)throw f.error}return [7];case 23:return [2]}}))}))},e.prototype._requestUpdate=function(e){return r(this,void 0,void 0,(function(){var t,n,r,i$1,s$1,o,a,u;return i(this,(function(c){switch(c.label){case 0:return t=e[this.keyName],[4,this._blockManager.getFromBlock(t)];case 1:return (n=c.sent())?[4,this._blockManager.putToBlock(t,e)]:[3,11];case 2:c.sent(),c.label=3;case 3:c.trys.push([3,9,10,11]),r=s(this._indexers),i$1=r.next(),c.label=4;case 4:return i$1.done?[3,8]:0===(s$1=i$1.value).diff(s$1.getColumnValues(n),s$1.getColumnValues(e))?[3,7]:[4,s$1.removeItem(n)];case 5:return c.sent(),[4,s$1.addItem(e)];case 6:c.sent(),c.label=7;case 7:return i$1=r.next(),[3,4];case 8:return [3,11];case 9:return o=c.sent(),a={error:o},[3,11];case 10:try{i$1&&!i$1.done&&(u=r.return)&&u.call(r);}finally{if(a)throw a.error}return [7];case 11:return [2]}}))}))},e.prototype._requestRemove=function(e){return r(this,void 0,void 0,(function(){var t,n,r,i$1,s$1,o;return i(this,(function(a){switch(a.label){case 0:return [4,this._blockManager.getFromBlock(e)];case 1:return (t=a.sent())?[4,this._blockManager.removeFromBlock(e)]:[3,10];case 2:a.sent(),a.label=3;case 3:a.trys.push([3,8,9,10]),n=s(this._indexers),r=n.next(),a.label=4;case 4:return r.done?[3,7]:[4,r.value.removeItem(t)];case 5:a.sent(),a.label=6;case 6:return r=n.next(),[3,4];case 7:return [3,10];case 8:return i$1=a.sent(),s$1={error:i$1},[3,10];case 9:try{r&&!r.done&&(o=n.return)&&o.call(n);}finally{if(s$1)throw s$1.error}return [7];case 10:return [2]}}))}))},e.prototype._requestClear=function(){return r(this,void 0,void 0,(function(){var e,t,n,r,i$1;return i(this,(function(s$1){switch(s$1.label){case 0:return [4,this._blockManager.clearAllBlocks()];case 1:s$1.sent(),s$1.label=2;case 2:s$1.trys.push([2,7,8,9]),e=s(this._indexers),t=e.next(),s$1.label=3;case 3:return t.done?[3,6]:[4,t.value.clear()];case 4:s$1.sent(),s$1.label=5;case 5:return t=e.next(),[3,3];case 6:return [3,9];case 7:return n=s$1.sent(),r={error:n},[3,9];case 8:try{t&&!t.done&&(i$1=e.return)&&i$1.call(e);}finally{if(r)throw r.error}return [7];case 9:return [2]}}))}))},e.prototype.getByKey=function(e){return r(this,void 0,void 0,(function(){var t,n;return i(this,(function(r){switch(r.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,6];case 1:r.sent(),r.label=2;case 2:return r.trys.push([2,4,,5]),[4,this._blockManager.getFromBlock(e)];case 3:return t=r.sent(),this._mutex.unlock(),[2,zt(t)];case 4:throw n=r.sent(),this._mutex.unlock(),n;case 5:return [3,7];case 6:throw Vt.collectionNotReady;case 7:return [2]}}))}))},e.prototype.query=function(e){return void 0===e&&(e={}),this.isReady?new an$1({condition:e.where,mutex:this._mutex,blockManager:this._blockManager,indexer:this._getIndexerBy(e.index),backward:!!e.backward}):null},e.prototype.insertOne=function(e){return r(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:n.sent(),n.label=2;case 2:if(n.trys.push([2,5,,7]),!this._hasPropertyOfKeyName(e))throw Vt.collectionKeyNotGiven;return [4,this._requestInsert(zt(e))];case 3:return n.sent(),[4,this._transaction.commit()];case 4:return n.sent(),this._mutex.unlock(),[2,e];case 5:return t=n.sent(),[4,this._transaction.clear()];case 6:throw n.sent(),this._mutex.unlock(),t;case 7:return [3,9];case 8:throw Vt.collectionNotReady;case 9:return [2]}}))}))},e.prototype.insertMany=function(e){return r(this,void 0,void 0,(function(){var t,n,r,i$1,s$1,o,a,u=this;return i(this,(function(c){switch(c.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,15];case 1:c.sent(),c.label=2;case 2:if(c.trys.push([2,12,,14]),e.some((function(e){return !u._hasPropertyOfKeyName(e)})))throw Vt.collectionKeyNotGiven;c.label=3;case 3:c.trys.push([3,8,9,10]),t=s(e),n=t.next(),c.label=4;case 4:return n.done?[3,7]:(r=n.value,[4,this._requestInsert(zt(r))]);case 5:c.sent(),c.label=6;case 6:return n=t.next(),[3,4];case 7:return [3,10];case 8:return i$1=c.sent(),o={error:i$1},[3,10];case 9:try{n&&!n.done&&(a=t.return)&&a.call(t);}finally{if(o)throw o.error}return [7];case 10:return [4,this._transaction.commit()];case 11:return c.sent(),this._mutex.unlock(),[2,e];case 12:return s$1=c.sent(),[4,this._transaction.clear()];case 13:throw c.sent(),this._mutex.unlock(),s$1;case 14:return [3,16];case 15:throw Vt.collectionNotReady;case 16:return [2]}}))}))},e.prototype.upsertOne=function(e){return r(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:n.sent(),n.label=2;case 2:if(n.trys.push([2,5,,7]),!this._hasPropertyOfKeyName(e))throw Vt.collectionKeyNotGiven;return [4,this._requestUpsert(zt(e))];case 3:return n.sent(),[4,this._transaction.commit()];case 4:return n.sent(),this._mutex.unlock(),[2,e];case 5:return t=n.sent(),[4,this._transaction.clear()];case 6:throw n.sent(),this._mutex.unlock(),t;case 7:return [3,9];case 8:throw Vt.collectionNotReady;case 9:return [2]}}))}))},e.prototype.upsertMany=function(e){return r(this,void 0,void 0,(function(){var t,n,r,i$1,s$1,o,a,u=this;return i(this,(function(c){switch(c.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,15];case 1:c.sent(),c.label=2;case 2:if(c.trys.push([2,12,,14]),e.some((function(e){return !u._hasPropertyOfKeyName(e)})))throw Vt.collectionKeyNotGiven;c.label=3;case 3:c.trys.push([3,8,9,10]),t=s(e),n=t.next(),c.label=4;case 4:return n.done?[3,7]:(r=n.value,[4,this._requestUpsert(zt(r))]);case 5:c.sent(),c.label=6;case 6:return n=t.next(),[3,4];case 7:return [3,10];case 8:return i$1=c.sent(),o={error:i$1},[3,10];case 9:try{n&&!n.done&&(a=t.return)&&a.call(t);}finally{if(o)throw o.error}return [7];case 10:return [4,this._transaction.commit()];case 11:return c.sent(),this._mutex.unlock(),[2,e];case 12:return s$1=c.sent(),[4,this._transaction.clear()];case 13:throw c.sent(),this._mutex.unlock(),s$1;case 14:return [3,16];case 15:throw Vt.collectionNotReady;case 16:return [2]}}))}))},e.prototype.update=function(e){return r(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:n.sent(),n.label=2;case 2:if(n.trys.push([2,5,,7]),!this._hasPropertyOfKeyName(e))throw Vt.collectionKeyNotGiven;return [4,this._requestUpdate(zt(e))];case 3:return n.sent(),[4,this._transaction.commit()];case 4:return n.sent(),this._mutex.unlock(),[2,e];case 5:return t=n.sent(),[4,this._transaction.clear()];case 6:throw n.sent(),this._mutex.unlock(),t;case 7:return [3,9];case 8:throw Vt.collectionNotReady;case 9:return [2]}}))}))},e.prototype.updateIf=function(e,t){return r(this,void 0,void 0,(function(){var n,r$1,i$1,s$1,o,a,c,l,d,f,p,v,_,m,y=this;return i(this,(function(b){switch(b.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,16];case 1:b.sent(),b.label=2;case 2:return b.trys.push([2,13,,15]),n=e.where,r$1=void 0===n?{}:n,i$1=e.index,s$1=void 0===i$1?null:i$1,o=e.backward,a=void 0!==o&&o,c=[],[4,new on$1({condition:r$1,blockManager:this._blockManager,backward:a,indexer:this._getIndexerBy(s$1)}).each((function(e){return r(y,void 0,void 0,(function(){var n,i$1;return i(this,(function(s){if(e.error)throw e.stop(),e.error;if(e.hasNext){if(n=e.nextValue,Jt(r$1,n)&&t.set){if("function"!=typeof t.set)for(i$1 in t.set)n[i$1]=t.set[i$1];else t.set(n);c.push(n);}e.next();}else e.stop();return [2]}))}))}))];case 3:b.sent(),b.label=4;case 4:b.trys.push([4,9,10,11]),l=s(c),d=l.next(),b.label=5;case 5:return d.done?[3,8]:(f=d.value,[4,this._requestUpdate(zt(f))]);case 6:b.sent(),b.label=7;case 7:return d=l.next(),[3,5];case 8:return [3,11];case 9:return p=b.sent(),_={error:p},[3,11];case 10:try{d&&!d.done&&(m=l.return)&&m.call(l);}finally{if(_)throw _.error}return [7];case 11:return [4,this._transaction.commit()];case 12:return b.sent(),this._mutex.unlock(),[2,c];case 13:return v=b.sent(),[4,this._transaction.clear()];case 14:throw b.sent(),this._mutex.unlock(),v;case 15:return [3,17];case 16:throw this._transaction.clear(),Vt.collectionNotReady;case 17:return [2]}}))}))},e.prototype.remove=function(e){return r(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:n.sent(),n.label=2;case 2:return n.trys.push([2,5,,7]),[4,this._requestRemove(e)];case 3:return n.sent(),[4,this._transaction.commit()];case 4:return n.sent(),this._mutex.unlock(),[3,7];case 5:return t=n.sent(),[4,this._transaction.clear()];case 6:throw n.sent(),this._mutex.unlock(),t;case 7:return [3,9];case 8:throw Vt.collectionNotReady;case 9:return [2]}}))}))},e.prototype.removeIf=function(e){return r(this,void 0,void 0,(function(){var t,n,r$1,i$1,s$1,o,a,c,l,d,f,p,v,_,m=this;return i(this,(function(y){switch(y.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,15];case 1:y.sent(),y.label=2;case 2:return y.trys.push([2,13,,14]),t=e.where,n=void 0===t?{}:t,r$1=e.index,i$1=void 0===r$1?null:r$1,s$1=e.backward,o=void 0!==s$1&&s$1,a=[],[4,new on$1({condition:n,blockManager:this._blockManager,backward:o,indexer:this._getIndexerBy(i$1)}).each((function(e){return r(m,void 0,void 0,(function(){var t,r;return i(this,(function(i){if(e.error)throw e.stop(),e.error;return e.hasNext?(t=e.nextValue,Jt(n,t)&&(r=t[this.keyName],a.push(r)),e.next()):e.stop(),[2]}))}))}))];case 3:y.sent(),y.label=4;case 4:y.trys.push([4,9,10,11]),c=s(a),l=c.next(),y.label=5;case 5:return l.done?[3,8]:(d=l.value,[4,this._requestRemove(d)]);case 6:y.sent(),y.label=7;case 7:return l=c.next(),[3,5];case 8:return [3,11];case 9:return f=y.sent(),v={error:f},[3,11];case 10:try{l&&!l.done&&(_=c.return)&&_.call(c);}finally{if(v)throw v.error}return [7];case 11:return [4,this._transaction.commit()];case 12:return y.sent(),this._mutex.unlock(),[2,a];case 13:throw p=y.sent(),this._mutex.unlock(),p;case 14:return [3,16];case 15:throw this._transaction.clear(),Vt.collectionNotReady;case 16:return [2]}}))}))},e.prototype.clear=function(){return r(this,void 0,void 0,(function(){var e;return i(this,(function(t){switch(t.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:t.sent(),t.label=2;case 2:return t.trys.push([2,5,,7]),[4,this._requestClear()];case 3:return t.sent(),[4,this._transaction.commit()];case 4:return t.sent(),this._mutex.unlock(),[3,7];case 5:return e=t.sent(),[4,this._transaction.clear()];case 6:throw t.sent(),this._mutex.unlock(),e;case 7:return [3,9];case 8:throw Vt.collectionNotReady;case 9:return [2]}}))}))},e.prototype.getBlob=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return [4,this._blobContainer.get(e)];case 1:return [2,t.sent()]}}))}))},e.prototype.saveBlob=function(e,t){return void 0===t&&(t=null),r(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return [4,this._blobContainer.save(e,t)];case 1:return [2,n.sent()]}}))}))},e.prototype.removeBlob=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return [4,this._blobContainer.remove(e)];case 1:return t.sent(),[2]}}))}))},e.prototype.removeAllBlobs=function(){return r(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return [4,this._blobContainer.clear()];case 1:return e.sent(),[2]}}))}))},e}(),Ln={},Pn=function(){function e(e){void 0===e&&(e={});var t=e.itemSizeLimit,n=void 0===t?4194304:t,r=e.delay,i=void 0===r?1:r,s=e.encryption,o=void 0===s?A:s;this._encryption=o,this.itemSizeLimit=n,this.delay=i,this.observer={};}return Object.defineProperty(e.prototype,"rawData",{get:function(){return Ln[this.dbname]},set:function(e){Ln[this.dbname]=e;},enumerable:!1,configurable:!0}),e.prototype.observe=function(e,t,n){var r=this;this.observer[e]={},t.forEach((function(t){return r.observer[e][t]=n}));},e.prototype.init=function(e){return r(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:this.dbname=e,Ln[this.dbname]={},n.label=1;case 1:return n.trys.push([1,,3,5]),[4,this.get(N.key)];case 2:if((t=n.sent())&&JSON.stringify(t)!==JSON.stringify(N.value))throw Vt.storeEncryptionInvalid;return [3,5];case 3:return [4,this.set(N)];case 4:return n.sent(),[7];case 5:return [2]}}))}))},e.prototype.getAllKeys=function(){return r(this,void 0,void 0,(function(){return i(this,(function(e){return [2,Object.keys(Ln[this.dbname]).filter((function(e){return e!==N.key}))]}))}))},e.prototype.get=function(e){return r(this,void 0,void 0,(function(){var t,n;return i(this,(function(r){switch(r.label){case 0:return [4,Yt(this.delay)];case 1:if(r.sent(),t=this.observer[e],n=t&&t.get?t.get(e):null)throw n;return [2,Ln[this.dbname][e]?this._encryption.decrypt(Ln[this.dbname][e]):null]}}))}))},e.prototype.set=function(e){return r(this,void 0,void 0,(function(){var t,n,r,i$1,s,o;return i(this,(function(a){switch(a.label){case 0:return [4,Yt(this.delay)];case 1:if(a.sent(),t=e.key,n=e.value,r=this.observer[t],i$1=r&&r.set?r.set(t):null)throw i$1;if(s=this._encryption.encrypt(n),o=JSON.stringify(s),t===N.key||o.length<this.itemSizeLimit)return Ln[this.dbname][t]=s,[2,Ln[this.dbname][t]];throw Vt.storeItemSizeExceeded}}))}))},e.prototype.setMany=function(e){return r(this,void 0,void 0,(function(){var t,n=this;return i(this,(function(r){switch(r.label){case 0:return [4,Yt(this.delay)];case 1:return r.sent(),t=[],e.forEach((function(e){var r=e.key,i=e.value,s=n.observer[r];if(s&&s.set?s.set(r):null)t.push(Vt.collectionWriteFailed);else {var o=n._encryption.encrypt(i),a=JSON.stringify(o);r===N.key||a.length<n.itemSizeLimit?(Ln[n.dbname][r]=o,t.push(i)):t.push(Vt.storeItemSizeExceeded);}})),[2,t]}}))}))},e.prototype.remove=function(e){return r(this,void 0,void 0,(function(){var t,n;return i(this,(function(r){switch(r.label){case 0:return [4,Yt(this.delay)];case 1:if(r.sent(),t=this.observer[e],n=t&&t.remove?t.remove(e):null)throw n;return Ln[this.dbname][e]&&delete Ln[this.dbname][e],[2,e]}}))}))},e.prototype.removeMany=function(e){return r(this,void 0,void 0,(function(){var t,n,r,i$1,s$1,o,a;return i(this,(function(u){switch(u.label){case 0:return [4,Yt(this.delay)];case 1:u.sent();try{for(t=s(e),n=t.next();!n.done;n=t.next()){if(r=n.value,i$1=this.observer[r],s$1=i$1&&i$1.remove?i$1.remove(r):null)throw s$1;Ln[this.dbname][r]&&delete Ln[this.dbname][r];}}catch(e){o={error:e};}finally{try{n&&!n.done&&(a=t.return)&&a.call(t);}finally{if(o)throw o.error}}return [2,e]}}))}))},e.prototype.clear=function(){return r(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return [4,Yt(this.delay)];case 1:return e.sent(),Ln[this.dbname]={},[2]}}))}))},e}(),An=function(){function e(e){void 0===e&&(e={}),this.itemSizeLimit=104857600;var t=e.encryption,n=void 0===t?A:t;this._window="undefined"!=typeof window?window:null,this._indexedDB=this._window?this._window.indexedDB||this._window.mozIndexedDB||this._window.webkitIndexedDB||this._window.msIndexedDB:null,this._encryption=n;}return e.prototype.init=function(e){return r(this,void 0,void 0,(function(){var t,n,r=this;return i(this,(function(i){switch(i.label){case 0:return this.dbname=e,[4,new Promise((function(e,t){if(r._window&&wn$1)if(En$1){var n=r._indexedDB.open("_testMozilla");n.onerror=function(){return t(Vt.storeNotAvailableInPrivateBrowsing)},n.onsuccess=function(){return e()};}else On?r._window.indexedDB||!r._window.PointerEvent&&!r._window.MSPointerEvent||t(Vt.storeNotAvailableInPrivateBrowsing):e();else t(Vt.storeNotAvailable);}))];case 1:return i.sent(),t=this,[4,new Promise((function(t,n){var i=r._indexedDB.open(e);i.addEventListener("upgradeneeded",(function(e){e.target.result.createObjectStore("NestDBStore",{keyPath:"key"});})),i.addEventListener("success",(function(e){return t(e.target.result)})),i.addEventListener("error",(function(e){return n(e.target.error)}));}))];case 2:t._database=i.sent(),i.label=3;case 3:return i.trys.push([3,,5,7]),[4,this.get(N.key)];case 4:if((n=i.sent())&&JSON.stringify(n)!==JSON.stringify(N.value))throw Vt.storeEncryptionInvalid;return [3,7];case 5:return [4,this.set(N)];case 6:return i.sent(),[7];case 7:return [2]}}))}))},e.prototype.getAllKeys=function(){return r(this,void 0,void 0,(function(){var e=this;return i(this,(function(t){switch(t.label){case 0:return [4,new Promise((function(t,n){var r=e._database.transaction("NestDBStore","readonly").objectStore("NestDBStore").getAllKeys();r.addEventListener("success",(function(e){t(e.target.result.filter((function(e){return e!==N.key})));})),r.addEventListener("error",(function(e){return n(e.target.error)}));}))];case 1:return [2,t.sent()]}}))}))},e.prototype.get=function(e){return r(this,void 0,void 0,(function(){var t=this;return i(this,(function(n){switch(n.label){case 0:return [4,new Promise((function(n,r){var i=t._database.transaction("NestDBStore","readonly").objectStore("NestDBStore").get(e);i.addEventListener("success",(function(e){return n(e.target.result?t._encryption.decrypt(e.target.result.value):null)})),i.addEventListener("error",(function(e){return r(e.target.error)}));}))];case 1:return [2,n.sent()]}}))}))},e.prototype.set=function(e){return r(this,void 0,void 0,(function(){var t,n,r=this;return i(this,(function(i){switch(i.label){case 0:return t=e.key,n=e.value,[4,new Promise((function(e,i){var s=r._database.transaction("NestDBStore","readwrite").objectStore("NestDBStore").put({key:t,value:r._encryption.encrypt(n)});s.addEventListener("success",(function(t){e(t.target.result);})),s.addEventListener("error",(function(e){return i(e.target.error)}));}))];case 1:return i.sent(),[2,n]}}))}))},e.prototype.setMany=function(e){return r(this,void 0,void 0,(function(){var t,n,r=this;return i(this,(function(i){switch(i.label){case 0:return t=[],n=this._database.transaction("NestDBStore","readwrite").objectStore("NestDBStore"),e.forEach((function(e){var i=e.key,s=e.value;t.push(new Promise((function(e){var t=n.put({key:i,value:r._encryption.encrypt(s)});t.addEventListener("success",(function(t){e(t.target.result);})),t.addEventListener("error",(function(){e(Vt.collectionWriteFailed);}));})));})),[4,Promise.all(t)];case 1:return i.sent(),[2,e.map((function(e){return e.value}))]}}))}))},e.prototype.remove=function(e){return r(this,void 0,void 0,(function(){var t=this;return i(this,(function(n){switch(n.label){case 0:return [4,new Promise((function(n,r){var i=t._database.transaction("NestDBStore","readwrite").objectStore("NestDBStore").delete(e);i.addEventListener("success",(function(){return n(e)})),i.addEventListener("error",(function(e){return r(e.target.error)}));}))];case 1:return [2,n.sent()]}}))}))},e.prototype.removeMany=function(e){return r(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return t=this._database.transaction("NestDBStore","readwrite").objectStore("NestDBStore"),[4,Promise.all(e.map((function(e){return new Promise((function(n,r){var i=t.delete(e);i.addEventListener("success",(function(){return n(e)})),i.addEventListener("error",(function(e){return r(e.target.error)}));}))})))];case 1:return [2,n.sent()]}}))}))},e.prototype.clear=function(){return r(this,void 0,void 0,(function(){var e=this;return i(this,(function(t){switch(t.label){case 0:return [4,new Promise((function(t,n){var r=e._database.transaction("NestDBStore","readwrite").objectStore("NestDBStore").clear();r.addEventListener("success",(function(){return t()})),r.addEventListener("error",(function(e){return n(e.target.error)}));}))];case 1:return [2,t.sent()]}}))}))},e}(),Dn=function(){function e(e){var t=e.AsyncStorage,n=e.encryption,r=void 0===n?A:n;this.itemSizeLimit=6291456,this._asyncStorage=t,this._encryption=r;}return e.prototype._isBelonging=function(e){return e.startsWith("".concat(this.dbname,"/"))},e.prototype._getActualKey=function(e){return "".concat(this.dbname,"/").concat(e)},e.prototype.init=function(e){return r(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:this.dbname=e,n.label=1;case 1:return n.trys.push([1,,3,5]),[4,this.get(N.key)];case 2:if((t=n.sent())&&JSON.stringify(t)!==JSON.stringify(N.value))throw Vt.storeEncryptionInvalid;return [3,5];case 3:return [4,this.set(N)];case 4:return n.sent(),[7];case 5:return [2]}}))}))},e.prototype.getAllKeys=function(){return r(this,void 0,void 0,(function(){var e,t,n=this;return i(this,(function(r){switch(r.label){case 0:return e=this._getActualKey(N.key),[4,this._asyncStorage.getAllKeys()];case 1:return t=r.sent(),[2,t.filter((function(t){return n._isBelonging(t)&&t!==e})).map((function(e){return e.substring("".concat(n.dbname,"/").length)}))]}}))}))},e.prototype.get=function(e){return r(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return [4,this._asyncStorage.getItem(this._getActualKey(e))];case 1:return [2,(t=n.sent())?this._encryption.decrypt(JSON.parse(t)):null]}}))}))},e.prototype.set=function(e){return r(this,void 0,void 0,(function(){var t,n,r;return i(this,(function(i){switch(i.label){case 0:return t=e.key,n=e.value,r=JSON.stringify(this._encryption.encrypt(n)),t===N.key||r.length<this.itemSizeLimit?[4,this._asyncStorage.setItem(this._getActualKey(t),r)]:[3,2];case 1:return i.sent(),[2,JSON.parse(r)];case 2:throw Vt.storeItemSizeExceeded}}))}))},e.prototype.setMany=function(e){return r(this,void 0,void 0,(function(){var t,n,r,i$1,s$1,o,a,u,c,l;return i(this,(function(h){switch(h.label){case 0:t=[],n=[];try{for(r=s(e),i$1=r.next();!i$1.done;i$1=r.next()){s$1=i$1.value;try{o=s$1.key,a=s$1.value,u=JSON.stringify(this._encryption.encrypt(a)),o===N.key||u.length<this.itemSizeLimit?(n.push([this._getActualKey(o),u]),t.push(a)):t.push(Vt.storeItemSizeExceeded);}catch(e){t.push(Vt.collectionWriteFailed);}}}catch(e){c={error:e};}finally{try{i$1&&!i$1.done&&(l=r.return)&&l.call(r);}finally{if(c)throw c.error}}h.label=1;case 1:return h.trys.push([1,3,,4]),[4,this._asyncStorage.multiSet(n)];case 2:return h.sent(),[3,4];case 3:return h.sent(),[2,new Array(t.length).fill(Vt.collectionWriteFailed)];case 4:return [2,t]}}))}))},e.prototype.remove=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return [4,this._asyncStorage.removeItem(this._getActualKey(e))];case 1:return t.sent(),[2,e]}}))}))},e.prototype.removeMany=function(e){return r(this,void 0,void 0,(function(){var t=this;return i(this,(function(n){switch(n.label){case 0:return [4,this._asyncStorage.multiRemove(e.map((function(e){return t._getActualKey(e)})))];case 1:return n.sent(),[2,e]}}))}))},e.prototype.clear=function(){return r(this,void 0,void 0,(function(){var e;return i(this,(function(t){switch(t.label){case 0:return [4,this.getAllKeys()];case 1:return e=t.sent(),[4,this.removeMany(e)];case 2:return t.sent(),[4,this.remove(N.key)];case 3:return t.sent(),[2]}}))}))},e}(),Mn=!0,Un$1=function(){function e(){}return e.off=function(){Mn=!1;},e.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];Mn&&console.log.apply(console,a(["".concat("[NESTDB]","[LOG]")],o(e),!1));},e.warning=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];Mn&&console.warn.apply(console,a(["".concat("[NESTDB]","[WARNING]")],o(e),!1));},e.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];Mn&&console.error.apply(console,a(["".concat("[NESTDB]","[ERROR]")],o(e),!1));},e}();!function(e){e.INIT="INIT",e.OPENING="OPENING",e.OPENED="OPENED",e.CLOSED="CLOSED";}(Tn$1||(Tn$1={}));var qn=function(){function e(e){var t=e.name,n=e.version,r=e.store,i=e.config;this.name=t,this._version=n,this._state=Tn$1.INIT,this._config=i||new jt({dbname:t}),this._store=r,this._event={success:Xt,error:Xt,upgrade:en$1},this._collections=new Map,this._globalMutex=new Cn$1("".concat(this.name,".lock")),this._config.disableLogger&&Un$1.off(),new mn$1({dbname:t,limit:this._config.cacheLimit});}return Object.defineProperty(e.prototype,"version",{get:function(){return this._version},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),e.prototype.commitSchema=function(e){return r(this,void 0,void 0,(function(){var t=this;return i(this,(function(n){switch(n.label){case 0:return this._state!==Tn$1.OPENING?[3,2]:[4,Promise.all(e.map((function(e){return r(t,void 0,void 0,(function(){var t,n,r,i$1;return i(this,(function(s){switch(s.label){case 0:return t=e.collectionName,n=e.keyName,r=e.index,i$1=void 0===r?[]:r,this._collections.has(t)||this._collections.set(t,new Rn({dbname:this.name,collectionName:t,keyName:n,keyHash:e.keyHash||null,indexes:i$1,store:this._store})),[4,this._collections.get(t).init()];case 1:return s.sent(),[2]}}))}))})))];case 1:return n.sent(),[3,3];case 2:throw Vt.databaseSchemaNotOnUpgrade;case 3:return [2]}}))}))},e.prototype.open=function(){var e;return r(this,void 0,void 0,(function(){var t,n,r$1,i$1,s=this;return i(this,(function(o){switch(o.label){case 0:return [4,this._globalMutex.lock()];case 1:if(o.sent(),this._state===Tn$1.OPENED)return [3,15];this._state=Tn$1.OPENING,o.label=2;case 2:return o.trys.push([2,5,,15]),[4,this._store.init(this.name)];case 3:return o.sent(),a=this.name,t="".concat(un$1(a),".metadata"),n={version:0,collectionNames:[]},[4,this._store.get(t)];case 4:return r$1=null!==(e=o.sent())&&void 0!==e?e:n,[2,new Promise((function(e,n){var i$1=function(e){r$1.version<s._version?s._event.upgrade(r$1.version,(function(n){return r(s,void 0,void 0,(function(){var i$1;return i(this,(function(s){switch(s.label){case 0:if(n)return [3,5];r$1.version++,r$1.collectionNames=Array.from(this._collections.keys()),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,this._store.set({key:t,value:r$1,generation:this._version})];case 2:return s.sent(),e({continued:!0}),[3,4];case 3:return i$1=s.sent(),e({continued:!1,err:i$1}),[3,4];case 4:return [3,6];case 5:e({continued:!1,err:n}),s.label=6;case 6:return [2]}}))}))})):e({continued:!1});},o=function(t){var a=t.continued,c=void 0!==a&&a,l=t.err,d=void 0===l?null:l;if(c)setTimeout((function(){return i$1(o)}),10);else if(d)Un$1.error(d.message),s._globalMutex.unlock(),s._event.error(d),n(d);else {var f=[];r$1.collectionNames.forEach((function(e){s._collections.has(e)||f.push(r(s,void 0,void 0,(function(){var t,n;return i(this,(function(r){switch(r.label){case 0:return [4,Rn.metadataOf(this.name,e,this._store)];case 1:return (t=r.sent())?(n=new Rn({dbname:this.name,collectionName:e,keyName:t.keyName,indexes:t.indexes,store:this._store}),this._collections.set(e,n),[4,n.init()]):[3,3];case 2:r.sent(),r.label=3;case 3:return [2]}}))})));})),Promise.all(f).then((function(){s._state=Tn$1.OPENED,s._globalMutex.unlock(),s._event.success(),e();})).catch((function(e){Un$1.error(e.message),s._globalMutex.unlock(),s._event.error(e),n(e);}));}};i$1(o);}))];case 5:switch(i$1=o.sent(),i$1.code){case wt.STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING:return [3,6];case wt.STORE_NOT_AVAILABLE:return [3,8];case wt.STORE_ENCRYPTION_INVALID:return [3,10]}return [3,13];case 6:return Un$1.warning("Access to the local storage is not allowed in private browsing. Switched to MemoryStore automatically."),this._store=new Pn({}),this._globalMutex.unlock(),this._event.error(i$1),[4,this.open()];case 7:return o.sent(),[3,14];case 8:return Un$1.warning("IndexedDB is not available in this environment. Switched to MemoryStore automatically. Consider using other store to save data persistently (e.g. AsyncStorage)."),this._store=new Pn({}),this._globalMutex.unlock(),this._event.error(i$1),[4,this.open()];case 9:return o.sent(),[3,14];case 10:return Un$1.warning("Encryption algorithm has changed. Stored data would be cleared."),[4,this._store.clear()];case 11:return o.sent(),this._globalMutex.unlock(),this._event.error(i$1),[4,this.open()];case 12:return o.sent(),[3,14];case 13:throw Un$1.error(i$1.message),this._globalMutex.unlock(),this._event.error(i$1),i$1;case 14:return [3,15];case 15:return [2]}var a;}))}))},e.prototype.close=function(){this._collections.forEach((function(e){return e.close()})),this._state=Tn$1.CLOSED;},e.prototype.clear=function(){return r(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return [4,Promise.all(Array.from(this._collections.values()).map((function(e){return e.clear()})))];case 1:return e.sent(),[2]}}))}))},e.prototype.reset=function(){return r(this,void 0,void 0,(function(){var e,t=this;return i(this,(function(n){switch(n.label){case 0:return this.close(),(e=mn$1.get(this.name))&&e.clearByCondition((function(e){return e.key.startsWith(un$1(t.name))})),[4,this._store.clear()];case 1:return n.sent(),[2]}}))}))},e.prototype.on=function(e,t){this._event[e]=t;},e.prototype.off=function(e){if("function"==typeof this._event[e])if("upgrade"===e)this._event[e]=en$1;else this._event[e]=Xt;},e.prototype.collection=function(e){return this._collections.get(e)||null},e}(),Bn=null,Fn=function(){function n$1(e,t,n){var r$1=this;this._fcmPushToken=null,this._apnsPushToken=null,this._iid=e,this.options=t;var i$1=St$1.of(e),s=i$1.sdkState,o=i$1.cacheContext,a=i$1.dispatcher,c=i$1.sessionManager,l=i$1.requestQueue,d=i$1.logger,f=i$1.userEventHandlers;this._onlineDetector=new Me({logger:d,connectionDelegate:{reconnect:function(){var t=St$1.of(e),n=t.sdkState,r=t.connectionManager;"foreground"===n.appState&&r.resetAndReconnect();},disconnect:function(){St$1.of(e).connectionManager.disconnect();}}}),new pe(e,{localCacheEnabled:o.localCacheEnabled,dispatcher:a,sdkState:s,logger:d}),n.forEach((function(t){t.init(e,{sdkState:s,cacheContext:o,dispatcher:a,sessionManager:c,requestQueue:l,logger:d,onlineDetector:r$1._onlineDetector}),r$1[t.name]=t;})),this._appStateChangeDetector=new De,this._appStateChangeDetector.on("resume",(function(){d.debug("the page resumes from freeze"),r$1.setForegroundState();})).on("pause",(function(){d.debug("the page freezes"),r$1.setBackgroundState();})),a.on((function(t){if(t instanceof B){if("USEV"===t.code){var n=t.as(be).event;if(n.category===te.FRIEND_DISCOVERED){var i$1=me.getDataAsFriendDiscoveredEvent(e,n).friendDiscoveries;Ie((function(){return r(r$1,void 0,void 0,(function(){return i(this,(function(e){return [2,f.forEach((function(e){e.onFriendsDiscovered(i$1);}))]}))}))}));}}}else if(t instanceof $){var a=St$1.of(r$1._iid).subscribedUnreadMessageCount,c=!1,l=t.ts;if("number"==typeof l&&l>a.ts){if(a.all!==t.all&&(c=!0),a.all=t.all>=0?t.all:0,t.customTypes)for(var d in t.customTypes)a.customTypes[d]!==t.customTypes[d]&&(c=!0),a.customTypes[d]=t.customTypes[d];c=c&&a.ts>0,a.ts=l;}c&&Ie((function(){return r(r$1,void 0,void 0,(function(){return i(this,(function(e){return [2,f.forEach((function(e){e.onTotalUnreadMessageCountUpdated(a.all,a.customTypes);}))]}))}))}));}else t instanceof lt$1&&o.localCacheEnabled&&o.preference.set(r$1._getUserProfileCacheKey(s.userId),dt$1.payloadify(t.userProfile));}));}return n$1.init=function(e){var t=e.appId,r=e.appVersion,i=void 0===r?null:r,s=e.modules,o$1=void 0===s?[]:s,a$1=e.options,u=void 0===a$1?new b:a$1,c=e.debugMode,l=void 0!==c&&c,h=e.customApiHost,d=e.customWebSocketHost,f=e.newInstance,p=void 0!==f&&f,v=e.logLevel,_=e.localCacheEnabled,m=void 0!==_&&_,y=e.localCacheEncryption,b$1=e.useAsyncStorageStore,g=void 0===b$1?null:b$1;if(!Bn||p){var I="su-".concat(R()),w=null!=y?y:{encrypt:function(e){return e},decrypt:function(e){return e}},E=new Pn({encryption:w});l||(E=g?new Dn({AsyncStorage:g,encryption:w}):new An({encryption:w})),new St$1(I,{appId:t,appVersion:i,options:u,apiHost:null!=h?h:"https://api-".concat(t,".sendbird.com"),websocketHost:null!=d?d:"wss://ws-".concat(t,".sendbird.com"),store:E,encryption:w,logLevel:v,localCacheEnabled:m,debugMode:l});var k=new n$1(I,u,a(a([],o(o$1),!1),[new Dn$1],!1));return Bn||(Bn=k),k}return Bn},Object.defineProperty(n$1,"instance",{get:function(){return Bn},enumerable:!1,configurable:!0}),Object.defineProperty(n$1,"version",{get:function(){return c},enumerable:!1,configurable:!0}),Object.defineProperty(n$1.prototype,"appId",{get:function(){return St$1.of(this._iid).sdkState.appId},enumerable:!1,configurable:!0}),Object.defineProperty(n$1.prototype,"appInfo",{get:function(){return St$1.of(this._iid).appInfo},enumerable:!1,configurable:!0}),Object.defineProperty(n$1.prototype,"appVersion",{get:function(){var e;return null!==(e=St$1.of(this._iid).sdkState.appVersion)&&void 0!==e?e:""},enumerable:!1,configurable:!0}),Object.defineProperty(n$1.prototype,"debugMode",{get:function(){return St$1.of(this._iid).debugMode},enumerable:!1,configurable:!0}),Object.defineProperty(n$1.prototype,"logLevel",{get:function(){return St$1.of(this._iid).logger.level},set:function(e){St$1.of(this._iid).logger.level=e;},enumerable:!1,configurable:!0}),Object.defineProperty(n$1.prototype,"isCacheEnabled",{get:function(){return St$1.of(this._iid).cacheContext.localCacheEnabled},enumerable:!1,configurable:!0}),Object.defineProperty(n$1.prototype,"ekey",{get:function(){return Me$1(this._iid)},enumerable:!1,configurable:!0}),Object.defineProperty(n$1.prototype,"currentUser",{get:function(){var e;return null!==(e=St$1.of(this._iid).sessionManager.currentUser)&&void 0!==e?e:null},enumerable:!1,configurable:!0}),Object.defineProperty(n$1.prototype,"connectionState",{get:function(){var e=St$1.of(this._iid).connectionManager;return e.isConnected?j.OPEN:e.isConnecting?j.CONNECTING:j.CLOSED},enumerable:!1,configurable:!0}),Object.defineProperty(n$1.prototype,"lastConnectedAt",{get:function(){var e=St$1.of(this._iid),t=e.connectedAt;return e.connectionManager.isConnected?t:0},enumerable:!1,configurable:!0}),Object.defineProperty(n$1.prototype,"fcmPushToken",{get:function(){return this._fcmPushToken},enumerable:!1,configurable:!0}),Object.defineProperty(n$1.prototype,"apnsPushToken",{get:function(){return this._apnsPushToken},enumerable:!1,configurable:!0}),n$1.prototype._getPreferenceCacheKey=function(e){return "sendbird@".concat(this.appId,"/").concat(e,".pref")},n$1.prototype._getUserProfileCacheKey=function(e){return "sendbird@".concat(this.appId,"/").concat(e,".profile")},n$1.prototype.getMemoryStoreForDebugging=function(){var e=St$1.of(this._iid),t=e.debugMode,n=e.cacheContext;if(t)return n.store instanceof Pn?n.store:null;throw p.debugModeRequired},n$1.prototype.addExtension=function(e,t){var n=St$1.of(this._iid).sdkState;["sb_uikit","sb_syncmanager"].indexOf(e)>-1&&(n.extensions[e]=t);},n$1.prototype.initializeCache=function(e){return r(this,void 0,void 0,(function(){var t,n,r,i$1,s,o,a,u;return i(this,(function(c){switch(c.label){case 0:return t=St$1.of(this._iid),n=t.sdkState,r=t.cacheContext,i$1=t.connectionManager,s=t.dispatcher,n.userId&&n.userId===e?[3,6]:[4,i$1.logout()];case 1:return c.sent(),n.userId=e,r.localCacheEnabled?(o="sendbird@".concat(n.appId,"/").concat(e,".db"),r.nestdb&&r.nestdb.state!==Tn$1.CLOSED&&r.nestdb.name===o?[3,3]:((a=r.nestdb=new qn({name:"sendbird@".concat(n.appId,"/").concat(e,".db"),version:1,store:r.store})).on("upgrade",function(e){return function(t,n){0===t?e.commitSchema([{collectionName:W,keyName:V,index:[$$1(K.LATEST_LAST_MESSAGE),$$1(K.CHRONOLOGICAL),$$1(K.CHANNEL_NAME_ALPHABETICAL)]},{collectionName:J,keyName:X,index:[se(Z.CHANNEL_LATEST),se(Z.NEWEST_CHILD_MESSAGE)]},{collectionName:ce,keyName:oe,index:[se(Z.CHANNEL_LATEST),se(Z.NEWEST_CHILD_MESSAGE)]},{collectionName:"Poll",keyName:"pollId"}]).then((function(){return n()})).catch((function(e){return n(e)})):n();}}(a)),[4,a.open()])):[3,6];case 2:c.sent(),s.dispatch(new ve(this._iid,{userId:e})),c.label=3;case 3:return [4,r.preference.init(this._getPreferenceCacheKey(e))];case 4:return c.sent(),[4,r.preference.get(this._getUserProfileCacheKey(e))];case 5:(u=c.sent())&&new dt$1(this._iid,u).apply(),c.label=6;case 6:return [2]}}))}))},n$1.prototype.clearCachedData=function(){return r(this,void 0,void 0,(function(){var e;return i(this,(function(t){switch(t.label){case 0:return (e=St$1.of(this._iid).cacheContext).localCacheEnabled?(e.nestdb&&e.nestdb.clear(),[4,e.preference.clear()]):[3,2];case 1:t.sent(),t.label=2;case 2:return [2]}}))}))},n$1.prototype.clearCachedMessages=function(e){return r(this,void 0,void 0,(function(){var t,n,r$1=this;return i(this,(function(i$1){switch(i$1.label){case 0:return at$1(E("string",e)).throw(p.invalidParameters),t=he.of(this._iid),n=ue.of(this._iid),t&&n?[4,Promise.all(e.map((function(e){return r(r$1,void 0,void 0,(function(){return i(this,(function(r){switch(r.label){case 0:return [4,t.removeMessagesOfChannel(e)];case 1:return r.sent(),[4,n.removeMessagesOfChannel(e)];case 2:return r.sent(),[2]}}))}))})))]:[3,2];case 1:i$1.sent(),i$1.label=2;case 2:return [2]}}))}))},n$1.prototype.connect=function(e,t){return void 0===t&&(t=null),r(this,void 0,void 0,(function(){var n,r,i$1,s,o,a,u;return i(this,(function(c){switch(c.label){case 0:n=St$1.of(this._iid),r=n.sdkState,i$1=n.cacheContext,s=n.connectionManager,o=n.statLogCollector,c.label=1;case 1:return c.trys.push([1,3,,4]),[4,this.initializeCache(e)];case 2:return c.sent(),[3,4];case 3:return c.sent(),a=St$1.of(this._iid).logger,i$1.localCacheEnabled=!1,a.warn("Cache initialization failed - cache is not available."),[3,4];case 4:return [4,o.init("sendbird@".concat(r.appId,"/").concat(e,".statlog"))];case 5:return c.sent(),[4,s.connect(t)];case 6:return c.sent(),this._appStateChangeDetector.start(),r.appState="foreground",[4,null==(u=pe.of(this._iid))?void 0:u.processNonAutoResendRegisteredPendingMessages()];case 7:return c.sent(),this._onlineDetector.start(),[2,this.currentUser]}}))}))},n$1.prototype.reconnect=function(){var e=St$1.of(this._iid),t=e.connectionManager,n=e.sdkState,r=e.sessionManager.auth.hasSession;return r&&t.resetAndReconnect().then((function(){n.appState="foreground";})).catch((function(){})),r},n$1.prototype.disconnect=function(){return r(this,void 0,void 0,(function(){var e,t,n,r;return i(this,(function(i){switch(i.label){case 0:return e=St$1.of(this._iid),t=e.connectionManager,n=e.cacheContext,r=e.requestQueue,this._appStateChangeDetector.stop(),this._onlineDetector.stop(),r.cancelAll(),[4,t.logout()];case 1:return i.sent(),n.localCacheEnabled?[4,this.clearCachedData()]:[3,3];case 2:i.sent(),i.label=3;case 3:return [2]}}))}))},n$1.prototype.setBackgroundState=function(){var e=St$1.of(this._iid),t=e.connectionManager,n=e.sdkState,r=e.logger;"foreground"===n.appState&&(n.appState="background",r.debug("going background state"),t.background());},n$1.prototype.setForegroundState=function(){var e=St$1.of(this._iid),t=e.connectionManager,n=e.sdkState,r=e.logger;"background"===n.appState&&(n.appState="foreground",r.debug("going foreground state"),t.resetAndReconnect());},n$1.prototype.setSessionHandler=function(e){at$1(e instanceof Le).throw(p.invalidParameters),St$1.of(this._iid).sessionManager.handler=e;},n$1.prototype.addUserEventHandler=function(e,n){at$1(y("string",e)&&n instanceof Ae).throw(p.invalidParameters),St$1.of(this._iid).userEventHandlers.set(e,n);},n$1.prototype.removeUserEventHandler=function(e){St$1.of(this._iid).userEventHandlers.delete(e);},n$1.prototype.removeAllUserEventHandler=function(){St$1.of(this._iid).userEventHandlers.clear();},n$1.prototype.addConnectionHandler=function(e,n){at$1(y("string",e)&&n instanceof Pe).throw(p.invalidParameters),St$1.of(this._iid).connectionHandlers.set(e,n);},n$1.prototype.removeConnectionHandler=function(e){St$1.of(this._iid).connectionHandlers.delete(e);},n$1.prototype.removeAllConnectionHandler=function(){St$1.of(this._iid).connectionHandlers.clear();},n$1.prototype.createApplicationUserListQuery=function(e){return void 0===e&&(e={}),new At(this._iid,e)},n$1.prototype.createBlockedUserListQuery=function(e){return void 0===e&&(e={}),new Ut(this._iid,e)},n$1.prototype.createFriendListQuery=function(e){return void 0===e&&(e={}),new Ft(this._iid,e)},n$1.prototype.createMessageSearchQuery=function(e){return new Cn$2(this._iid,e)},n$1.prototype.buildUserFromSerializedData=function(e){var t=ot$1(e);return new ct$1(this._iid,ct$1.payloadify(t))},n$1.prototype.updateCurrentUserInfo=function(n$1){return void 0===n$1&&(n$1={}),r(this,void 0,void 0,(function(){var r,i$1,s,o,a,u;return i(this,(function(c){switch(c.label){case 0:return n$1=n(n({},Re),n$1),at$1(function(n){return S(n.profileImage,!0)&&y("string",n.profileUrl,!0)&&y("string",n.nickname,!0)}(n$1)).throw(p.invalidParameters),this.currentUser?(r=St$1.of(this._iid),i$1=r.sdkState,s=r.requestQueue,o=new Ue(n({userId:i$1.userId},n$1)),[4,s.send(o)]):[3,2];case 1:return a=c.sent(),u=a.as(qe).user,this.currentUser&&(n$1.nickname&&(this.currentUser.nickname=u.nickname),(n$1.profileUrl||n$1.profileImage)&&(this.currentUser.plainProfileUrl=u.profileUrl)),[2,u];case 2:throw p.connectionRequired}}))}))},n$1.prototype.updateCurrentUserInfoWithPreferredLanguages=function(e){return r(this,void 0,void 0,(function(){var t,n,r,i$1,s,o;return i(this,(function(a){switch(a.label){case 0:return at$1(E("string",e)).throw(p.invalidParameters),this.currentUser?(t=St$1.of(this._iid),n=t.sdkState,r=t.requestQueue,i$1=new Ue({userId:n.userId,preferredLanguages:e}),[4,r.send(i$1)]):[3,2];case 1:return s=a.sent(),o=s.as(qe).user,this.currentUser&&(this.currentUser.preferredLanguages=o.preferredLanguages),[2,o];case 2:throw p.connectionRequired}}))}))},n$1.prototype.registerFCMPushTokenForCurrentUser=function(e){return r(this,void 0,void 0,(function(){var n,r,i$1,s;return i(this,(function(o){switch(o.label){case 0:if(at$1(y("string",e)).throw(p.invalidParameters),!this.currentUser)return [3,5];o.label=1;case 1:return o.trys.push([1,3,,4]),n=St$1.of(this._iid),r=n.sdkState,i$1=n.requestQueue,s=new Fe({userId:r.userId,token:e}),[4,i$1.send(s)];case 2:return o.sent(),this._fcmPushToken="",[2,B$1.SUCCESS];case 3:return o.sent(),[2,B$1.ERROR];case 4:return [3,6];case 5:return this._fcmPushToken=e,[2,B$1.PENDING];case 6:return [2]}}))}))},n$1.prototype.unregisterFCMPushTokenForCurrentUser=function(e){return r(this,void 0,void 0,(function(){var n,r,i$1,s;return i(this,(function(o){switch(o.label){case 0:if(at$1(y("string",e)).throw(p.invalidParameters),!this.currentUser)return [3,5];o.label=1;case 1:return o.trys.push([1,3,,4]),n=St$1.of(this._iid),r=n.sdkState,i$1=n.requestQueue,s=new je({userId:r.userId,token:e}),[4,i$1.send(s)];case 2:return o.sent(),this._fcmPushToken="",[2,B$1.SUCCESS];case 3:return o.sent(),[2,B$1.ERROR];case 4:return [3,6];case 5:return this._fcmPushToken=e,[2,B$1.PENDING];case 6:return [2]}}))}))},n$1.prototype.unregisterFCMPushTokenAllForCurrentUser=function(){return r(this,void 0,void 0,(function(){var e,t,n,r;return i(this,(function(i){switch(i.label){case 0:return this.currentUser?(e=St$1.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new Ve({userId:t.userId}),[4,n.send(r)]):[3,2];case 1:i.sent(),i.label=2;case 2:return [2]}}))}))},n$1.prototype.registerAPNSPushTokenForCurrentUser=function(e){return r(this,void 0,void 0,(function(){var n,r,i$1,s;return i(this,(function(o){switch(o.label){case 0:if(at$1(y("string",e)).throw(p.invalidParameters),!this.currentUser)return [3,5];o.label=1;case 1:return o.trys.push([1,3,,4]),n=St$1.of(this._iid),r=n.sdkState,i$1=n.requestQueue,s=new Be({userId:r.userId,token:e}),[4,i$1.send(s)];case 2:return o.sent(),this._fcmPushToken="",[2,B$1.SUCCESS];case 3:return o.sent(),[2,B$1.ERROR];case 4:return [3,6];case 5:return this._fcmPushToken=e,[2,B$1.PENDING];case 6:return [2]}}))}))},n$1.prototype.unregisterAPNSPushTokenForCurrentUser=function(e){return r(this,void 0,void 0,(function(){var n,r,i$1,s;return i(this,(function(o){switch(o.label){case 0:if(at$1(y("string",e)).throw(p.invalidParameters),!this.currentUser)return [3,5];o.label=1;case 1:return o.trys.push([1,3,,4]),n=St$1.of(this._iid),r=n.sdkState,i$1=n.requestQueue,s=new Ke({userId:r.userId,token:e}),[4,i$1.send(s)];case 2:return o.sent(),this._fcmPushToken="",[2,B$1.SUCCESS];case 3:return o.sent(),[2,B$1.ERROR];case 4:return [3,6];case 5:return this._fcmPushToken=e,[2,B$1.PENDING];case 6:return [2]}}))}))},n$1.prototype.unregisterAPNSPushTokenAllForCurrentUser=function(){return r(this,void 0,void 0,(function(){var e,t,n,r;return i(this,(function(i){switch(i.label){case 0:return this.currentUser?(e=St$1.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new He({userId:t.userId}),[4,n.send(r)]):[3,2];case 1:i.sent(),i.label=2;case 2:return [2]}}))}))},n$1.prototype.getChannelInvitationPreference=function(){return r(this,void 0,void 0,(function(){var e,t,n,r,i$1;return i(this,(function(s){switch(s.label){case 0:return e=St$1.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new Qe({userId:t.userId}),[4,n.send(r)];case 1:return i$1=s.sent(),[2,{autoAccept:i$1.as(Ge).autoAccept}]}}))}))},n$1.prototype.setChannelInvitationPreference=function(e){return r(this,void 0,void 0,(function(){var n,r,i$1,s,o;return i(this,(function(a){switch(a.label){case 0:return at$1(y("boolean",e)).throw(p.invalidParameters),n=St$1.of(this._iid),r=n.sdkState,i$1=n.requestQueue,s=new Ye({userId:r.userId,willAutoAccept:e}),[4,i$1.send(s)];case 1:return o=a.sent(),[2,{autoAccept:o.as(Je).autoAccept}]}}))}))},n$1.prototype.getDoNotDisturb=function(){return r(this,void 0,void 0,(function(){var e,t,n,r,i$1;return i(this,(function(s){switch(s.label){case 0:return e=St$1.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new Xe({userId:t.userId}),[4,n.send(r)];case 1:return i$1=s.sent(),[2,i$1.as(Ze).preference]}}))}))},n$1.prototype.setDoNotDisturb=function(e,n,r$1,i$1,s,o){return void 0===n&&(n=0),void 0===r$1&&(r$1=0),void 0===i$1&&(i$1=0),void 0===s&&(s=0),void 0===o&&(o=""),r(this,void 0,void 0,(function(){var a,u,c,l,d;return i(this,(function(h){switch(h.label){case 0:return at$1(y("boolean",e)&&y("number",n)&&y("number",r$1)&&y("number",i$1)&&y("number",s)&&y("string",o)).throw(p.invalidParameters),a=St$1.of(this._iid),u=a.sdkState,c=a.requestQueue,l=new $e({userId:u.userId,doNotDisturbOn:e,startHour:n,startMin:r$1,endHour:i$1,endMin:s,timezone:o}),[4,c.send(l)];case 1:return d=h.sent(),[2,d.as(et).preference]}}))}))},n$1.prototype.getSnoozePeriod=function(){return r(this,void 0,void 0,(function(){var e,t,n,r,i$1;return i(this,(function(s){switch(s.label){case 0:return e=St$1.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new tt({userId:t.userId}),[4,n.send(r)];case 1:return i$1=s.sent(),[2,i$1.as(nt).snoozePeriod]}}))}))},n$1.prototype.setSnoozePeriod=function(e,n,r$1){return void 0===n&&(n=0),void 0===r$1&&(r$1=0),r(this,void 0,void 0,(function(){var i$1,s,o,a,u;return i(this,(function(c){switch(c.label){case 0:return at$1(y("boolean",e)&&y("number",n)&&y("number",r$1)).throw(p.invalidParameters),i$1=St$1.of(this._iid),s=i$1.sdkState,o=i$1.requestQueue,a=new rt({userId:s.userId,snoozeOn:e,startTs:n,endTs:r$1}),[4,o.send(a)];case 1:return u=c.sent(),[2,u.as(it).snoozePeriod]}}))}))},n$1.prototype.getMyPushTokensByToken=function(e,n){return r(this,void 0,void 0,(function(){var r,i$1,s,o,a;return i(this,(function(u){switch(u.label){case 0:return at$1(y("string",e)&&m(z,n)).throw(p.invalidParameters),r=St$1.of(this._iid),i$1=r.sdkState,s=r.requestQueue,o=new We({userId:i$1.userId,type:n,token:e}),[4,s.send(o)];case 1:return a=u.sent(),[2,a.as(ze).pushTokens]}}))}))},n$1.prototype.getPushTriggerOption=function(){return r(this,void 0,void 0,(function(){var e,t,n,r;return i(this,(function(i){switch(i.label){case 0:return e=St$1.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new _e({userId:t.userId}),[4,n.send(r)];case 1:return [2,i.sent().as(Ee).pushTriggerOption]}}))}))},n$1.prototype.setPushTriggerOption=function(e){return r(this,void 0,void 0,(function(){var t,n,r,i$1;return i(this,(function(s){switch(s.label){case 0:return at$1(m(H,e)).throw(p.invalidParameters),t=St$1.of(this._iid),n=t.sdkState,r=t.requestQueue,i$1=new Ae$1({userId:n.userId,pushTriggerOption:e}),[4,r.send(i$1)];case 1:return [2,s.sent().as(ye).pushTriggerOption]}}))}))},n$1.prototype.getPushTemplate=function(){return r(this,void 0,void 0,(function(){var e,t,n,r;return i(this,(function(i){switch(i.label){case 0:return e=St$1.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new at({userId:t.userId}),[4,n.send(r)];case 1:return [2,i.sent().as(ut).name]}}))}))},n$1.prototype.setPushTemplate=function(e){return r(this,void 0,void 0,(function(){var t,n,r,i$1;return i(this,(function(s){switch(s.label){case 0:return at$1(m(q$1,e)).throw(p.invalidParameters),t=St$1.of(this._iid),n=t.sdkState,r=t.requestQueue,i$1=new ct({userId:n.userId,templateName:e}),[4,r.send(i$1)];case 1:return [2,s.sent().as(lt).name]}}))}))},n$1.prototype.blockUser=function(e){return r(this,void 0,void 0,(function(){var n,r,i$1,s;return i(this,(function(o){switch(o.label){case 0:return at$1(e instanceof ct$1||y("string",e)).throw(p.invalidParameters),n=St$1.of(this._iid),r=n.sdkState,i$1=n.requestQueue,s=new st({userId:r.userId,blockedUserId:e instanceof ct$1?e.userId:e}),[4,i$1.send(s)];case 1:return o.sent(),[2]}}))}))},n$1.prototype.blockUserWithUserId=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){return [2,this.blockUser(e)]}))}))},n$1.prototype.unblockUser=function(e){return r(this,void 0,void 0,(function(){var n,r,i$1,s;return i(this,(function(o){switch(o.label){case 0:return at$1(e instanceof ct$1||y("string",e)).throw(p.invalidParameters),n=St$1.of(this._iid),r=n.sdkState,i$1=n.requestQueue,s=new ot({userId:r.userId,unblockedUserId:e instanceof ct$1?e.userId:e}),[4,i$1.send(s)];case 1:return o.sent(),[2]}}))}))},n$1.prototype.unblockUserWithUserId=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){return [2,this.unblockUser(e)]}))}))},n$1.prototype.getFriendChangeLogsByToken=function(e){return r(this,void 0,void 0,(function(){var n,r,i$1,s,o;return i(this,(function(a){switch(a.label){case 0:return at$1(y("string",e)).throw(p.invalidParameters),n=St$1.of(this._iid),r=n.sdkState,i$1=n.requestQueue,s=new ht({userId:r.userId,token:e}),[4,i$1.send(s)];case 1:return o=a.sent(),[2,o.as(dt).changelogs]}}))}))},n$1.prototype.getAllowFriendDiscovery=function(){return r(this,void 0,void 0,(function(){var e,t,n,r,i$1;return i(this,(function(s){switch(s.label){case 0:return e=St$1.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new bt({userId:t.userId}),[4,n.send(r)];case 1:return i$1=s.sent(),[2,i$1.as(gt).allowFriendDiscovery]}}))}))},n$1.prototype.setAllowFriendDiscovery=function(e){return r(this,void 0,void 0,(function(){var n,r,i$1,s;return i(this,(function(o){switch(o.label){case 0:return at$1(y("boolean",e)).throw(p.invalidParameters),n=St$1.of(this._iid),r=n.sdkState,i$1=n.requestQueue,s=new It({userId:r.userId,allowFriendDiscovery:e}),[4,i$1.send(s)];case 1:return o.sent(),[2,e]}}))}))},n$1.prototype.uploadFriendDiscoveries=function(e){return r(this,void 0,void 0,(function(){var t,n,r,i$1,s;return i(this,(function(o){switch(o.label){case 0:return t=St$1.of(this._iid),n=t.sdkState,r=t.requestQueue,i$1=new ft({userId:n.userId,discoveries:e}),[4,r.send(i$1)];case 1:return s=o.sent(),[2,s.as(pt).friendDiscoveryRequestId]}}))}))},n$1.prototype.deleteFriendDiscovery=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){return [2,this.deleteFriendDiscoveries([e])]}))}))},n$1.prototype.deleteFriendDiscoveries=function(e){return r(this,void 0,void 0,(function(){var t,n,r,i$1;return i(this,(function(s){switch(s.label){case 0:return at$1(E("string",e)).throw(p.invalidParameters),t=St$1.of(this._iid),n=t.sdkState,r=t.requestQueue,i$1=new vt({userId:n.userId,discoveryKeys:e}),[4,r.send(i$1)];case 1:return s.sent(),[2]}}))}))},n$1.prototype.addFriends=function(e){return r(this,void 0,void 0,(function(){var t,n,r,i$1,s;return i(this,(function(o){switch(o.label){case 0:return at$1(E("string",e)).throw(p.invalidParameters),t=St$1.of(this._iid),n=t.sdkState,r=t.requestQueue,i$1=new _t({userId:n.userId,userIds:e}),[4,r.send(i$1)];case 1:return s=o.sent(),[2,s.as(mt).users]}}))}))},n$1.prototype.deleteFriend=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){return [2,this.deleteFriends([e])]}))}))},n$1.prototype.deleteFriends=function(e){return r(this,void 0,void 0,(function(){var t,n,r,i$1;return i(this,(function(s){switch(s.label){case 0:return at$1(E("string",e)).throw(p.invalidParameters),t=St$1.of(this._iid),n=t.sdkState,r=t.requestQueue,i$1=new yt({userId:n.userId,userIds:e}),[4,r.send(i$1)];case 1:return s.sent(),[2]}}))}))},n$1.prototype.getAllEmoji=function(){return r(this,void 0,void 0,(function(){var e,t,n;return i(this,(function(r){switch(r.label){case 0:return e=St$1.of(this._iid).requestQueue,t=new Ot,[4,e.send(t)];case 1:return n=r.sent(),[2,n.as(St).emojiContainer]}}))}))},n$1.prototype.getEmojiCategory=function(e){return r(this,void 0,void 0,(function(){var t,n,r;return i(this,(function(i){switch(i.label){case 0:return t=St$1.of(this._iid).requestQueue,n=new Tt({categoryId:e}),[4,t.send(n)];case 1:return r=i.sent(),[2,r.as(xt).emojiCategory]}}))}))},n$1.prototype.getEmoji=function(e){return r(this,void 0,void 0,(function(){var t,n,r;return i(this,(function(i){switch(i.label){case 0:return t=St$1.of(this._iid).requestQueue,n=new Ct({key:e}),[4,t.send(n)];case 1:return r=i.sent(),[2,r.as(Rt).emoji]}}))}))},n$1}();

var en=function(r$1){function a(){var n=null!==r$1&&r$1.apply(this,arguments)||this;return n._channels=new Map,n._enteredChannelUrls=[],n}return t(a,r$1),Object.defineProperty(a.prototype,"enteredChannels",{get:function(){var n=this;return this._enteredChannelUrls.map((function(e){return n._channels.get(e)})).filter((function(n){return null!==n}))},enumerable:!1,configurable:!0}),a.prototype.isEnteredChannel=function(n){return this._enteredChannelUrls.includes(n)},a.prototype.enter=function(n){this._enteredChannelUrls.indexOf(n)<0&&this._enteredChannelUrls.push(n);},a.prototype.exit=function(n){var e=this._enteredChannelUrls.indexOf(n);e>=0&&this._enteredChannelUrls.splice(e,1);},a.prototype.exitAll=function(){this._enteredChannelUrls=[];},a.prototype.get=function(n){var r$1;return r(this,void 0,void 0,(function(){return i(this,(function(e){return [2,null!==(r$1=this._channels.get(n))&&void 0!==r$1?r$1:null]}))}))},a.prototype.upsert=function(n){return r(this,void 0,void 0,(function(){var e=this;return i(this,(function(t){return n.forEach((function(n){if(e._channels.has(n.url)){var t=e._channels.get(n.url);Object.assign(t,n);}else e._channels.set(n.url,n);})),[2]}))}))},a.prototype.remove=function(n){return r(this,void 0,void 0,(function(){return i(this,(function(e){return this._channels.delete(n),this.exit(n),[2]}))}))},a.prototype.clear=function(){return r(this,void 0,void 0,(function(){return i(this,(function(n){return this._channels.clear(),this._enteredChannelUrls=[],[2]}))}))},a}(Le$1),tn={channelUrl:null,name:null,coverUrlOrImage:null,data:null,customType:null,operatorUserIds:null},rn=function(e){function t$1(n){var t=n.channelUrl,r=n.isInternalCall,a=e.call(this)||this;return a.method=d.GET,a.path="".concat(r?Ge$1:xe,"/").concat(encodeURIComponent(t)),a}return t(t$1,e),t$1}(q),an=function(e){function t$1(n,t){var r=e.call(this,n,t)||this;return r.channel=null,r.channel=new gn(n,t),r}return t(t$1,e),t$1}(F),sn=function(e){function t$1(n){var t=this,r=n.channelUrl,a=n.coverUrlOrImage,u=n.name,l=n.data,h=n.customType,p=n.operatorUserIds;return (t=e.call(this)||this).method=d.POST,t.path=xe,t.params=U({channel_url:r,cover_url:y("string",a)?a:null,cover_file:S(a)?a:null,name:u,data:l,custom_type:h,operators:p}),t}return t(t$1,e),t$1}(q);!function(e){function t$1(n,t){var r=e.call(this,n,t)||this;return r.channel=new gn(n,t),r}t(t$1,e);}(F);var on=function(e){function t$1(n){var t=n.channelUrl;return e.call(this,{code:"ENTR",payload:{channel_url:t},ackRequired:!0})||this}return t(t$1,e),t$1}(H$1),un=function(e){function t$1(n,t,r){var a,i,s=this;return s=e.call(this,n,"ENTR",r)||this,r.data&&(s.participantCount=null!==(a=r.data.participant_count)&&void 0!==a?a:0,s.user=new ct$1(n,r.data),s.ts=null!==(i=r.data.edge_ts)&&void 0!==i?i:0),s}return t(t$1,e),t$1}(B),cn=function(e){function t$1(n){var t=n.channelUrl;return e.call(this,{code:"EXIT",payload:{channel_url:t},ackRequired:!0})||this}return t(t$1,e),t$1}(H$1),ln=function(e){function t$1(n,t,r){var a,i,s=this;return s=e.call(this,n,"EXIT",r)||this,r.data&&(s.participantCount=null!==(a=r.data.participant_count)&&void 0!==a?a:0,s.user=new ct$1(n,r.data),s.ts=null!==(i=r.data.edge_ts)&&void 0!==i?i:0),s}return t(t$1,e),t$1}(B),hn={},dn=function(){function n$1(n,e){var t=e.sdkState,r=e.dispatcher,a=e.requestQueue,i=this;this._sdkState=t,this._requestQueue=a,this._dispatcher=r,this._openChannelCache=new en(n),this._openChannelHandlers=new Map,this._dispatcher.on((function(n){var e,t;if(n instanceof B)i._handleEvent(n);else if(n instanceof de&&n.stateType===J$1.CONNECTED){var r=i._openChannelCache.enteredChannels;try{for(var a=s(r),s$1=a.next();!s$1.done;s$1=a.next()){s$1.value.enter();}}catch(n){e={error:n};}finally{try{s$1&&!s$1.done&&(t=a.return)&&t.call(a);}finally{if(e)throw e.error}}}})),hn[n]=this;}return n$1.of=function(n){return hn[n]},n$1.prototype.buildOpenChannelFromSerializedData=function(n){var e=ot$1(n);return new gn(e._iid,gn.payloadify(e))},n$1.prototype.getChannelFromCache=function(n){return r(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return [4,this._openChannelCache.get(n)];case 1:return [2,e.sent()]}}))}))},n$1.prototype.upsertChannelsToCache=function(n){return r(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return [4,this._openChannelCache.upsert(n)];case 1:return e.sent(),[2]}}))}))},n$1.prototype.removeChannelsFromCache=function(n){return r(this,void 0,void 0,(function(){var e,r,a,i$1,s$1,o;return i(this,(function(t){switch(t.label){case 0:t.trys.push([0,5,6,7]),e=s(n),r=e.next(),t.label=1;case 1:return r.done?[3,4]:(a=r.value,[4,this._openChannelCache.remove(a)]);case 2:t.sent(),t.label=3;case 3:return r=e.next(),[3,1];case 4:return [3,7];case 5:return i$1=t.sent(),s$1={error:i$1},[3,7];case 6:try{r&&!r.done&&(o=e.return)&&o.call(e);}finally{if(s$1)throw s$1.error}return [7];case 7:return [2]}}))}))},n$1.prototype.setEnteredToCache=function(n){this._openChannelCache.enter(n.url);},n$1.prototype.setExitedToCache=function(n){this._openChannelCache.exit(n.url);},n$1.prototype._handleEvent=function(n){return r(this,void 0,void 0,(function(){var r$1,a,i$1,s$1,o,u,c,l,h$2,d,p,f,C$1,v,_$1,m,T$1,N,H,I,M,b,O,D,x,A,B,nn,en,tn,rn,an,sn,on,cn,hn,dn,pn,fn,Cn,vn,_n,yn,mn,gn,Un,En,wn,Tn,Nn,Hn,In,Mn,bn,On,Dn,xn,An,Pn,Ln=this;return i(this,(function(Rn){switch(Rn.label){case 0:switch(Rn.trys.push([0,51,,52]),n.code){case"MESG":case"FILE":case"ADMM":case"BRDM":return [3,1];case"MEDI":case"FEDI":case"AEDI":return [3,4];case"DELM":return [3,7];case"MRCT":return [3,10];case"MTHD":return [3,13];case"MCNT":return [3,16];case"SYEV":return [3,27]}return [3,50];case 1:return s$1=null,"MESG"===n.code?s$1=n.as(gt$1):"FILE"===n.code?s$1=n.as(Jt$1):"ADMM"!==n.code&&"BRDM"!=n.code||(s$1=n.as(A$1)),s$1?(r$1=s$1.message,a=s$1.isMentioned,r$1.channelType!==ne.OPEN?[3,3]:[4,this.getChannel(r$1.channelUrl,!0)]):[3,3];case 2:i$1=Rn.sent(),Ie((function(){return r(Ln,void 0,void 0,(function(){var n,e,s$1,o,u;return i(this,(function(t){try{for(n=s(this._openChannelHandlers.values()),e=n.next();!e.done;e=n.next())s$1=e.value,this._openChannelCache.isEnteredChannel(i$1.url)&&s$1.onMessageReceived(i$1,r$1),a&&s$1.onMentionReceived(i$1,r$1);}catch(n){o={error:n};}finally{try{e&&!e.done&&(u=n.return)&&u.call(n);}finally{if(o)throw o.error}}return [2]}))}))})),Rn.label=3;case 3:return [3,50];case 4:return s$1=null,"MEDI"===n.code?s$1=n.as(Tt$2):"FEDI"===n.code?s$1=n.as(It$1):"AEDI"===n.code&&(s$1=n.as(c$1)),s$1?(o=s$1.message).channelType!==ne.OPEN?[3,6]:[4,this.getChannel(o.channelUrl,!0)]:[3,6];case 5:u=Rn.sent(),Ie((function(){return r(Ln,void 0,void 0,(function(){var n,e,r,a,i$1;return i(this,(function(t){try{for(n=s(this._openChannelHandlers.values()),e=n.next();!e.done;e=n.next())r=e.value,this._openChannelCache.isEnteredChannel(u.url)&&r.onMessageUpdated(u,o);}catch(n){a={error:n};}finally{try{e&&!e.done&&(i$1=n.return)&&i$1.call(n);}finally{if(a)throw a.error}}return [2]}))}))})),Rn.label=6;case 6:return [3,50];case 7:return c=n.as(Mt$1),M=c.channelUrl,p=c.channelType,l=c.messageId,p!==ne.OPEN?[3,9]:[4,this.getChannel(M,!0)];case 8:h$2=Rn.sent(),Ie((function(){return r(Ln,void 0,void 0,(function(){var n,e,r,a,i$1;return i(this,(function(t){try{for(n=s(this._openChannelHandlers.values()),e=n.next();!e.done;e=n.next())r=e.value,this._openChannelCache.isEnteredChannel(h$2.url)&&r.onMessageDeleted(h$2,l);}catch(n){a={error:n};}finally{try{e&&!e.done&&(i$1=n.return)&&i$1.call(n);}finally{if(a)throw a.error}}return [2]}))}))})),Rn.label=9;case 9:return [3,50];case 10:return d=n.as(H$2),M=d.channelUrl,p=d.channelType,f=d.event,p!==ne.OPEN?[3,12]:[4,this.getChannel(M,!0)];case 11:C$1=Rn.sent(),Ie((function(){return r(Ln,void 0,void 0,(function(){var n,e,r,a;return i(this,(function(t){try{for(n=s(this._openChannelHandlers.values()),e=n.next();!e.done;e=n.next())e.value.onReactionUpdated(C$1,f);}catch(n){r={error:n};}finally{try{e&&!e.done&&(a=n.return)&&a.call(n);}finally{if(r)throw r.error}}return [2]}))}))})),Rn.label=12;case 12:return [3,50];case 13:return (v=n.as(T).event).channelType!==ne.OPEN?[3,15]:[4,this.getChannel(v.channelUrl,!0)];case 14:_$1=Rn.sent(),Ie((function(){return r(Ln,void 0,void 0,(function(){var n,e,r,a;return i(this,(function(t){try{for(n=s(this._openChannelHandlers.values()),e=n.next();!e.done;e=n.next())e.value.onThreadInfoUpdated(_$1,v);}catch(n){r={error:n};}finally{try{e&&!e.done&&(a=n.return)&&a.call(n);}finally{if(r)throw r.error}}return [2]}))}))})),Rn.label=15;case 15:return [3,50];case 16:m=n.as(h$1).openChannelMemberCounts,T$1=[],Rn.label=17;case 17:Rn.trys.push([17,22,23,24]),N=s(m),H=N.next(),Rn.label=18;case 18:return H.done?[3,21]:(I=H.value,M=I.channelUrl,an=I.participantCount,b=I.updatedAt,[4,this.getChannelFromCache(M)]);case 19:(O=Rn.sent())&&O._updateParticipantCount(an,b)&&T$1.push(O),Rn.label=20;case 20:return H=N.next(),[3,18];case 21:return [3,24];case 22:return D=Rn.sent(),An={error:D},[3,24];case 23:try{H&&!H.done&&(Pn=N.return)&&Pn.call(N);}finally{if(An)throw An.error}return [7];case 24:return T$1.length>0?[4,this.upsertChannelsToCache(T$1)]:[3,26];case 25:Rn.sent(),Ie((function(){return r(Ln,void 0,void 0,(function(){var n,e,r,a;return i(this,(function(t){try{for(n=s(this._openChannelHandlers.values()),e=n.next();!e.done;e=n.next())e.value.onChannelMemberCountChanged(T$1);}catch(n){r={error:n};}finally{try{e&&!e.done&&(a=n.return)&&a.call(n);}finally{if(r)throw r.error}}return [2]}))}))})),Rn.label=26;case 26:return [3,50];case 27:if(!(x=n.as(C).event).isOpenChannelEvent)return [3,49];switch(x.category){case _.CHANNEL_ENTER:return [3,28];case _.CHANNEL_EXIT:return [3,30];case _.CHANNEL_OPERATOR_UPDATE:return [3,32];case _.USER_CHANNEL_MUTE:case _.USER_CHANNEL_UNMUTE:return [3,34];case _.USER_CHANNEL_BAN:case _.USER_CHANNEL_UNBAN:return [3,36];case _.CHANNEL_FREEZE:case _.CHANNEL_UNFREEZE:return [3,38];case _.CHANNEL_DELETED:return [3,40];case _.CHANNEL_PROP_CHANGED:return [3,43];case _.CHANNEL_META_DATA_CHANGED:return [3,45];case _.CHANNEL_META_COUNTERS_CHANGED:return [3,47]}return [3,49];case 28:return [4,this.getChannel(x.channelUrl,!0)];case 29:return A=Rn.sent(),B=n.as(un),an=B.participantCount,nn=B.user,en=A._updateParticipantCount(an,x.ts),Ie((function(){return r(Ln,void 0,void 0,(function(){return i(this,(function(n){return this._openChannelHandlers.forEach((function(n){n.onUserEntered(A,nn),en&&n.onChannelParticipantCountChanged(A);})),[2]}))}))})),[3,49];case 30:return [4,this.getChannel(x.channelUrl,!0)];case 31:return tn=Rn.sent(),rn=n.as(ln),an=rn.participantCount,sn=rn.user,on=tn._updateParticipantCount(an,x.ts),Ie((function(){return r(Ln,void 0,void 0,(function(){return i(this,(function(n){return this._openChannelHandlers.forEach((function(n){n.onUserExited(tn,sn),on&&n.onChannelParticipantCountChanged(tn);})),[2]}))}))})),[3,49];case 32:return [4,this.getChannel(x.channelUrl,!0)];case 33:return cn=Rn.sent(),hn=n.as(d$1).operators,cn.operators=hn,this.upsertChannelsToCache([cn]),Ie((function(){return r(Ln,void 0,void 0,(function(){return i(this,(function(n){return this._openChannelHandlers.forEach((function(n){n.onOperatorUpdated(cn,hn);})),[2]}))}))})),[3,49];case 34:return [4,this.getChannel(x.channelUrl,!0)];case 35:return dn=Rn.sent(),pn=x.category===_.USER_CHANNEL_MUTE,fn=n.as(pn?at$2:ot$2).user,Ie((function(){return r(Ln,void 0,void 0,(function(){return i(this,(function(n){return this._openChannelHandlers.forEach((function(n){pn?n.onUserMuted(dn,fn):n.onUserUnmuted(dn,fn);})),[2]}))}))})),[3,49];case 36:return [4,this.getChannel(x.channelUrl,!0)];case 37:return Cn=Rn.sent(),vn=x.category===_.USER_CHANNEL_BAN,_n=n.as(vn?ct$2:dt$2).user,Ie((function(){return r(Ln,void 0,void 0,(function(){return i(this,(function(n){return this._openChannelHandlers.forEach((function(n){vn?n.onUserBanned(Cn,_n):n.onUserUnbanned(Cn,_n);})),[2]}))}))})),[3,49];case 38:return [4,this.getChannel(x.channelUrl,!0)];case 39:return yn=Rn.sent(),mn=n.as(pt$1).freeze,yn.isFrozen=mn,this.upsertChannelsToCache([yn]),Ie((function(){return r(Ln,void 0,void 0,(function(){return i(this,(function(n){return this._openChannelHandlers.forEach((function(n){mn?n.onChannelFrozen(yn):n.onChannelUnfrozen(yn);})),[2]}))}))})),[3,49];case 40:return [4,this.getChannel(x.channelUrl,!0)];case 41:return gn=Rn.sent(),[4,this.removeChannelsFromCache([gn.url])];case 42:return Rn.sent(),Ie((function(){return r(Ln,void 0,void 0,(function(){return i(this,(function(n){return this._openChannelHandlers.forEach((function(n){n.onChannelDeleted(gn.url,gn.channelType);})),[2]}))}))})),[3,49];case 43:return [4,this.getChannelWithoutCache(x.channelUrl,!0)];case 44:return Un=Rn.sent(),Ie((function(){return r(Ln,void 0,void 0,(function(){return i(this,(function(n){return this._openChannelHandlers.forEach((function(n){n.onChannelChanged(Un);})),[2]}))}))})),[3,49];case 45:return [4,this.getChannel(x.channelUrl,!0)];case 46:return En=Rn.sent(),wn=n.as(je$1),Tn=wn.created,Nn=wn.updated,Hn=wn.deleted,Tn&&En._upsertCachedMetaData(Tn,x.ts),Nn&&En._upsertCachedMetaData(Nn,x.ts),Hn&&En._removeFromCachedMetaData(Hn,x.ts),Ie((function(){return r(Ln,void 0,void 0,(function(){return i(this,(function(n){return this._openChannelHandlers.forEach((function(n){Tn&&n.onMetaDataCreated(En,Tn),Nn&&n.onMetaDataUpdated(En,Nn),Hn&&n.onMetaDataDeleted(En,Hn);})),[2]}))}))})),[3,49];case 47:return [4,this.getChannel(x.channelUrl,!0)];case 48:return In=Rn.sent(),Mn=n.as(tt$1),bn=Mn.created,On=Mn.updated,Dn=Mn.deleted,Ie((function(){return r(Ln,void 0,void 0,(function(){return i(this,(function(n){return this._openChannelHandlers.forEach((function(n){bn&&n.onMetaCounterCreated(In,bn),On&&n.onMetaCounterUpdated(In,On),Dn&&n.onMetaCounterDeleted(In,Dn);})),[2]}))}))})),[3,49];case 49:return [3,50];case 50:return [3,52];case 51:if(xn=Rn.sent(),h(xn))throw xn;return [3,52];case 52:return [2]}}))}))},n$1.prototype.addHandler=function(n,e){this._openChannelHandlers.set(n,e);},n$1.prototype.removeHandler=function(n){this._openChannelHandlers.delete(n);},n$1.prototype.clearHandler=function(){this._openChannelHandlers.clear();},n$1.prototype.getChannel=function(n,r$1){return r(this,void 0,void 0,(function(){var e;return i(this,(function(t){switch(t.label){case 0:at$1(y("string",n)).throw(p.invalidParameters),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.getChannelFromCache(n)];case 2:return (e=t.sent())?[2,e]:[3,4];case 3:return t.sent(),[3,4];case 4:return [4,this.getChannelWithoutCache(n)];case 5:return [2,t.sent()]}}))}))},n$1.prototype.getChannelWithoutCache=function(n,r$1){return void 0===r$1&&(r$1=!1),r(this,void 0,void 0,(function(){var e,a,s;return i(this,(function(t){switch(t.label){case 0:return at$1(y("string",n)).throw(p.invalidParameters),e=new rn({channelUrl:n,isInternalCall:r$1}),[4,this._requestQueue.send(e)];case 1:return a=t.sent(),s=a.as(an).channel,[4,this.upsertChannelsToCache([s])];case 2:return t.sent(),[2,s]}}))}))},n$1.prototype.createChannel=function(n$1){return r(this,void 0,void 0,(function(){var e,r,o;return i(this,(function(t){switch(t.label){case 0:return n$1=n(n({},tn),n$1),at$1(function(n){return E("string",n.operatorUserIds,!0)&&(y("string",n.coverUrlOrImage)||S(n.coverUrlOrImage)||null===n.coverUrlOrImage)&&y("string",n.name,!0)&&y("string",n.data,!0)&&y("string",n.customType,!0)&&(y("string",n.channelUrl)&&/^\w+$/.test(n.channelUrl)||null===n.channelUrl)}(n$1)).throw(p.invalidParameters),e=new sn(n$1),[4,this._requestQueue.send(e)];case 1:return r=t.sent(),o=r.as(an).channel,this.upsertChannelsToCache([o]),[2,o]}}))}))},n$1}(),pn={name:null,coverUrlOrImage:null,data:null,customType:null,operatorUserIds:null},fn=function(e){function t$1(n){var t=this,r=n.channelUrl,a=n.token,i=n.limit;return (t=e.call(this)||this).method=d.GET,t.path="".concat(xe,"/").concat(encodeURIComponent(r),"/participants"),t.params={token:a,limit:i},t}return t(t$1,e),t$1}(q),Cn=function(e){function t$1(n,t){var r=e.call(this,n,t)||this;r.token=null,r.participants=[];var a=t.next,i=t.participants;return r.token=a,r.participants=i.map((function(e){return new ct$1(n,e)})),r}return t(t$1,e),t$1}(F),vn=function(r$1){function a(n,e,t){return r$1.call(this,n,e,ne.OPEN,t)||this}return t(a,r$1),a.prototype._validate=function(){return r$1.prototype._validate.call(this)},a.prototype.next=function(){return r(this,void 0,void 0,(function(){var n$1,e,r,a,i$1,s;return i(this,(function(t){switch(t.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,n$1=St$1.of(this._iid).requestQueue,e=new fn(n(n({},this),{token:this._token})),[4,n$1.send(e)]):[3,2]:[3,5];case 1:return r=t.sent(),a=r.as(Cn),i$1=a.participants,s=a.token,this._token=s,this._hasNext=!!s,this._isLoading=!1,[2,i$1];case 2:return [2,[]];case 3:throw p.queryInProgress;case 4:return [3,6];case 5:throw p.invalidParameters;case 6:return [2]}}))}))},a}(On$1),_n=function(e){function t$1(n){var t=this,r=n.channelUrl,a=n.coverUrlOrImage,u=n.name,l=n.data,h=n.customType,p=n.operatorUserIds;return (t=e.call(this)||this).method=d.PUT,t.path="".concat(xe,"/").concat(encodeURIComponent(r)),t.params=U({cover_url:y("string",a)?a:null,cover_file:S(a)?a:null,name:u,data:l,custom_type:h,operators:p}),t}return t(t$1,e),t$1}(q),yn=function(e){function t$1(n,t){var r=e.call(this,n,t)||this;return r.channel=new gn(n,t),r}return t(t$1,e),t$1}(F),mn=function(e){function t$1(n){var t=this,r=n.channelUrl;return (t=e.call(this)||this).method=d.DELETE,t.path="".concat(xe,"/").concat(encodeURIComponent(r)),t}return t(t$1,e),t$1}(q);!function(e){function t$1(n,t){return e.call(this,n,t)||this}t(t$1,e);}(F);var gn=function(r$1){function o(n,e){var t,a=this;return (a=r$1.call(this,n,e)||this)._lastParticipantCountUpdated=0,a.participantCount=0,a.operators=[],a.channelType=ne.OPEN,a.participantCount=null!==(t=e.participant_count)&&void 0!==t?t:0,a.operators=Array.isArray(e.operators)?e.operators.map((function(e){return new ct$1(n,e)})):[],a}return t(o,r$1),o.payloadify=function(n$1){return n$1?U(n(n({},kt$1.payloadify(n$1)),{participant_count:n$1.participantCount,operators:n$1.operators.map((function(n){return ct$1.payloadify(n)}))})):null},o.prototype.serialize=function(){return st$1(this)},o.prototype.isOperator=function(n){return n instanceof ct$1?this.isOperator(n.userId):this.operators.some((function(e){return e.userId===n}))},o.prototype._updateParticipantCount=function(n,e){return e>this._lastParticipantCountUpdated&&(this.participantCount=n,this._lastParticipantCountUpdated=e,!0)},o.prototype.createParticipantListQuery=function(n){return new vn(this._iid,this.url,n)},o.prototype.refresh=function(){return r(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return [4,dn.of(this._iid).getChannelWithoutCache(this.url)];case 1:return [2,n.sent()]}}))}))},o.prototype.enter=function(){return r(this,void 0,void 0,(function(){var n,e,r,a,i$1,s;return i(this,(function(t){switch(t.label){case 0:return n=St$1.of(this._iid).requestQueue,e=new on({channelUrl:this.url}),[4,n.send(e)];case 1:return r=t.sent(),a=r.as(un),i$1=a.participantCount,s=a.ts,this._updateParticipantCount(i$1,s),dn.of(this._iid).setEnteredToCache(this),[2]}}))}))},o.prototype.exit=function(){return r(this,void 0,void 0,(function(){var n,e,r,a,i$1,s;return i(this,(function(t){switch(t.label){case 0:return n=St$1.of(this._iid).requestQueue,e=new cn({channelUrl:this.url}),[4,n.send(e)];case 1:return r=t.sent(),a=r.as(ln),i$1=a.participantCount,s=a.ts,this._updateParticipantCount(i$1,s),dn.of(this._iid).setExitedToCache(this),En$2.of(this._iid).fileMessageQueue.cancel(this),[2]}}))}))},o.prototype.updateChannel=function(n$1){return r(this,void 0,void 0,(function(){var e,r,o,u;return i(this,(function(t){switch(t.label){case 0:return n$1=n(n({},pn),n$1),at$1(function(n){return E("string",n.operatorUserIds,!0)&&(y("string",n.coverUrlOrImage)||S(n.coverUrlOrImage)||null===n.coverUrlOrImage)&&y("string",n.name,!0)&&y("string",n.data,!0)&&y("string",n.customType,!0)}(n$1)).throw(p.invalidParameters),e=St$1.of(this._iid).requestQueue,r=new _n(n({channelUrl:this.url},n$1)),[4,e.send(r)];case 1:return o=t.sent(),u=o.as(yn).channel,[4,dn.of(this._iid).upsertChannelsToCache([u])];case 2:return t.sent(),[2,u]}}))}))},o.prototype.updateChannelWithOperatorUserIds=function(n$1,r$1,a,i$1,s){return r(this,void 0,void 0,(function(){var e;return i(this,(function(t){return e=n(n({},pn),{name:n$1,coverUrlOrImage:r$1,data:a,operatorUserIds:i$1,customType:s}),[2,this.updateChannel(e)]}))}))},o.prototype.delete=function(){return r(this,void 0,void 0,(function(){var n,e;return i(this,(function(t){switch(t.label){case 0:return n=St$1.of(this._iid).requestQueue,e=new mn({channelUrl:this.url}),[4,n.send(e)];case 1:return t.sent(),[4,dn.of(this._iid).removeChannelsFromCache([this.url])];case 2:return t.sent(),[2]}}))}))},o}(kt$1),Un=function(e){function t$1(n){void 0===n&&(n={});var t=e.call(this)||this;return Object.keys(n).forEach((function(e){t.hasOwnProperty(e)&&(t[e]=n[e]);})),t}return t(t$1,e),t$1}(function(e){function t$1(){var n=null!==e&&e.apply(this,arguments)||this;return n.onUserEntered=Y,n.onUserExited=Y,n.onChannelParticipantCountChanged=Y,n}return t(t$1,e),t$1}(U$1)),En=function(e){function t$1(n){var t=this,r=n.token,a=n.limit,i=n.nameKeyword,s=n.urlKeyword,u=n.customTypes,l=n.includeFrozen,h=n.includeMetaData;return (t=e.call(this)||this).method=d.GET,t.path=xe,t.params=U({token:r,limit:a,name_contains:i,url_contains:s,custom_types:u,show_frozen:l,show_metadata:h}),t}return t(t$1,e),t$1}(q),wn=function(e){function t$1(n,t){var r=e.call(this,n,t)||this;r.token=null,r.channels=[],r.ts=null;var a=t.next,i=t.channels,s=t.ts;return r.token=a,i&&i.length>0&&(r.channels=i.map((function(e){return new gn(n,e)}))),r.ts="number"==typeof s?s:null,r}return t(t$1,e),t$1}(F),Tn=function(r$1){function s(n,e){var t,a,i,s,o,u=this;return (u=r$1.call(this,n,e)||this).includeFrozen=!0,u.includeMetaData=!0,u.nameKeyword=null,u.urlKeyword=null,u.customTypes=null,u.includeFrozen=null===(t=e.includeFrozen)||void 0===t||t,u.includeMetaData=null===(a=e.includeMetaData)||void 0===a||a,u.nameKeyword=null!==(i=e.nameKeyword)&&void 0!==i?i:null,u.urlKeyword=null!==(s=e.urlKeyword)&&void 0!==s?s:null,u.customTypes=null!==(o=e.customTypes)&&void 0!==o?o:null,u}return t(s,r$1),s.prototype._validate=function(){return r$1.prototype._validate.call(this)&&y("boolean",this.includeFrozen)&&y("boolean",this.includeMetaData)&&y("string",this.nameKeyword,!0)&&y("string",this.urlKeyword,!0)&&E("string",this.customTypes,!0)},s.prototype.next=function(){return r(this,void 0,void 0,(function(){var n$1,e,r,a,i$1,s;return i(this,(function(t){switch(t.label){case 0:return this._validate()?this._isLoading?[3,4]:this._hasNext?(this._isLoading=!0,n$1=St$1.of(this._iid).requestQueue,e=new En(n(n({},this),{token:this._token})),[4,n$1.send(e)]):[3,3]:[3,6];case 1:return r=t.sent(),a=r.as(wn),i$1=a.channels,s=a.token,this._token=s,this._hasNext=!!s,[4,dn.of(this._iid).upsertChannelsToCache(i$1)];case 2:return t.sent(),this._isLoading=!1,[2,i$1];case 3:return [2,[]];case 4:throw p.queryInProgress;case 5:return [3,7];case 6:throw p.invalidParameters;case 7:return [2]}}))}))},s}(bn$1),Nn=function(r$1){function a(){var n=null!==r$1&&r$1.apply(this,arguments)||this;return n.name="openChannel",n}return t(a,r$1),a.prototype.init=function(n,e){var t=e.sdkState,a=e.dispatcher,i=e.sessionManager,s=e.requestQueue,o=e.logger,u=e.onlineDetector,c=e.cacheContext;r$1.prototype.init.call(this,n,{sdkState:t,dispatcher:a,sessionManager:i,requestQueue:s,logger:o,onlineDetector:u,cacheContext:c}),this._manager=new dn(n,{sdkState:t,dispatcher:a,requestQueue:s});},a.prototype.createOpenChannelListQuery=function(n){return void 0===n&&(n={}),new Tn(this._iid,n)},a.prototype.addOpenChannelHandler=function(n,e){this._manager.addHandler(n,e);},a.prototype.removeOpenChannelHandler=function(n){this._manager.removeHandler(n);},a.prototype.removeAllOpenChannelHandlers=function(){this._manager.clearHandler();},a.prototype.buildOpenChannelFromSerializedData=function(n){return this._manager.buildOpenChannelFromSerializedData(n)},a.prototype.getChannel=function(n){return r(this,void 0,void 0,(function(){return i(this,(function(e){return [2,this._manager.getChannel(n)]}))}))},a.prototype.getChannelWithoutCache=function(n){return r(this,void 0,void 0,(function(){return i(this,(function(e){return [2,this._manager.getChannelWithoutCache(n)]}))}))},a.prototype.createChannel=function(n){return void 0===n&&(n={}),r(this,void 0,void 0,(function(){return i(this,(function(e){return [2,this._manager.createChannel(n)]}))}))},a.prototype.createChannelWithOperatorUserIds=function(n$1,r$1,a,i$1,s){return r(this,void 0,void 0,(function(){var e;return i(this,(function(t){return (e=n({},tn)).name=n$1,e.coverUrlOrImage=r$1,e.data=a,e.operatorUserIds=i$1,e.customType=s,[2,this._manager.createChannel(e)]}))}))},a}(Tt$1);

export { Fn as F, Nn as N, Pe as P, Un as U };
//# sourceMappingURL=openChannel-a64f8d8e.js.map
