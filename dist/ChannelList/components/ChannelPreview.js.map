{"version":3,"file":"ChannelPreview.js","sources":["../../../src/smart-components/ChannelList/components/ChannelPreview/utils.js","../../../src/smart-components/ChannelList/components/ChannelPreview/index.tsx"],"sourcesContent":["import isToday from 'date-fns/isToday';\nimport format from 'date-fns/format';\nimport formatRelative from 'date-fns/formatRelative';\nimport isYesterday from 'date-fns/isYesterday';\n\nimport { truncateString } from '../../../../utils';\nimport { LabelStringSet } from '../../../../ui/Label';\n\nexport const getChannelTitle = (channel = {}, currentUserId, stringSet = LabelStringSet) => {\n  if (!channel?.name && !channel?.members) {\n    return stringSet.NO_TITLE;\n  }\n  if (channel?.name && channel.name !== 'Group Channel') {\n    return channel.name;\n  }\n  if (channel?.members?.length === 1) {\n    return stringSet.NO_MEMBERS;\n  }\n  return (channel?.members || [])\n    .filter(({ userId }) => userId !== currentUserId)\n    .map(({ nickname }) => (nickname || stringSet.NO_NAME))\n    .join(', ');\n};\n\nexport const getLastMessageCreatedAt = (channel, locale) => {\n  const createdAt = channel?.lastMessage?.createdAt;\n  const optionalParam = locale ? { locale } : null;\n  if (!createdAt) {\n    return '';\n  }\n  if (isToday(createdAt)) {\n    return format(createdAt, 'p', optionalParam);\n  }\n  if (isYesterday(createdAt)) {\n    return formatRelative(createdAt, new Date(), optionalParam);\n  }\n  return format(createdAt, 'MMM dd', optionalParam);\n};\n\nexport const getTotalMembers = (channel) => (\n  channel?.memberCount\n    ? channel.memberCount\n    : 0\n);\n\nconst getPrettyLastMessage = (message = {}) => {\n  const MAXLEN = 30;\n  const { messageType, name } = message;\n  if (messageType === 'file') {\n    return truncateString(name, MAXLEN);\n  }\n  return message.message;\n};\n\nexport const getLastMessage = (channel) => (\n  channel?.lastMessage\n    ? getPrettyLastMessage(channel.lastMessage)\n    : ''\n);\n\nexport const getChannelUnreadMessageCount = (channel) => (\n  channel?.unreadMessageCount\n    ? channel.unreadMessageCount\n    : 0\n);\n","import './channel-preview.scss';\n\nimport React from 'react';\nimport type { GroupChannel } from '@sendbird/chat/groupChannel';\nimport type { FileMessage, UserMessage } from '@sendbird/chat/message';\n\nimport ChannelAvatar from '../../../../ui/ChannelAvatar';\nimport Badge from '../../../../ui/Badge';\nimport Icon, { IconColors, IconTypes } from '../../../../ui/Icon';\nimport Label, { LabelTypography, LabelColors } from '../../../../ui/Label';\n\nimport * as utils from './utils';\n\nimport useSendbirdStateContext from '../../../../hooks/useSendbirdStateContext';\nimport { useLocalization } from '../../../../lib/LocalizationContext';\nimport MentionUserLabel from '../../../../ui/MentionUserLabel';\nimport { useChannelListContext } from '../../context/ChannelListProvider';\nimport { TypingIndicatorText } from '../../../Channel/components/TypingIndicator';\nimport MessageStatus from '../../../../ui/MessageStatus';\nimport { isEditedMessage } from '../../../../utils';\n\ninterface ChannelPreviewInterface {\n  channel: GroupChannel;\n  isActive?: boolean;\n  isTyping?: boolean;\n  onClick: () => void;\n  renderChannelAction: (props: { channel: GroupChannel }) => React.ReactNode;\n  tabIndex: number;\n}\n\nconst ChannelPreview: React.FC<ChannelPreviewInterface> = ({\n  channel,\n  isActive = false,\n  isTyping = false,\n  renderChannelAction,\n  onClick,\n  tabIndex,\n}: ChannelPreviewInterface) => {\n  const sbState = useSendbirdStateContext();\n  const {\n    isTypingIndicatorEnabled = false,\n    isMessageReceiptStatusEnabled = false,\n  } = useChannelListContext();\n  const { dateLocale, stringSet } = useLocalization();\n  const userId = sbState?.stores?.userStore?.user?.userId;\n  const theme = sbState?.config?.theme;\n  const isMentionEnabled = sbState?.config?.isMentionEnabled;\n  const isFrozen = channel?.isFrozen || false;\n  const isBroadcast = channel?.isBroadcast || false;\n  const isChannelTyping = isTypingIndicatorEnabled && isTyping;\n  const isMessageStatusEnabled = isMessageReceiptStatusEnabled\n    && (channel?.lastMessage?.messageType === 'user' || channel?.lastMessage?.messageType === 'file')\n    && (channel?.lastMessage as UserMessage | FileMessage)?.sender?.userId === userId;\n  return (\n    <div\n      className={[\n        'sendbird-channel-preview',\n        isActive ? 'sendbird-channel-preview--active' : '',\n      ].join(' ')}\n      role=\"link\"\n      onClick={onClick}\n      onKeyPress={onClick}\n      tabIndex={tabIndex}\n    >\n      <div\n        className=\"sendbird-channel-preview__avatar\"\n      >\n        <ChannelAvatar\n          channel={channel}\n          userId={userId}\n          theme={theme}\n        />\n      </div>\n      <div className=\"sendbird-channel-preview__content\">\n        <div className=\"sendbird-channel-preview__content__upper\">\n          <div className=\"sendbird-channel-preview__content__upper__header\">\n            {\n              isBroadcast\n              && (\n                <div className=\"sendbird-channel-preview__content__upper__header__broadcast-icon\">\n                  <Icon\n                    type={IconTypes.BROADCAST}\n                    fillColor={IconColors.SECONDARY}\n                    height=\"16px\"\n                    width=\"16px\"\n                  />\n                </div>\n              )\n            }\n            <Label\n              className=\"sendbird-channel-preview__content__upper__header__channel-name\"\n              type={LabelTypography.SUBTITLE_2}\n              color={LabelColors.ONBACKGROUND_1}\n            >\n              {utils.getChannelTitle(channel, userId, stringSet)}\n            </Label>\n            <Label\n              className=\"sendbird-channel-preview__content__upper__header__total-members\"\n              type={LabelTypography.CAPTION_2}\n              color={LabelColors.ONBACKGROUND_2}\n            >\n              {utils.getTotalMembers(channel)}\n            </Label>\n            {\n              isFrozen\n              && (\n                <div title=\"Frozen\" className=\"sendbird-channel-preview__content__upper__header__frozen-icon\">\n                  <Icon\n                    type={IconTypes.FREEZE}\n                    fillColor={IconColors.PRIMARY}\n                    height={12}\n                    width={12}\n                  />\n                </div>\n              )\n            }\n          </div>\n          {\n            isMessageStatusEnabled\n              ? (\n                <MessageStatus\n                  className=\"sendbird-channel-preview__content__upper__last-message-at\"\n                  channel={channel}\n                  message={channel?.lastMessage as UserMessage | FileMessage}\n                />\n              )\n              : (\n                <Label\n                  className=\"sendbird-channel-preview__content__upper__last-message-at\"\n                  type={LabelTypography.CAPTION_3}\n                  color={LabelColors.ONBACKGROUND_2}\n                >\n                  {utils.getLastMessageCreatedAt(channel, dateLocale)}\n                </Label>\n              )\n          }\n        </div>\n        <div className=\"sendbird-channel-preview__content__lower\">\n          <Label\n            className=\"sendbird-channel-preview__content__lower__last-message\"\n            type={LabelTypography.BODY_2}\n            color={LabelColors.ONBACKGROUND_3}\n          >\n            {\n              isChannelTyping && (\n                <TypingIndicatorText members={channel?.getTypingUsers()} />\n              )\n            }\n            {\n              !isChannelTyping && (\n                utils.getLastMessage(channel) + (isEditedMessage(channel?.lastMessage as UserMessage | FileMessage) ? ` ${stringSet.MESSAGE_EDITED}` : '')\n              )\n            }\n          </Label>\n          <div className=\"sendbird-channel-preview__content__lower__unread-message-count\">\n            {\n              (isMentionEnabled && channel?.unreadMentionCount > 0)\n                ? (\n                  <MentionUserLabel\n                    className=\"sendbird-channel-preview__content__lower__unread-message-count__mention\"\n                    color=\"purple\"\n                  >\n                    {'@'}\n                  </MentionUserLabel>\n                )\n                : null\n            }\n            {\n              utils.getChannelUnreadMessageCount(channel) // return number\n                ? <Badge count={utils.getChannelUnreadMessageCount(channel)} />\n                : null\n            }\n          </div>\n        </div>\n      </div>\n      <div\n        className=\"sendbird-channel-preview__action\"\n      >\n        {renderChannelAction({ channel })}\n      </div>\n    </div>\n  );\n}\n\nexport default ChannelPreview;\n"],"names":["getChannelTitle","channel","currentUserId","stringSet","LabelStringSet","name","members","NO_TITLE","length","NO_MEMBERS","filter","userId","map","nickname","NO_NAME","join","getLastMessageCreatedAt","locale","createdAt","lastMessage","optionalParam","isToday","format","isYesterday","formatRelative","Date","getTotalMembers","memberCount","getPrettyLastMessage","message","MAXLEN","messageType","truncateString","getLastMessage","getChannelUnreadMessageCount","unreadMessageCount","ChannelPreview","_a","_l","isActive","_m","isTyping","renderChannelAction","onClick","tabIndex","sbState","useSendbirdStateContext","_o","useChannelListContext","_p","isTypingIndicatorEnabled","_q","isMessageReceiptStatusEnabled","_r","useLocalization","dateLocale","stores","userStore","user","theme","config","isMentionEnabled","isFrozen","isBroadcast","isChannelTyping","isMessageStatusEnabled","sender","React","IconTypes","BROADCAST","IconColors","SECONDARY","LabelTypography","SUBTITLE_2","LabelColors","ONBACKGROUND_1","utils","CAPTION_2","ONBACKGROUND_2","FREEZE","PRIMARY","CAPTION_3","BODY_2","ONBACKGROUND_3","getTypingUsers","isEditedMessage","MESSAGE_EDITED","unreadMentionCount"],"mappings":"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"}