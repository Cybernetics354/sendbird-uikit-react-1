{"version":3,"file":"ChannelListUI.js","sources":["../../../src/smart-components/ChannelList/components/ChannelListUI/index.tsx"],"sourcesContent":["import './channel-list-ui.scss';\n\nimport React, { useState } from 'react';\nimport type { GroupChannel, Member, SendbirdGroupChat } from '@sendbird/chat/groupChannel';\nimport type { User } from '@sendbird/chat';\n\nimport ChannelListHeader from '../ChannelListHeader';\nimport AddChannel from '../AddChannel';\nimport ChannelPreview from '../ChannelPreview';\nimport ChannelPreviewAction from '../ChannelPreviewAction';\nimport { useChannelListContext } from '../../context/ChannelListProvider';\nimport * as channelListActions from '../../dux/actionTypes';\n\nimport useSendbirdStateContext from '../../../../hooks/useSendbirdStateContext';\nimport EditUserProfile from '../../../EditUserProfile';\nimport PlaceHolder, { PlaceHolderTypes } from '../../../../ui/PlaceHolder';\n\nconst DELIVERY_RECIPT = 'delivery_receipt';\n\ninterface RenderChannelPreviewProps {\n  channel: GroupChannel;\n  onLeaveChannel(\n    channel: GroupChannel,\n    onLeaveChannelCb?: (c: GroupChannel) => void,\n  );\n}\n\ninterface RenderUserProfileProps {\n  user: Member | User;\n  currentUserId: string;\n  close(): void;\n}\n\nexport interface ChannelListUIProps {\n  renderChannelPreview?: (props: RenderChannelPreviewProps) => React.ReactNode;\n  renderUserProfile?: (props: RenderUserProfileProps) => React.ReactNode;\n  renderHeader?: (props: void) => React.ReactNode;\n  renderPlaceHolderError?: (props: void) => React.ReactNode;\n  renderPlaceHolderLoading?: (props: void) => React.ReactNode;\n  renderPlaceHolderEmptyList?: (props: void) => React.ReactNode;\n}\n\nconst ChannelListUI: React.FC<ChannelListUIProps> = (props: ChannelListUIProps) => {\n  const {\n    renderHeader,\n    renderChannelPreview,\n    renderPlaceHolderError,\n    renderPlaceHolderLoading,\n    renderPlaceHolderEmptyList,\n  } = props;\n\n  const [showProfileEdit, setShowProfileEdit] = useState(false);\n\n  const {\n    onThemeChange,\n    allowProfileEdit,\n    allChannels,\n    loading,\n    currentChannel,\n    channelListDispatcher,\n    channelSource,\n    typingChannels,\n  } = useChannelListContext();\n\n  const state = useSendbirdStateContext();\n\n  const sdkStore = state?.stores?.sdkStore;\n  const config = state?.config;\n\n  const isOnline = state?.config?.isOnline;\n  const logger = config?.logger;\n\n  const sdk = sdkStore?.sdk as SendbirdGroupChat;\n  const sdkError = sdkStore?.error;\n  const sdkIntialized = sdkStore?.initialized || false;\n\n  return (\n    <>\n      <div className=\"sendbird-channel-list__header\">\n        <ChannelListHeader\n          renderHeader={renderHeader}\n          onEdit={() => {\n            if (allowProfileEdit) {\n              setShowProfileEdit(true);\n            }\n          }}\n          allowProfileEdit={allowProfileEdit}\n          renderIconButton={() => (\n            <AddChannel />\n          )}\n        />\n      </div>\n      {\n        showProfileEdit && (\n          <EditUserProfile\n            onThemeChange={onThemeChange}\n            onCancel={() => { setShowProfileEdit(false); }}\n            onEditProfile={() => {\n              setShowProfileEdit(false);\n            }}\n          />\n        )\n      }\n      <div\n        className=\"sendbird-channel-list__body\"\n        onScroll={(e) => {\n          const target = e?.target as HTMLDivElement;\n          const fetchMore = target.clientHeight + target.scrollTop === target.scrollHeight;\n          if (fetchMore && channelSource?.hasNext) {\n            logger.info('ChannelList: Fetching more channels');\n            channelListDispatcher({\n              type: channelListActions.FETCH_CHANNELS_START,\n              payload: null,\n            });\n            channelSource.next().then((channelList) => {\n              logger.info('ChannelList: Fetching channels successful', channelList);\n              channelListDispatcher({\n                type: channelListActions.FETCH_CHANNELS_SUCCESS,\n                payload: channelList,\n              });\n              const canSetMarkAsDelivered = sdk?.appInfo?.premiumFeatureList\n                ?.find((feature) => (feature === DELIVERY_RECIPT));\n\n              if (canSetMarkAsDelivered) {\n                logger.info('ChannelList: Marking all channels as read');\n                // eslint-disable-next-line no-unused-expressions\n                channelList?.forEach((c, idx) => {\n                  // Plan-based rate limits - minimum limit is 5 requests per second\n                  setTimeout(() => {\n                    c?.markAsDelivered();\n                  }, 300 * idx);\n                });\n              }\n            }).catch((err) => {\n              logger.info('ChannelList: Fetching channels failed', err);\n              channelListDispatcher({\n                type: channelListActions.FETCH_CHANNELS_FAILURE,\n                payload: err,\n              });\n            });\n          }\n        }}\n      >\n        {\n          (sdkError) && (\n            (renderPlaceHolderError && typeof renderPlaceHolderError === 'function') ? (\n              renderPlaceHolderError?.()\n            ): (\n              <PlaceHolder type={PlaceHolderTypes.WRONG} />\n            )\n          )\n        }\n        {/*\n          To do: Implement windowing\n          Implement windowing if you are dealing with large number of messages/channels\n          https://github.com/bvaughn/react-window -> recommendation\n          We hesitate to bring one more dependency to our library,\n          we are planning to implement it inside the library\n        */}\n        <div>\n          {\n            allChannels && allChannels.map((channel, idx) => {\n              const onLeaveChannel = (c, cb) => {\n                logger.info('ChannelList: Leaving channel', c);\n                c.leave()\n                  .then((res) => {\n                    logger.info('ChannelList: Leaving channel success', res);\n                    if (cb && typeof cb === 'function') {\n                      cb(res, null);\n                    }\n                    channelListDispatcher({\n                      type: channelListActions.LEAVE_CHANNEL_SUCCESS,\n                      payload: channel?.url,\n                    });\n                  })\n                  .catch((err) => {\n                    logger.error('ChannelList: Leaving channel failed', err);\n                    if (cb && typeof cb === 'function') {\n                      cb(null, err);\n                    }\n                  });\n              };\n\n              const onClick = () => {\n                if (!isOnline) { return; }\n                logger.info('ChannelList: Clicked on channel:', channel);\n                channelListDispatcher({\n                  type: channelListActions.SET_CURRENT_CHANNEL,\n                  payload: channel,\n                });\n              };\n\n              return (\n                (renderChannelPreview)\n                  ? (\n                    // eslint-disable-next-line\n                    <div key={channel?.url} onClick={onClick}>\n                      {renderChannelPreview({ channel, onLeaveChannel })}\n                    </div>\n                  )\n                  : (\n                    <ChannelPreview\n                      key={channel?.url}\n                      tabIndex={idx}\n                      onClick={onClick}\n                      channel={channel}\n                      isActive={channel?.url === currentChannel?.url}\n                      isTyping={typingChannels?.some(({ url }) => url === channel?.url)}\n                      renderChannelAction={(() => (\n                        <ChannelPreviewAction\n                          disabled={!isOnline}\n                          onLeaveChannel={() => onLeaveChannel(channel, null)}\n                        />\n                      ))}\n                    />\n                  )\n              );\n            })\n          }\n        </div>\n        {\n          (!sdkIntialized || loading) && (\n            (renderPlaceHolderLoading && typeof renderPlaceHolderLoading === 'function') ? (\n              renderPlaceHolderLoading?.()\n            ): (\n              <PlaceHolder type={PlaceHolderTypes.LOADING} />\n            )\n          )\n        }\n        {\n          (!allChannels || allChannels.length === 0) && (\n            (renderPlaceHolderEmptyList && typeof renderPlaceHolderEmptyList === 'function') ? (\n              renderPlaceHolderEmptyList?.()\n            ): (\n              <PlaceHolder type={PlaceHolderTypes.NO_CHANNELS} />\n            )\n          )\n        }\n      </div>\n    </>\n  );\n}\n\nexport default ChannelListUI;\n"],"names":["DELIVERY_RECIPT","ChannelListUI","props","renderHeader","renderChannelPreview","renderPlaceHolderError","renderPlaceHolderLoading","renderPlaceHolderEmptyList","_c","useState","showProfileEdit","setShowProfileEdit","_d","useChannelListContext","onThemeChange","allowProfileEdit","allChannels","loading","currentChannel","channelListDispatcher","channelSource","typingChannels","state","useSendbirdStateContext","sdkStore","stores","config","isOnline","logger","sdk","sdkError","error","sdkIntialized","initialized","React","EditUserProfile","e","target","fetchMore","clientHeight","scrollTop","scrollHeight","hasNext","info","type","channelListActions","payload","next","then","channelList","canSetMarkAsDelivered","appInfo","premiumFeatureList","find","feature","forEach","c","idx","setTimeout","markAsDelivered","catch","err","PlaceHolderTypes","WRONG","map","channel","onLeaveChannel","cb","leave","res","url","onClick","some","_a","LOADING","length","NO_CHANNELS"],"mappings":"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"}