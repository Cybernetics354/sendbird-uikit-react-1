{"version":3,"file":"EditDetailsModal.js","sources":["../../../src/smart-components/ChannelSettings/components/EditDetailsModal/index.tsx"],"sourcesContent":["import React, { useState, useRef, useContext } from 'react';\n\nimport { useChannelSettingsContext } from '../../context/ChannelSettingsProvider';\nimport { LocalizationContext } from '../../../../lib/LocalizationContext';\nimport useSendbirdStateContext from '../../../../hooks/useSendbirdStateContext';\n\nimport Modal from '../../../../ui/Modal';\nimport Input, { InputLabel } from '../../../../ui/Input';\nimport Avatar from '../../../../ui/Avatar/index';\nimport { Type as ButtonType } from '../../../../ui/Button/type';\nimport Label, { LabelColors, LabelTypography } from '../../../../ui/Label';\nimport TextButton from '../../../../ui/TextButton';\nimport ChannelAvatar from '../../../../ui/ChannelAvatar/index';\nimport uuidv4 from '../../../../utils/uuid';\n\nexport type EditDetailsProps = {\n  onSubmit: () => void;\n  onCancel: () => void;\n}\n\nconst EditDetails: React.FC<EditDetailsProps> = (props: EditDetailsProps) => {\n  const {\n    onSubmit,\n    onCancel,\n  } = props;\n\n  const {\n    channel,\n    onChannelModified,\n    onBeforeUpdateChannel,\n    setChannelUpdateId,\n  } = useChannelSettingsContext();\n  const title = channel?.name;\n\n  const state = useSendbirdStateContext();\n  const userId = state?.config?.userId;\n  const theme = state?.config?.theme;\n  const logger = state?.config?.logger;\n\n  const inputRef = useRef(null);\n  const formRef = useRef(null);\n  const hiddenInputRef = useRef(null);\n  const [currentImg, setCurrentImg] = useState(null);\n  const [newFile, setNewFile] = useState(null);\n  const { stringSet } = useContext(LocalizationContext);\n\n  return (\n    <Modal\n      titleText={stringSet.MODAL__CHANNEL_INFORMATION__TITLE}\n      submitText={stringSet.BUTTON__SAVE}\n      onCancel={onCancel}\n      onSubmit={() => {\n        if (title !== '' && !inputRef.current.value) {\n          if (formRef.current.reportValidity) { // might not work in explorer\n            formRef.current.reportValidity();\n          }\n          return;\n        }\n\n        const currentTitle = inputRef.current.value;\n        const currentImg = newFile;\n        logger.info('ChannelSettings: Channel information being updated', {\n          currentTitle,\n          currentImg,\n        });\n        if (onBeforeUpdateChannel) {\n          logger.info('ChannelSettings: onBeforeUpdateChannel');\n          const params = onBeforeUpdateChannel(currentTitle, currentImg, channel?.data);\n          channel?.updateChannel(params).then((groupChannel) => {\n            onChannelModified?.(groupChannel);\n            setChannelUpdateId(uuidv4());\n            onSubmit();\n          });\n        } else {\n          logger.info('ChannelSettings: normal');\n          channel?.updateChannel({\n            coverImage: currentImg,\n            name: currentTitle,\n            data: channel?.data || '',\n          }).then((groupChannel) => {\n            logger.info('ChannelSettings: Channel information updated', groupChannel);\n            onChannelModified?.(groupChannel);\n            setChannelUpdateId(uuidv4());\n            onSubmit();\n          });\n        }\n      }}\n      type={ButtonType.PRIMARY}\n    >\n      <form\n        className=\"channel-profile-form\"\n        ref={formRef}\n        onSubmit={(e) => { e.preventDefault(); }}\n      >\n        <div className=\"channel-profile-form__img-section\">\n          <InputLabel>\n            {stringSet.MODAL__CHANNEL_INFORMATION__CHANNEL_IMAGE}\n          </InputLabel>\n          <div className=\"channel-profile-form__avatar\">\n            {\n              currentImg\n                ? (\n                  <Avatar\n                    height=\"80px\"\n                    width=\"80px\"\n                    src={currentImg}\n                  />\n                ) : (\n                  <ChannelAvatar\n                    height={80}\n                    width={80}\n                    channel={channel}\n                    userId={userId}\n                    theme={theme}\n                  />\n                )\n              }\n          </div>\n          <input\n            ref={hiddenInputRef}\n            type=\"file\"\n            accept=\"image/gif, image/jpeg, image/png\"\n            style={{ display: 'none' }}\n            onChange={(e) => {\n              setCurrentImg(URL.createObjectURL(e.target.files[0]));\n              setNewFile(e.target.files[0]);\n              hiddenInputRef.current.value = '';\n            }}\n          />\n          <TextButton\n            className=\"channel-profile-form__avatar-button\"\n            onClick={() => hiddenInputRef.current.click()}\n            notUnderline\n          >\n            <Label type={LabelTypography.BUTTON_1} color={LabelColors.PRIMARY}>\n              {stringSet.MODAL__CHANNEL_INFORMATION__UPLOAD}\n            </Label>\n          </TextButton>\n        </div>\n        <div className=\"channel-profile-form__name-section\">\n          <InputLabel>\n            {stringSet.MODAL__CHANNEL_INFORMATION__CHANNEL_NAME}\n          </InputLabel>\n          <Input\n            required={title !== ''}\n            name=\"channel-profile-form__name\"\n            ref={inputRef}\n            value={title}\n            placeHolder={stringSet.MODAL__CHANNEL_INFORMATION__INPUT__PLACE_HOLDER}\n          />\n        </div>\n      </form>\n    </Modal>\n  );\n};\n\nexport default EditDetails;\n"],"names":["EditDetails","props","onSubmit","onCancel","_d","useChannelSettingsContext","channel","onChannelModified","onBeforeUpdateChannel","setChannelUpdateId","title","name","state","useSendbirdStateContext","userId","config","theme","logger","inputRef","useRef","formRef","hiddenInputRef","_e","useState","currentImg","setCurrentImg","_f","newFile","setNewFile","stringSet","useContext","LocalizationContext","React","MODAL__CHANNEL_INFORMATION__TITLE","BUTTON__SAVE","current","value","reportValidity","currentTitle","info","params","data","updateChannel","then","groupChannel","uuidv4","coverImage","ButtonType","PRIMARY","e","preventDefault","MODAL__CHANNEL_INFORMATION__CHANNEL_IMAGE","display","URL","createObjectURL","target","files","click","LabelTypography","BUTTON_1","LabelColors","MODAL__CHANNEL_INFORMATION__UPLOAD","MODAL__CHANNEL_INFORMATION__CHANNEL_NAME","MODAL__CHANNEL_INFORMATION__INPUT__PLACE_HOLDER"],"mappings":"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"}